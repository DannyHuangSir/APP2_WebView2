{"ast":null,"code":"import _objectSpread from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";/* eslint-disable no-use-before-define */ /* eslint-disable brace-style */import axios from'axios';import{showError}from'./MessageModal';import JWEUtil from'./JWEUtil';import JWTUtil from'./JWTUtil';import{getJwtToken,syncJwtToken,getAesKey,forceLogout}from'./AppScriptProxy';// Axios instance\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var instance=axios.create({baseURL:process.env.REACT_APP_URL});var userAxios=function userAxios(){return instance;};/**\r\n * processRequest\r\n * @param {*} request\r\n * @returns\r\n */var processRequest=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(request){var jwtToken,payload,serverPKey,aes,_aes;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(\"\\x1B[33mAPI : \".concat(request.method.toUpperCase(),\" /\").concat(request.url));console.log('Request = ',request.data);if(!(request.method==='get')){_context.next=4;break;}return _context.abrupt(\"return\",request);case 4:_context.next=6;return getJwtToken();case 6:jwtToken=_context.sent;if(jwtToken)request.headers.authorization=\"Bearer \".concat(jwtToken);if(!(request.headers['Content-Type']==='multipart/form-data')){_context.next=10;break;}return _context.abrupt(\"return\",request);case 10:payload=request.data?JSON.stringify(request.data):'';// 處理 JWE Request 加密；在完成 Login 之前，都是使用 JWE 加密模式。\nif(!request.url.startsWith('/sm')){_context.next=25;break;}if(!request.url.startsWith('/smJwe/')){_context.next=17;break;}// TODO request.url.startsWith('//auth/')\nserverPKey=sessionStorage.getItem('serverPKey');request.data=JWEUtil.encryptJWEMessage(serverPKey,payload);_context.next=21;break;case 17:_context.next=19;return getAesKey();case 19:aes=_context.sent;request.data=JWTUtil.encryptJWTMessage(aes.aesKey,aes.iv,payload);case 21:request.url=request.url.replace('/smApi/','/api/');request.url=request.url.replace('/smJwe/','/api/');_context.next=30;break;case 25:if(!jwtToken){_context.next=30;break;}_context.next=28;return getAesKey();case 28:_aes=_context.sent;request.data=JWTUtil.encryptJWTMessage(_aes.aesKey,_aes.iv,payload);case 30:return _context.abrupt(\"return\",request);case 31:case\"end\":return _context.stop();}}},_callee);}));return function processRequest(_x){return _ref.apply(this,arguments);};}();/**\r\n * processResponse\r\n * @param {*} response\r\n * @returns\r\n */var processResponse=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(response){var _response$data,code,data,mac,jwtToken,rqJwtToken,headerAuth,encData,resultData,privateKey,aes,message;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:// console.log('%cResponse --> \\n%c%o', 'color: Yellow;', 'color: Green;', response);\n// console.log(`jwtToken=${response.data.jwtToken}`);\n// eslint-disable-next-line object-curly-newline\n_response$data=response.data,code=_response$data.code,data=_response$data.data,mac=_response$data.mac,jwtToken=_response$data.jwtToken;// 不論成功或失敗，都一定會更新 jwtToken\n// 來查是否發出的Request有沒有加密\nheaderAuth=response.config.headers.authorization;// 用Request時所使用的 jwtToken 來判斷是否有使用 JWT\nif(!(headerAuth&&headerAuth.startsWith('Bearer '))){_context2.next=10;break;}// eslint-disable-next-line prefer-destructuring\nrqJwtToken=headerAuth.split(' ')[1];// console.log(`\\x1b[32m[New JWT] \\x1b[92m${jwtToken}`);\nif(jwtToken){_context2.next=8;break;}console.log(\"\\x1B[31m*** WARNING *** \".concat(response.config.url,\" \\u5C07 JWT Token \\u8A2D\\u70BA\\u7A7A\\u503C\\uFF01\"),response);_context2.next=10;break;case 8:_context2.next=10;return syncJwtToken(jwtToken);case 10:encData=data!==null&&data!==void 0?data:response.data.encData;// 為相容 SM\nif(!(code==='0000')){_context2.next=24;break;}if(!encData.recipients){_context2.next=18;break;}// TODO 暫時用這種方式檢查 JWE\nconsole.log('*** Start JWE Decode ***');privateKey=sessionStorage.getItem('privateKey');resultData=JSON.parse(JWEUtil.decryptJWEMessage(privateKey,encData));_context2.next=23;break;case 18:if(!rqJwtToken){_context2.next=23;break;}_context2.next=21;return getAesKey();case 21:aes=_context2.sent;// console.log(aes, encData);\nresultData=JWTUtil.decryptJWTMessage(aes.aesKey,aes.iv,encData,mac);case 23:// console.log(`Response Data(解密後) --> ${JSON.stringify(resultData)}`);\nif(resultData){response.data={code:code,data:resultData,message:response.data.message};}case 24:if(!(code!=='0000')){_context2.next=34;break;}message=response.data.message;// TODO: 導向API失敗的例外處理的頁面！\nconsole.log(\"\\x1B[31m\".concat(response.config.url,\" - Exception = (\\x1B[33m\").concat(code,\"\\x1B[31m) \").concat(message));if(!(code==='ISG0001'||code==='WEBCTL0101')){_context2.next=32;break;}_context2.next=30;return showError('因為您已閒置過久未操作系統，為考量資訊安全；銀行端已自動切斷您的連線。若您要繼續使用，請重新登入，造成您的不便敬請見諒。',function(){// 理論上不會發生，但若 APP 沒控好，就有可能\nforceLogout('402','The ISG session has expired');});case 30:_context2.next=34;break;case 32:_context2.next=34;return showError(/*#__PURE__*/_jsxs(\"p\",{children:[\"*** \",code,\" ***\",/*#__PURE__*/_jsx(\"br\",{}),message]}));case 34:console.log(\"\\x1B[33m\".concat(response.config.url,\" \\x1B[37m - Response = \"),response.data);// 傳回 未加密 或 解密後 的資料\nreturn _context2.abrupt(\"return\",response);case 36:case\"end\":return _context2.stop();}}},_callee2);}));return function processResponse(_x2){return _ref2.apply(this,arguments);};}();instance.defaults.retry=3;instance.defaults.retryDelay=1000;// instance.defaults.maxContentLength = Infinity;\n// instance.defaults.maxBodyLength = Infinity;\ninstance.interceptors.request.use(processRequest,function(ex){// 系統層錯誤！\n// 若是環境問題，則直接顯示；若是WebController未處理的錯誤，則另外處理。\nconsole.log('\\x1b[31mRequest Error --> ',ex);Promise.reject(ex);});instance.interceptors.response.use(processResponse,/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(ex){var response,errMesg;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:// 系統層錯誤！\n// 若是環境問題，則直接顯示；若是WebController未處理的錯誤，則另外處理。\n// console.log(`%cResponse Error --> ${ex}`, 'color: Red;');\nresponse=ex.response;if(!response){_context3.next=12;break;}console.log(\"%cResponse Error --> \".concat(JSON.stringify(response)),'color: Red;');console.error(response.data);_context3.t0=response.status;_context3.next=_context3.t0===401?7:9;break;case 7:// The Token has expired\n// 理論上不會發生，但若 APP 沒控好，就有可能\nforceLogout('401','The Token has expired');return _context3.abrupt(\"break\",10);case 9:// TODO: Hold住畫面，再 Reload 一次。\nerrMesg=\"\\u4E3B\\u6A5F\\u5FD9\\u788C\\u4E2D\\uFF0C\\u8ACB\\u901A\\u77E5\\u5BA2\\u670D\\u4EBA\\u54E1\\u6216\\u7A0D\\u5F8C\\u518D\\u8A66\\u3002\\u8A0A\\u606F\\u4EE3\\u78BC\\uFF1A(\".concat(response.status,\")\");case 10:_context3.next=12;return showError(errMesg);case 12:return _context3.abrupt(\"return\",Promise.reject(ex));case 13:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}());/**\r\n *\r\n * @param {*} method 目前只支援 post/get\r\n * @param {*} url 透過 setupProxy.js 定義轉接 API 名稱。\r\n * @param {*} data\r\n * @param {*} config AxiosRequestConfig\r\n * @returns\r\n */export var userRequest=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(method,url,data,config){var _config$data;var request,result;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:instance.defaults.baseURL=url.startsWith('/sm')?process.env.REACT_APP_SM_CTRL_URL:process.env.REACT_APP_URL;// console.log(instance.defaults.baseURL + url);\nmethod=method.toLowerCase();request=(_config$data=config===null||config===void 0?void 0:config.data)!==null&&_config$data!==void 0?_config$data:data;// 在 config 中宣告的 data 優先權高於參數指定值，原因是 FormData 是記在 config 中。\nresult=null;_context4.t0=method;_context4.next=_context4.t0==='get'?7:_context4.t0==='post'?11:15;break;case 7:_context4.next=9;return instance.get(url,{params:request},config);case 9:result=_context4.sent;return _context4.abrupt(\"break\",18);case 11:_context4.next=13;return instance.post(url,request,config);case 13:result=_context4.sent;return _context4.abrupt(\"break\",18);case 15:console.log(\"\\u672A\\u652F\\u63F4\\u7684 method: \".concat(method));result=null;return _context4.abrupt(\"break\",18);case 18:return _context4.abrupt(\"return\",result);case 19:case\"end\":return _context4.stop();}}},_callee4);}));return function userRequest(_x4,_x5,_x6,_x7){return _ref4.apply(this,arguments);};}();/**\r\n * 透過 axios 叫用指定的 API，並負責處理非正常的傳回狀態。\r\n * @param {*} url 透過 setupProxy.js 定義轉接 API 名稱。\r\n * @param {*} request\r\n * @param {*} config AxiosRequestConfig\r\n * @returns 將 WebController 提供的結果傳回；當發生異常時，將傳回 null\r\n */export var callAPI=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(url,request,config){var _response;var response;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:response=null;_context6.next=3;return userRequest('post',url,request,config).then(/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(rs){var _rs$data,code,message;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:response=rs.data;// 只需傳回 WebController 傳回的部份，其他由 axios 額外附加的屬性則不傳回。\n_rs$data=rs.data,code=_rs$data.code,message=_rs$data.message;if(!(code!=='0000')){_context5.next=10;break;}_context5.t0=code;_context5.next=_context5.t0==='WEBCTL1006'?6:9;break;case 6:_context5.next=8;return showError(message,function(){document.location.href=\"\".concat(process.env.REACT_APP_ROUTER_BASE,\"/login\");});case 8:return _context5.abrupt(\"break\",10);case 9:return _context5.abrupt(\"break\",10);case 10:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x11){return _ref6.apply(this,arguments);};}()).catch(function(err){response=err;});case 3:return _context6.abrupt(\"return\",_objectSpread(_objectSpread({},response),{},{isSuccess:((_response=response)===null||_response===void 0?void 0:_response.code)==='0000'}));case 4:case\"end\":return _context6.stop();}}},_callee6);}));return function callAPI(_x8,_x9,_x10){return _ref5.apply(this,arguments);};}();/**\r\n * 下載檔案。\r\n * @param {*} url POST API URL\r\n * @param {*} request\r\n * @param {*} filename 輸出檔名。\r\n */export var download=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(url,request){var token,aes,encrypt;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:console.log(\"\\x1B[33mAPI :/\".concat(url));console.log('Request = ',request);_context7.next=4;return getJwtToken();case 4:token=_context7.sent;_context7.next=7;return getAesKey();case 7:aes=_context7.sent;encrypt=JWTUtil.encryptJWTMessage(aes.aesKey,aes.iv,JSON.stringify(request));return _context7.abrupt(\"return\",fetch(\"\".concat(process.env.REACT_APP_URL).concat(url),{method:'POST',headers:new Headers({Authorization:\"Bearer \".concat(token),'Content-Type':'application/json'}),body:JSON.stringify(encrypt)}).then(function(response){return response.blob();}).then(function(file){var fileUrl=URL.createObjectURL(file);var a=document.createElement('a');a.href=fileUrl;a.rel='noreferrer noopener';a.target='_blank';// 測試若不外開是否可執行\n// a.download = filename; // 因使用者體驗因素，改外開瀏覽器方式取代下載\na.click();}).catch(function(e){console.log(e);}));case 10:case\"end\":return _context7.stop();}}},_callee7);}));return function download(_x12,_x13){return _ref7.apply(this,arguments);};}();export default userAxios();","map":{"version":3,"names":["axios","showError","JWEUtil","JWTUtil","getJwtToken","syncJwtToken","getAesKey","forceLogout","instance","create","baseURL","process","env","REACT_APP_URL","userAxios","processRequest","request","console","log","method","toUpperCase","url","data","jwtToken","headers","authorization","payload","JSON","stringify","startsWith","serverPKey","sessionStorage","getItem","encryptJWEMessage","aes","encryptJWTMessage","aesKey","iv","replace","processResponse","response","code","mac","headerAuth","config","rqJwtToken","split","encData","recipients","privateKey","resultData","parse","decryptJWEMessage","decryptJWTMessage","message","defaults","retry","retryDelay","interceptors","use","ex","Promise","reject","error","status","errMesg","userRequest","REACT_APP_SM_CTRL_URL","toLowerCase","result","get","params","post","callAPI","then","rs","document","location","href","REACT_APP_ROUTER_BASE","catch","err","isSuccess","download","token","encrypt","fetch","Headers","Authorization","body","blob","file","fileUrl","URL","createObjectURL","a","createElement","rel","target","click","e"],"sources":["C:/Users/allen/git/app2-webview/src/utilities/axios.js"],"sourcesContent":["/* eslint-disable no-use-before-define */\r\n/* eslint-disable brace-style */\r\nimport axios from 'axios';\r\nimport { showError } from './MessageModal';\r\nimport JWEUtil from './JWEUtil';\r\nimport JWTUtil from './JWTUtil';\r\nimport {\r\n  getJwtToken, syncJwtToken, getAesKey, forceLogout,\r\n} from './AppScriptProxy';\r\n\r\n// Axios instance\r\nconst instance = axios.create({\r\n  baseURL: process.env.REACT_APP_URL,\r\n});\r\n\r\nconst userAxios = () => instance;\r\n\r\n/**\r\n * processRequest\r\n * @param {*} request\r\n * @returns\r\n */\r\nconst processRequest = async (request) => {\r\n  console.log(`\\x1b[33mAPI : ${request.method.toUpperCase()} /${request.url}`);\r\n  console.log('Request = ', request.data);\r\n  if (request.method === 'get') return request;\r\n\r\n  const jwtToken = await getJwtToken();\r\n  if (jwtToken) request.headers.authorization = `Bearer ${jwtToken}`;\r\n\r\n  if (request.headers['Content-Type'] === 'multipart/form-data') return request;\r\n\r\n  const payload = request.data ? JSON.stringify(request.data) : '';\r\n\r\n  // 處理 JWE Request 加密；在完成 Login 之前，都是使用 JWE 加密模式。\r\n  if (request.url.startsWith('/sm')) {\r\n    if (request.url.startsWith('/smJwe/')) { // TODO request.url.startsWith('//auth/')\r\n      const serverPKey = sessionStorage.getItem('serverPKey');\r\n      request.data = JWEUtil.encryptJWEMessage(serverPKey, payload);\r\n    } else {\r\n      const aes = await getAesKey();\r\n      request.data = JWTUtil.encryptJWTMessage(aes.aesKey, aes.iv, payload);\r\n    }\r\n\r\n    request.url = request.url.replace('/smApi/', '/api/');\r\n    request.url = request.url.replace('/smJwe/', '/api/');\r\n  }\r\n  // 處理 JWT Request 加密；當通過 Login 驗證之後，所有 POST 全部都是使用 JWT 加密模式。\r\n  else if (jwtToken) {\r\n    const aes = await getAesKey();\r\n    request.data = JWTUtil.encryptJWTMessage(aes.aesKey, aes.iv, payload);\r\n  }\r\n  // console.log(jwtToken);\r\n  // console.log('%cRequest --> %o', 'color: Green;', request); // 列出完整的 Request 資訊。\r\n  return request;\r\n};\r\n\r\n/**\r\n * processResponse\r\n * @param {*} response\r\n * @returns\r\n */\r\nconst processResponse = async (response) => {\r\n  // console.log('%cResponse --> \\n%c%o', 'color: Yellow;', 'color: Green;', response);\r\n  // console.log(`jwtToken=${response.data.jwtToken}`);\r\n  // eslint-disable-next-line object-curly-newline\r\n  const { code, data, mac, jwtToken } = response.data; // 不論成功或失敗，都一定會更新 jwtToken\r\n\r\n  let rqJwtToken; // 來查是否發出的Request有沒有加密\r\n  const headerAuth = response.config.headers.authorization; // 用Request時所使用的 jwtToken 來判斷是否有使用 JWT\r\n  if (headerAuth && headerAuth.startsWith('Bearer ')) {\r\n    // eslint-disable-next-line prefer-destructuring\r\n    rqJwtToken = headerAuth.split(' ')[1];\r\n\r\n    // console.log(`\\x1b[32m[New JWT] \\x1b[92m${jwtToken}`);\r\n    if (!jwtToken) console.log(`\\x1b[31m*** WARNING *** ${response.config.url} 將 JWT Token 設為空值！`, response);\r\n    else {\r\n      await syncJwtToken(jwtToken); // BUG! 可能因為多執行緒而錯亂\r\n    }\r\n  }\r\n\r\n  const encData = data ?? response.data.encData; // 為相容 SM\r\n  if (code === '0000') {\r\n    let resultData;\r\n    // 處理 JWE Response 解密\r\n    if (encData.recipients) { // TODO 暫時用這種方式檢查 JWE\r\n      console.log('*** Start JWE Decode ***');\r\n      const privateKey = sessionStorage.getItem('privateKey');\r\n      resultData = JSON.parse(JWEUtil.decryptJWEMessage(privateKey, encData));\r\n    }\r\n    // 處理 JWT Response 解密；若Request時沒有使用jwtToken，或例外發生時，傳回的資料都不會加密。\r\n    else if (rqJwtToken) {\r\n      // console.log('*** Start JWT Decode ***');\r\n      const aes = await getAesKey();\r\n      // console.log(aes, encData);\r\n      resultData = JWTUtil.decryptJWTMessage(aes.aesKey, aes.iv, encData, mac);\r\n    }\r\n\r\n    // console.log(`Response Data(解密後) --> ${JSON.stringify(resultData)}`);\r\n    if (resultData) {\r\n      response.data = {\r\n        code,\r\n        data: resultData,\r\n        message: response.data.message,\r\n      };\r\n    }\r\n  }\r\n\r\n  if (code !== '0000') {\r\n    const { message } = response.data;\r\n    // TODO: 導向API失敗的例外處理的頁面！\r\n    console.log(`\\x1b[31m${response.config.url} - Exception = (\\x1b[33m${code}\\x1b[31m) ${message}`);\r\n    if (code === 'ISG0001' || code === 'WEBCTL0101') {\r\n      await showError('因為您已閒置過久未操作系統，為考量資訊安全；銀行端已自動切斷您的連線。若您要繼續使用，請重新登入，造成您的不便敬請見諒。', () => {\r\n        // 理論上不會發生，但若 APP 沒控好，就有可能\r\n        forceLogout('402', 'The ISG session has expired');\r\n      });\r\n    } else {\r\n      // eslint-disable-next-line react/jsx-one-expression-per-line\r\n      await showError((<p>*** {code} ***<br />{message}</p>));\r\n    }\r\n  }\r\n\r\n  console.log(`\\x1b[33m${response.config.url} \\x1b[37m - Response = `, response.data);\r\n\r\n  // 傳回 未加密 或 解密後 的資料\r\n  return response;\r\n};\r\n\r\ninstance.defaults.retry = 3;\r\ninstance.defaults.retryDelay = 1000;\r\n// instance.defaults.maxContentLength = Infinity;\r\n// instance.defaults.maxBodyLength = Infinity;\r\ninstance.interceptors.request.use(\r\n  processRequest,\r\n  (ex) => {\r\n    // 系統層錯誤！\r\n    // 若是環境問題，則直接顯示；若是WebController未處理的錯誤，則另外處理。\r\n    console.log('\\x1b[31mRequest Error --> ', ex);\r\n    Promise.reject(ex);\r\n  },\r\n);\r\ninstance.interceptors.response.use(\r\n  processResponse,\r\n  async (ex) => {\r\n    // 系統層錯誤！\r\n    // 若是環境問題，則直接顯示；若是WebController未處理的錯誤，則另外處理。\r\n    // console.log(`%cResponse Error --> ${ex}`, 'color: Red;');\r\n    const { response } = ex;\r\n    if (response) {\r\n      console.log(`%cResponse Error --> ${JSON.stringify(response)}`, 'color: Red;');\r\n      console.error(response.data);\r\n      let errMesg;\r\n      switch (response.status) {\r\n        case 401: // The Token has expired\r\n          // 理論上不會發生，但若 APP 沒控好，就有可能\r\n          forceLogout('401', 'The Token has expired');\r\n          break;\r\n\r\n        default:\r\n          // TODO: Hold住畫面，再 Reload 一次。\r\n          errMesg = `主機忙碌中，請通知客服人員或稍後再試。訊息代碼：(${response.status})`; // TODO: 目前沒有 status 這個值。\r\n      }\r\n      await showError(errMesg); // TODO: 目前沒有 status 這個值。\r\n    }\r\n    return Promise.reject(ex);\r\n    /*\r\n    // 成功發出 request 但沒收到 response\r\n    if (!window.navigator.onLine) {\r\n      // TODO : 。。。\r\n    }\r\n    // 其它問題，例如跨域或程式問題\r\n    return Promise.reject(ex);\r\n    */\r\n  },\r\n);\r\n\r\n/**\r\n *\r\n * @param {*} method 目前只支援 post/get\r\n * @param {*} url 透過 setupProxy.js 定義轉接 API 名稱。\r\n * @param {*} data\r\n * @param {*} config AxiosRequestConfig\r\n * @returns\r\n */\r\nexport const userRequest = async (method, url, data, config) => {\r\n  instance.defaults.baseURL = (url.startsWith('/sm')) ? process.env.REACT_APP_SM_CTRL_URL : process.env.REACT_APP_URL;\r\n  // console.log(instance.defaults.baseURL + url);\r\n\r\n  method = method.toLowerCase();\r\n  const request = (config?.data ?? data); // 在 config 中宣告的 data 優先權高於參數指定值，原因是 FormData 是記在 config 中。\r\n  let result = null;\r\n  switch (method) {\r\n    case 'get':\r\n      result = await instance.get(url, { params: request }, config);\r\n      break;\r\n\r\n    case 'post':\r\n      result = await instance.post(url, request, config);\r\n      break;\r\n\r\n    // case 'put':\r\n    //   return instance.put(url, data, config);\r\n    // case 'patch':\r\n    //   return instance.patch(url, data, config);\r\n    // case 'delete':\r\n    //   return instance.delete(url, { params: data }, config);\r\n    default:\r\n      console.log(`未支援的 method: ${method}`);\r\n      result = null;\r\n      break;\r\n  }\r\n  return result;\r\n};\r\n\r\n/**\r\n * 透過 axios 叫用指定的 API，並負責處理非正常的傳回狀態。\r\n * @param {*} url 透過 setupProxy.js 定義轉接 API 名稱。\r\n * @param {*} request\r\n * @param {*} config AxiosRequestConfig\r\n * @returns 將 WebController 提供的結果傳回；當發生異常時，將傳回 null\r\n */\r\nexport const callAPI = async (url, request, config) => {\r\n  let response = null;\r\n  await userRequest('post', url, request, config)\r\n    .then(async (rs) => {\r\n      response = rs.data;\r\n      // 只需傳回 WebController 傳回的部份，其他由 axios 額外附加的屬性則不傳回。\r\n      const { code, message } = rs.data;\r\n      if (code !== '0000') {\r\n        switch (code) {\r\n          case 'WEBCTL1006':\r\n            await showError(message, () => {\r\n              document.location.href = `${process.env.REACT_APP_ROUTER_BASE}/login`;\r\n            });\r\n            break;\r\n\r\n          default:\r\n            // await showError(message);\r\n            break;\r\n        }\r\n      }\r\n    })\r\n    .catch((err) => {\r\n      response = err;\r\n    });\r\n  // // eslint-disable-next-line no-unused-vars\r\n  // .finally((rs) => {\r\n  //   // console.log('finally: {}', rs);\r\n  // });\r\n\r\n  return {\r\n    ...response,\r\n    isSuccess: (response?.code === '0000'),\r\n  };\r\n};\r\n\r\n/**\r\n * 下載檔案。\r\n * @param {*} url POST API URL\r\n * @param {*} request\r\n * @param {*} filename 輸出檔名。\r\n */\r\nexport const download = async (url, request) => {\r\n  console.log(`\\x1b[33mAPI :/${url}`);\r\n  console.log('Request = ', request);\r\n  const token = await getJwtToken();\r\n  // Request Payload 加密\r\n  const aes = await getAesKey();\r\n  const encrypt = JWTUtil.encryptJWTMessage(aes.aesKey, aes.iv, JSON.stringify(request));\r\n\r\n  return fetch(`${process.env.REACT_APP_URL}${url}`, {\r\n    method: 'POST',\r\n    headers: new Headers({\r\n      Authorization: `Bearer ${token}`,\r\n      'Content-Type': 'application/json',\r\n    }),\r\n    body: JSON.stringify(encrypt),\r\n  })\r\n    .then((response) => response.blob())\r\n    .then((file) => {\r\n      const fileUrl = URL.createObjectURL(file);\r\n\r\n      const a = document.createElement('a');\r\n      a.href = fileUrl;\r\n      a.rel = 'noreferrer noopener';\r\n      a.target = '_blank'; // 測試若不外開是否可執行\r\n      // a.download = filename; // 因使用者體驗因素，改外開瀏覽器方式取代下載\r\n      a.click();\r\n    })\r\n    .catch((e) => {\r\n      console.log(e);\r\n    });\r\n};\r\n\r\nexport default userAxios();\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}