{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/* eslint-disable no-use-before-define */import{useEffect,useRef,useState}from'react';import{useDispatch}from'react-redux';import VisibilitySensor from'react-visibility-sensor';import SearchCondition from'components/AccountDetails/searchCondition';import DebitCard from'components/DebitCard/DebitCard';import DetailCard from'components/DetailCard';import EmptyData from'components/EmptyData';import DepositPlanHeroSlide from'components/DepositPlanHeroSlide';import{FEIBIconButton,FEIBTab,FEIBTabContext,FEIBTabList}from'components/elements';import Loading from'components/Loading';import{setDrawerVisible}from'stores/reducers/ModalReducer';import{showDrawer}from'utilities/MessageModal';import{dateToString,stringToDate}from'utilities/Generator';import{CrossCircleIcon,DownloadIcon,SearchIcon}from'assets/images/icons';import theme from'themes/theme';import{getDepositBook}from'./api';import AccountDetailsWrapper,{DownloadDrawerWrapper}from'./accountDetails.style';/**\r\n * 交易明細頁\r\n * mode=0 -> C00300, C00400, C00500\r\n * mode=1 -> C00600\r\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AccountDetails=function AccountDetails(_ref){var _renderDetailCards;var selectedAccount=_ref.selectedAccount,onSearch=_ref.onSearch,_ref$mode=_ref.mode,mode=_ref$mode===void 0?0:_ref$mode;var dispatch=useDispatch();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];// 表示正在執行載入交易明細的 API\nvar _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),monthes=_useState4[0],setMonthes=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),currMonth=_useState6[0],setCurrMonth=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),transactions=_useState8[0],setTransactions=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),condition=_useState10[0],setCondition=_useState10[1];// 目前的查詢條件。\nvar _useState11=useState(),_useState12=_slicedToArray(_useState11,2),inviewFlag=_useState12[0],setInviewFlag=_useState12[1];var txnDetailsRef=useRef();// Note：要看懂這個程式的邏輯，一定要把 range 的用法弄懂！\n//       因為內容的變更會有即時性的需要，因此透過直接改 range 的值才能達成目的。\nvar setEmptyRange=function setEmptyRange(){return{min:Number.MAX_VALUE,max:-1};};var _useState13=useState({inview:setEmptyRange(),loaded:setEmptyRange(),loading:setEmptyRange()}),_useState14=_slicedToArray(_useState13,1),range=_useState14[0];/**\r\n   * 建構式\r\n   */useEffect(function(){resetView();},[]);/**\r\n   * 重設明細清單及範圍。\r\n   * @param {*} newCond 查詢條件。\r\n   */var resetView=function resetView(cond){// setTransactions(null); // 清除畫面交易明細資料。\nsetInviewFlag([]);range.inview=setEmptyRange();range.loaded=setEmptyRange();range.loading=setEmptyRange();setCondition(_objectSpread(_objectSpread({},cond),{},{accountNo:selectedAccount.accountNo,startIndex:null,direct:0// Note: 設為 0 才會清掉已載入的明細項目。\n}));};/**\r\n   * 載入明細資料，同時更新 loaded 及 loading 二個範圍值。\r\n   * @param {*} cond 查詢條件。\r\n   * @returns 由外部提供的 onSearch 方法所傳回的查詢結果。\r\n   */var loadTransition=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(cond){var dateRange,response,acctTxDtls,loadedMax,loadedMin;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsLoading(true);dateRange=getDateRange(cond);_context.next=4;return onSearch(_objectSpread(_objectSpread({},cond),{},{startDate:dateToString(dateRange.startDate,''),endDate:dateToString(dateRange.endDate,'')}));case 4:response=_context.sent;if(response){acctTxDtls=response.acctTxDtls;// 找出[已載入]資料的索引範圍。\nloadedMax=range.loaded.max;loadedMin=range.loaded.min;acctTxDtls.forEach(function(txn){loadedMax=Math.max(loadedMax,txn.index);loadedMin=Math.min(loadedMin,txn.index);});range.loaded.max=loadedMax;range.loaded.min=loadedMin;// 同步[載入中]資料的索引範圍；因為有新的資料載入了，若超過[載入中]的值，則以[已載入]的值為準。\nrange.loading.max=Math.max(range.loading.max,loadedMax);range.loading.min=Math.min(range.loading.min,loadedMin);}setIsLoading(false);return _context.abrupt(\"return\",response);case 8:case\"end\":return _context.stop();}}},_callee);}));return function loadTransition(_x){return _ref2.apply(this,arguments);};}();/**\r\n   * 查詢條件變更時，重新查詢，並重建清單陣列。\r\n   */useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var response,_condition$direct,acctTxDtls,monthly,startIndex,scrollDirection,newTransactions,monthList,containment,currItem;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return loadTransition(condition);case 2:response=_context2.sent;if(!response){_context2.next=17;break;}acctTxDtls=response.acctTxDtls,monthly=response.monthly,startIndex=response.startIndex;// 動態載入明細項目。\n// Note: 初始狀態 condition 會是 null，而且注意型別為「字串」\nscrollDirection=Number.parseInt((_condition$direct=condition===null||condition===void 0?void 0:condition.direct)!==null&&_condition$direct!==void 0?_condition$direct:'0',10);if(!(scrollDirection!==0)){_context2.next=11;break;}newTransactions=[];if(scrollDirection===-1){newTransactions=acctTxDtls.concat(transactions);// 新明細加到-前端\n}else if(scrollDirection===1){newTransactions=transactions.concat(acctTxDtls);// 新明細加到-後端\n}// 更新交易明細資料。\nsetTransactions(newTransactions);return _context2.abrupt(\"return\");case 11:// 取得所有存款卡的初始資料後存取月份資料 (Tabs)\nmonthList=monthly.sort(function(a,b){return b-a;});setCurrMonth(monthList[0]);setMonthes(monthList);// 更新交易明細資料。\nsetTransactions(acctTxDtls);containment=txnDetailsRef===null||txnDetailsRef===void 0?void 0:txnDetailsRef.current;// 所有明細項目的外層 HTML 容器物件。即： <div className=\"transactionDetail\"\nif(containment){currItem=containment.children[0];// 預設跳至第一筆資料\nif(condition!==null&&condition!==void 0&&condition.month){// 畫面跳轉至該月份第一筆資料\n// Note: 因為 child 是 UI元素，所以要透過 getAttribute 才能拿到值，而且是字串型態。\ncurrItem=Array.from(containment.children).find(function(child){return child.getAttribute('data-index')===(startIndex===null||startIndex===void 0?void 0:startIndex.toString());});}if(currItem){currItem.scrollIntoView({behavior:'smooth'});setCurrMonth(currItem.id);}}case 17:case\"end\":return _context2.stop();}}},_callee2);})),[condition]);/**\r\n   * 彈出 進階查詢 功能。\r\n   */var showSearchDrawer=function showSearchDrawer(){var closeDrawer=function closeDrawer(){dispatch(setDrawerVisible(false));};var content=/*#__PURE__*/_jsx(SearchCondition,{condition:condition,onSearch:function onSearch(newCond){closeDrawer();resetView(_objectSpread(_objectSpread({},newCond),{},{month:null// Note: 未清掉會列入查詢條件。\n}));},onCancel:closeDrawer});showDrawer('查詢條件',content);};/**\r\n   * 彈出 查詢結果下載功能選單。\r\n   */var showDownloadDrawer=function showDownloadDrawer(){/**\r\n     * 下載交易明細清單\r\n     * @param {*} fileType 下載檔案類型, 1:PDF, 2:EXCEL(CSV)\r\n     */var handleDownloadDetails=function handleDownloadDetails(fileType){// dispatch(setWaittingVisible(true)); // BUG : 打開、再關閉後，查詢條件會被清掉。\ndispatch(setDrawerVisible(false));getDepositBook(fileType,condition);// dispatch(setWaittingVisible(false));\n};var content=/*#__PURE__*/_jsxs(DownloadDrawerWrapper,{children:[/*#__PURE__*/_jsxs(\"li\",{onClick:function onClick(){return handleDownloadDetails(1);},children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u4E0B\\u8F09 PDF\"}),/*#__PURE__*/_jsx(DownloadIcon,{className:\"downloadIcon\"})]}),/*#__PURE__*/_jsxs(\"li\",{onClick:function onClick(){return handleDownloadDetails(2);},children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u4E0B\\u8F09 EXCEL\"}),/*#__PURE__*/_jsx(DownloadIcon,{className:\"downloadIcon\"})]})]});showDrawer('',content);};/**\r\n   * 顯示 存錢計畫 資訊卡\r\n   * @param {*} DepositPlan 啟用查詢明細頁的帳號資料\r\n   */var renderDepositPlanHero=function renderDepositPlanHero(plan){return/*#__PURE__*/_jsx(DepositPlanHeroSlide,_objectSpread({isSimple:true},plan));};/**\r\n   * 顯示 啟用查詢明細頁的帳號 資訊卡\r\n   * @param {*} account 啟用查詢明細頁的帳號資料\r\n   */var renderCardArea=function renderCardArea(account){return/*#__PURE__*/_jsx(\"div\",{className:\"debitCardWrapper\",children:/*#__PURE__*/_jsx(DebitCard,{cardName:account.alias,account:account.accountNo,balance:account.balance,dollarSign:account.currency,color:account.cardColor})});};var getDateRange=function getDateRange(cond){var startDate=null;var endDate=null;if(cond!==null&&cond!==void 0&&cond.mode){if(cond.mode==='0'){startDate=stringToDate(cond===null||cond===void 0?void 0:cond.startDate);// 轉為 Date 型別。\nendDate=stringToDate(cond===null||cond===void 0?void 0:cond.endDate);}else{endDate=new Date();startDate=new Date();startDate.setMonth(startDate.getMonth()-[6,12,24,36][cond.mode-'1']);}}return{startDate:startDate,endDate:endDate};};/**\r\n   * 顯示 查詢日期區間\r\n   * @param {*} cond 目前的查詢條件。\r\n   */var renderSearchBarText=function renderSearchBarText(cond){if(!cond||cond.mode==='0'&&!cond.startDate||cond.mode!=='0')return null;// 沒有設定查詢日期區間，就不顯示。\nvar dateRange=getDateRange(cond);return/*#__PURE__*/_jsxs(\"div\",{className:\"searchCondition\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\".concat(dateToString(dateRange.startDate),\" ~ \").concat(dateToString(dateRange.endDate))}),/*#__PURE__*/_jsx(FEIBIconButton,{onClick:function onClick(){return resetView();},children:/*#__PURE__*/_jsx(CrossCircleIcon,{})})]});};/**\r\n   * 顯示 查詢結果的月份清單。\r\n   * @param {*} items 查詢結果的月份資料。\r\n   */var renderMonthTabs=function renderMonthTabs(items){if(!(items!==null&&items!==void 0&&items.length))return null;// 點擊月份頁籤，以目前查詢條件再加上指定月份為新的查詢條件。\nvar handleClickMonthTab=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(event){var month,newCondition;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:// 由點擊的月份頁籤 (Tab) 取得月份條件，固定月份時查詢資料方向為 0 (雙向)\nmonth=event.currentTarget.getAttribute('data-month');newCondition=_objectSpread(_objectSpread({},condition),{},{month:month// direct: '0', // 資料方向為0，表示取前後各50筆。\n// startIndex: null, // Note：不可指定 startIndex 否則將視為一般查詢。\n});resetView(newCondition);case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function handleClickMonthTab(_x2){return _ref4.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"tabsArea\",children:/*#__PURE__*/_jsx(FEIBTabContext,{value:currMonth!==null&&currMonth!==void 0?currMonth:items[0],children:/*#__PURE__*/_jsx(FEIBTabList,{onChange:function onChange(event,id){return setCurrMonth(id);},$size:\"small\",className:\"tabList\",children:items.map(function(month){return/*#__PURE__*/_jsx(FEIBTab,{label:\"\".concat(month.substr(4,2),\"\\u6708\"),value:month,\"data-month\":month,onClick:handleClickMonthTab},month);})})})});};/**\r\n   * UI 明細項目被移入或移出畫面可見區域時，明細「項目」解發的事件處理。\r\n   * @param {*} index 解發事件的明細項目的索引值，即 DetailCard.index 屬性。\r\n   * @param {*} inVisible 移入為 true，移出為 false\r\n   */var onDetailCardVisibilityChange=function onDetailCardVisibilityChange(index,inVisible){inviewFlag[index-range.loaded.min]=inVisible;// 找出目前視景內的明細項目索引範圍。\nvar inviewMax=Number.MIN_VALUE;var inviewMin=Number.MAX_VALUE;var inviewFirst=null;inviewFlag.forEach(function(flag,i){if(flag===true){if(inviewFirst===null)inviewFirst=i;inviewMax=Math.max(inviewMax,range.loaded.min+i);inviewMin=Math.min(inviewMin,range.loaded.min+i);}});// 資料方向(1:上方移出可見區域, -1.下方移出可見區域\nvar scrollDirection=Math.sign(range.inview.min===Number.MAX_VALUE?0:inviewMin-range.inview.min);// 避掉 inview 初始值的誤判\nrange.inview.max=inviewMax;range.inview.min=inviewMin;// 捲動畫面時，根據當前畫面上的第一筆明細動態切換月份標籤\nif(inviewFirst!==null)setCurrMonth(transactions[inviewFirst].txnDate.substr(0,6));// Note: 非常重要！ 目的是為了避免在明細資料載入時，因為畫面自動重刷，而重覆載資料的情況。\n//       新加入的資料，會使 scrollDirection 出現非零的情況。\nif(isLoading)return;// 動態補充明細資料。\n// 若正在處理資料請求中，則不會再次發出請求\nvar startIndex=null;if(scrollDirection===1&&range.loaded.max+25>range.loading.max){// 上方-移出可見區域\nif(range.inview.max+25>range.loaded.max){// 25筆是保留的緩衝筆數。\nif(range.loaded.max+50>range.loading.max){// 50筆是正在載入的筆數；若已在載入中(即相差50筆)就不需要再抓資料。\n// 下方明細剩餘數量少於 25 張時，反向獲取接續 50 筆\nrange.loading.max+=50;// console.log('*** Loading +50 ... ==> ', range.loading);\nstartIndex=range.loaded.max+1;}}}else if(scrollDirection===-1&&range.loading.min>1){// 下方-移出可見區域；若是從頭開始的，就不用再補了，因為不會有資料。\nif(range.inview.min-25<range.loaded.min){// 25筆是保留的緩衝筆數。\nif(range.loaded.min-50<range.loading.min){// 50筆是正在載入的筆數；若已在載入中(即相差50筆)就不需要再抓資料。\n// 上方明細剩餘數量少於 25 張時，反向獲取接續 50 筆\nrange.loading.min=Math.max(range.loading.min-50,1);// console.log('*** Loading -50 ... ==> ', range.loading);\nstartIndex=range.loaded.min-1;}}}if(scrollDirection===0||startIndex==null)return;// 表示只有改變可見狀態，所以不影響。\n// 保留原本的查詢條件，改用 direct 通知補充明細資料的方向及位置。\nsetCondition(_objectSpread(_objectSpread({},condition),{},{month:null,// Note：一定要清掉，因為切換月份只是一次性的行為，而且不可跟 startIndex 共存。\ndirect:scrollDirection,startIndex:startIndex}));};/**\r\n   * 顯示 查詢結果的明細清單。\r\n   * @param {*} items 查詢結果的明細資料。\r\n   */var renderDetailCards=function renderDetailCards(items){if(!items||items.length===0)return null;return items.map(function(item){return/*#__PURE__*/_jsx(VisibilitySensor,{onChange:function onChange(isVisible){return onDetailCardVisibilityChange(item.index,isVisible);},containment:txnDetailsRef.current,partialVisibility:true,children:function children(_ref5){var isVisible=_ref5.isVisible;return/*#__PURE__*/_jsx(DetailCard,_objectSpread(_objectSpread({},item),{},{id:item.txnDate.substr(0,6),inView:isVisible?'Y':'N',noShadow:true}));}},item.index);});};/**\r\n   * 主頁面\r\n   */return/*#__PURE__*/_jsxs(AccountDetailsWrapper,{children:[mode===0&&renderCardArea(selectedAccount),mode===1&&renderDepositPlanHero(selectedAccount),/*#__PURE__*/_jsxs(\"div\",{className:\"inquiryArea measuredHeight\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"searchBar\",children:[/*#__PURE__*/_jsx(FEIBIconButton,{onClick:showSearchDrawer,children:/*#__PURE__*/_jsx(SearchIcon,{size:20,color:theme.colors.text.dark})}),renderSearchBarText(condition),/*#__PURE__*/_jsx(FEIBIconButton,{className:\"customPosition\",onClick:showDownloadDrawer,children:/*#__PURE__*/_jsx(DownloadIcon,{size:20,color:theme.colors.text.dark})})]}),renderMonthTabs(monthes),/*#__PURE__*/_jsxs(\"div\",{className:\"transactionDetail\",ref:txnDetailsRef,style:{overflowY:'scroll'},children:[(_renderDetailCards=renderDetailCards(transactions))!==null&&_renderDetailCards!==void 0?_renderDetailCards:/*#__PURE__*/_jsx(EmptyData,{}),isLoading&&/*#__PURE__*/_jsx(Loading,{space:\"both\",isCentered:true})]})]})]});};export default AccountDetails;","map":{"version":3,"names":["useEffect","useRef","useState","useDispatch","VisibilitySensor","SearchCondition","DebitCard","DetailCard","EmptyData","DepositPlanHeroSlide","FEIBIconButton","FEIBTab","FEIBTabContext","FEIBTabList","Loading","setDrawerVisible","showDrawer","dateToString","stringToDate","CrossCircleIcon","DownloadIcon","SearchIcon","theme","getDepositBook","AccountDetailsWrapper","DownloadDrawerWrapper","AccountDetails","selectedAccount","onSearch","mode","dispatch","isLoading","setIsLoading","monthes","setMonthes","currMonth","setCurrMonth","transactions","setTransactions","condition","setCondition","inviewFlag","setInviewFlag","txnDetailsRef","setEmptyRange","min","Number","MAX_VALUE","max","inview","loaded","loading","range","resetView","cond","accountNo","startIndex","direct","loadTransition","dateRange","getDateRange","startDate","endDate","response","acctTxDtls","loadedMax","loadedMin","forEach","txn","Math","index","monthly","scrollDirection","parseInt","newTransactions","concat","monthList","sort","a","b","containment","current","currItem","children","month","Array","from","find","child","getAttribute","toString","scrollIntoView","behavior","id","showSearchDrawer","closeDrawer","content","newCond","showDownloadDrawer","handleDownloadDetails","fileType","renderDepositPlanHero","plan","renderCardArea","account","alias","balance","currency","cardColor","Date","setMonth","getMonth","renderSearchBarText","renderMonthTabs","items","length","handleClickMonthTab","event","currentTarget","newCondition","map","substr","onDetailCardVisibilityChange","inVisible","inviewMax","MIN_VALUE","inviewMin","inviewFirst","flag","i","sign","txnDate","renderDetailCards","item","isVisible","colors","text","dark","overflowY"],"sources":["C:/Users/allen/git/app2-webview/src/components/AccountDetails/accountDetails.js"],"sourcesContent":["/* eslint-disable no-use-before-define */\r\nimport { useEffect, useRef, useState } from 'react';\r\nimport { useDispatch } from 'react-redux';\r\nimport VisibilitySensor from 'react-visibility-sensor';\r\nimport SearchCondition from 'components/AccountDetails/searchCondition';\r\nimport DebitCard from 'components/DebitCard/DebitCard';\r\nimport DetailCard from 'components/DetailCard';\r\nimport EmptyData from 'components/EmptyData';\r\nimport DepositPlanHeroSlide from 'components/DepositPlanHeroSlide';\r\nimport {\r\n  FEIBIconButton, FEIBTab, FEIBTabContext, FEIBTabList,\r\n} from 'components/elements';\r\nimport Loading from 'components/Loading';\r\nimport { setDrawerVisible } from 'stores/reducers/ModalReducer';\r\nimport { showDrawer } from 'utilities/MessageModal';\r\nimport { dateToString, stringToDate } from 'utilities/Generator';\r\nimport { CrossCircleIcon, DownloadIcon, SearchIcon } from 'assets/images/icons';\r\nimport theme from 'themes/theme';\r\nimport { getDepositBook } from './api';\r\nimport AccountDetailsWrapper, { DownloadDrawerWrapper } from './accountDetails.style';\r\n\r\n/**\r\n * 交易明細頁\r\n * mode=0 -> C00300, C00400, C00500\r\n * mode=1 -> C00600\r\n */\r\nconst AccountDetails = ({\r\n  selectedAccount, onSearch, mode = 0,\r\n}) => {\r\n  const dispatch = useDispatch();\r\n\r\n  const [isLoading, setIsLoading] = useState(false); // 表示正在執行載入交易明細的 API\r\n  const [monthes, setMonthes] = useState([]);\r\n  const [currMonth, setCurrMonth] = useState(null);\r\n  const [transactions, setTransactions] = useState(null);\r\n  const [condition, setCondition] = useState(null); // 目前的查詢條件。\r\n  const [inviewFlag, setInviewFlag] = useState();\r\n  const txnDetailsRef = useRef();\r\n\r\n  // Note：要看懂這個程式的邏輯，一定要把 range 的用法弄懂！\r\n  //       因為內容的變更會有即時性的需要，因此透過直接改 range 的值才能達成目的。\r\n  const setEmptyRange = () => ({ min: Number.MAX_VALUE, max: -1 });\r\n  const [range] = useState({\r\n    inview: setEmptyRange(),\r\n    loaded: setEmptyRange(),\r\n    loading: setEmptyRange(),\r\n  });\r\n\r\n  /**\r\n   * 建構式\r\n   */\r\n  useEffect(() => {\r\n    resetView();\r\n  }, []);\r\n\r\n  /**\r\n   * 重設明細清單及範圍。\r\n   * @param {*} newCond 查詢條件。\r\n   */\r\n  const resetView = (cond) => {\r\n    // setTransactions(null); // 清除畫面交易明細資料。\r\n    setInviewFlag([]);\r\n    range.inview = setEmptyRange();\r\n    range.loaded = setEmptyRange();\r\n    range.loading = setEmptyRange();\r\n    setCondition({\r\n      ...cond,\r\n      accountNo: selectedAccount.accountNo,\r\n      startIndex: null,\r\n      direct: 0, // Note: 設為 0 才會清掉已載入的明細項目。\r\n    });\r\n  };\r\n\r\n  /**\r\n   * 載入明細資料，同時更新 loaded 及 loading 二個範圍值。\r\n   * @param {*} cond 查詢條件。\r\n   * @returns 由外部提供的 onSearch 方法所傳回的查詢結果。\r\n   */\r\n  const loadTransition = async (cond) => {\r\n    setIsLoading(true);\r\n\r\n    const dateRange = getDateRange(cond);\r\n    const response = await onSearch({\r\n      ...cond,\r\n      startDate: dateToString(dateRange.startDate, ''),\r\n      endDate: dateToString(dateRange.endDate, ''),\r\n    });\r\n    if (response) {\r\n      const { acctTxDtls } = response;\r\n\r\n      // 找出[已載入]資料的索引範圍。\r\n      let loadedMax = range.loaded.max;\r\n      let loadedMin = range.loaded.min;\r\n      acctTxDtls.forEach((txn) => {\r\n        loadedMax = Math.max(loadedMax, txn.index);\r\n        loadedMin = Math.min(loadedMin, txn.index);\r\n      });\r\n      range.loaded.max = loadedMax;\r\n      range.loaded.min = loadedMin;\r\n\r\n      // 同步[載入中]資料的索引範圍；因為有新的資料載入了，若超過[載入中]的值，則以[已載入]的值為準。\r\n      range.loading.max = Math.max(range.loading.max, loadedMax);\r\n      range.loading.min = Math.min(range.loading.min, loadedMin);\r\n    }\r\n\r\n    setIsLoading(false);\r\n    return response;\r\n  };\r\n\r\n  /**\r\n   * 查詢條件變更時，重新查詢，並重建清單陣列。\r\n   */\r\n  useEffect(async () => {\r\n    const response = await loadTransition(condition);\r\n    if (response) {\r\n      const { acctTxDtls, monthly, startIndex } = response;\r\n\r\n      // 動態載入明細項目。\r\n      // Note: 初始狀態 condition 會是 null，而且注意型別為「字串」\r\n      const scrollDirection = Number.parseInt(condition?.direct ?? '0', 10);\r\n      if (scrollDirection !== 0) {\r\n        let newTransactions = [];\r\n        if (scrollDirection === -1) {\r\n          newTransactions = acctTxDtls.concat(transactions); // 新明細加到-前端\r\n        } else if (scrollDirection === 1) {\r\n          newTransactions = transactions.concat(acctTxDtls); // 新明細加到-後端\r\n        }\r\n        // 更新交易明細資料。\r\n        setTransactions(newTransactions);\r\n        return; // Note: 因為是在動態增加明細項目，所以不會變更目前可見區域，以及月份清單。\r\n      }\r\n\r\n      // 取得所有存款卡的初始資料後存取月份資料 (Tabs)\r\n      const monthList = monthly.sort((a, b) => b - a);\r\n      setCurrMonth(monthList[0]);\r\n      setMonthes(monthList);\r\n\r\n      // 更新交易明細資料。\r\n      setTransactions(acctTxDtls);\r\n\r\n      const containment = txnDetailsRef?.current; // 所有明細項目的外層 HTML 容器物件。即： <div className=\"transactionDetail\"\r\n      if (containment) {\r\n        let currItem = containment.children[0]; // 預設跳至第一筆資料\r\n        if (condition?.month) {\r\n          // 畫面跳轉至該月份第一筆資料\r\n          // Note: 因為 child 是 UI元素，所以要透過 getAttribute 才能拿到值，而且是字串型態。\r\n          currItem = Array.from(containment.children).find((child) => child.getAttribute('data-index') === startIndex?.toString());\r\n        }\r\n\r\n        if (currItem) {\r\n          currItem.scrollIntoView({ behavior: 'smooth' });\r\n          setCurrMonth(currItem.id);\r\n        }\r\n      }\r\n    }\r\n  }, [condition]);\r\n\r\n  /**\r\n   * 彈出 進階查詢 功能。\r\n   */\r\n  const showSearchDrawer = () => {\r\n    const closeDrawer = () => { dispatch(setDrawerVisible(false)); };\r\n    const content = (\r\n      <SearchCondition\r\n        condition={condition}\r\n        onSearch={(newCond) => {\r\n          closeDrawer();\r\n          resetView({\r\n            ...newCond,\r\n            month: null, // Note: 未清掉會列入查詢條件。\r\n          });\r\n        }}\r\n        onCancel={closeDrawer}\r\n      />\r\n    );\r\n    showDrawer('查詢條件', content);\r\n  };\r\n\r\n  /**\r\n   * 彈出 查詢結果下載功能選單。\r\n   */\r\n  const showDownloadDrawer = () => {\r\n    /**\r\n     * 下載交易明細清單\r\n     * @param {*} fileType 下載檔案類型, 1:PDF, 2:EXCEL(CSV)\r\n     */\r\n    const handleDownloadDetails = (fileType) => {\r\n      // dispatch(setWaittingVisible(true)); // BUG : 打開、再關閉後，查詢條件會被清掉。\r\n      dispatch(setDrawerVisible(false));\r\n      getDepositBook(fileType, condition);\r\n      // dispatch(setWaittingVisible(false));\r\n    };\r\n\r\n    const content = (\r\n      <DownloadDrawerWrapper>\r\n        <li onClick={() => handleDownloadDetails(1)}>\r\n          <p>下載 PDF</p>\r\n          <DownloadIcon className=\"downloadIcon\" />\r\n        </li>\r\n        <li onClick={() => handleDownloadDetails(2)}>\r\n          <p>下載 EXCEL</p>\r\n          <DownloadIcon className=\"downloadIcon\" />\r\n        </li>\r\n      </DownloadDrawerWrapper>\r\n    );\r\n    showDrawer('', content);\r\n  };\r\n\r\n  /**\r\n   * 顯示 存錢計畫 資訊卡\r\n   * @param {*} DepositPlan 啟用查詢明細頁的帳號資料\r\n   */\r\n  const renderDepositPlanHero = (plan) => (\r\n    <DepositPlanHeroSlide isSimple {...plan} />\r\n  );\r\n\r\n  /**\r\n   * 顯示 啟用查詢明細頁的帳號 資訊卡\r\n   * @param {*} account 啟用查詢明細頁的帳號資料\r\n   */\r\n  const renderCardArea = (account) => (\r\n    <div className=\"debitCardWrapper\">\r\n      <DebitCard\r\n        cardName={account.alias}\r\n        account={account.accountNo}\r\n        balance={account.balance}\r\n        dollarSign={account.currency}\r\n        color={account.cardColor}\r\n      />\r\n    </div>\r\n  );\r\n\r\n  const getDateRange = (cond) => {\r\n    let startDate = null;\r\n    let endDate = null;\r\n    if (cond?.mode) {\r\n      if (cond.mode === '0') {\r\n        startDate = stringToDate(cond?.startDate); // 轉為 Date 型別。\r\n        endDate = stringToDate(cond?.endDate);\r\n      } else {\r\n        endDate = new Date();\r\n        startDate = new Date();\r\n        startDate.setMonth(startDate.getMonth() - [6, 12, 24, 36][cond.mode - '1']);\r\n      }\r\n    }\r\n    return { startDate, endDate };\r\n  };\r\n\r\n  /**\r\n   * 顯示 查詢日期區間\r\n   * @param {*} cond 目前的查詢條件。\r\n   */\r\n  const renderSearchBarText = (cond) => {\r\n    if (!cond || (cond.mode === '0' && !cond.startDate) || cond.mode !== '0') return null; // 沒有設定查詢日期區間，就不顯示。\r\n    const dateRange = getDateRange(cond);\r\n\r\n    return (\r\n      <div className=\"searchCondition\">\r\n        <p>{`${dateToString(dateRange.startDate)} ~ ${dateToString(dateRange.endDate)}`}</p>\r\n        <FEIBIconButton onClick={() => resetView()}>\r\n          <CrossCircleIcon />\r\n        </FEIBIconButton>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  /**\r\n   * 顯示 查詢結果的月份清單。\r\n   * @param {*} items 查詢結果的月份資料。\r\n   */\r\n  const renderMonthTabs = (items) => {\r\n    if (!items?.length) return null;\r\n\r\n    // 點擊月份頁籤，以目前查詢條件再加上指定月份為新的查詢條件。\r\n    const handleClickMonthTab = async (event) => {\r\n      // 由點擊的月份頁籤 (Tab) 取得月份條件，固定月份時查詢資料方向為 0 (雙向)\r\n      const month = event.currentTarget.getAttribute('data-month');\r\n      const newCondition = {\r\n        ...condition,\r\n        month,\r\n        // direct: '0', // 資料方向為0，表示取前後各50筆。\r\n        // startIndex: null, // Note：不可指定 startIndex 否則將視為一般查詢。\r\n      };\r\n      resetView(newCondition);\r\n    };\r\n\r\n    return (\r\n      <div className=\"tabsArea\">\r\n        <FEIBTabContext value={currMonth ?? items[0]}>\r\n          <FEIBTabList onChange={(event, id) => setCurrMonth(id)} $size=\"small\" className=\"tabList\">\r\n            { items.map((month) => (\r\n              <FEIBTab\r\n                key={month}\r\n                label={`${month.substr(4, 2)}月`}\r\n                value={month}\r\n                data-month={month}\r\n                onClick={handleClickMonthTab}\r\n              />\r\n            )) }\r\n          </FEIBTabList>\r\n        </FEIBTabContext>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  /**\r\n   * UI 明細項目被移入或移出畫面可見區域時，明細「項目」解發的事件處理。\r\n   * @param {*} index 解發事件的明細項目的索引值，即 DetailCard.index 屬性。\r\n   * @param {*} inVisible 移入為 true，移出為 false\r\n   */\r\n  const onDetailCardVisibilityChange = (index, inVisible) => {\r\n    inviewFlag[index - range.loaded.min] = inVisible;\r\n\r\n    // 找出目前視景內的明細項目索引範圍。\r\n    let inviewMax = Number.MIN_VALUE;\r\n    let inviewMin = Number.MAX_VALUE;\r\n    let inviewFirst = null;\r\n    inviewFlag.forEach((flag, i) => {\r\n      if (flag === true) {\r\n        if (inviewFirst === null) inviewFirst = i;\r\n        inviewMax = Math.max(inviewMax, range.loaded.min + i);\r\n        inviewMin = Math.min(inviewMin, range.loaded.min + i);\r\n      }\r\n    });\r\n\r\n    // 資料方向(1:上方移出可見區域, -1.下方移出可見區域\r\n    const scrollDirection = Math.sign((range.inview.min === Number.MAX_VALUE) ? 0 : (inviewMin - range.inview.min)); // 避掉 inview 初始值的誤判\r\n    range.inview.max = inviewMax;\r\n    range.inview.min = inviewMin;\r\n\r\n    // 捲動畫面時，根據當前畫面上的第一筆明細動態切換月份標籤\r\n    if (inviewFirst !== null) setCurrMonth(transactions[inviewFirst].txnDate.substr(0, 6));\r\n\r\n    // Note: 非常重要！ 目的是為了避免在明細資料載入時，因為畫面自動重刷，而重覆載資料的情況。\r\n    //       新加入的資料，會使 scrollDirection 出現非零的情況。\r\n    if (isLoading) return;\r\n\r\n    // 動態補充明細資料。\r\n    // 若正在處理資料請求中，則不會再次發出請求\r\n    let startIndex = null;\r\n    if (scrollDirection === 1 && ((range.loaded.max + 25) > range.loading.max)) { // 上方-移出可見區域\r\n      if ((range.inview.max + 25) > range.loaded.max) { // 25筆是保留的緩衝筆數。\r\n        if ((range.loaded.max + 50) > range.loading.max) { // 50筆是正在載入的筆數；若已在載入中(即相差50筆)就不需要再抓資料。\r\n          // 下方明細剩餘數量少於 25 張時，反向獲取接續 50 筆\r\n          range.loading.max += 50;\r\n          // console.log('*** Loading +50 ... ==> ', range.loading);\r\n          startIndex = range.loaded.max + 1;\r\n        }\r\n      }\r\n    } else if (scrollDirection === -1 && range.loading.min > 1) { // 下方-移出可見區域；若是從頭開始的，就不用再補了，因為不會有資料。\r\n      if ((range.inview.min - 25) < range.loaded.min) { // 25筆是保留的緩衝筆數。\r\n        if ((range.loaded.min - 50) < range.loading.min) { // 50筆是正在載入的筆數；若已在載入中(即相差50筆)就不需要再抓資料。\r\n          // 上方明細剩餘數量少於 25 張時，反向獲取接續 50 筆\r\n          range.loading.min = Math.max(range.loading.min - 50, 1);\r\n          // console.log('*** Loading -50 ... ==> ', range.loading);\r\n          startIndex = range.loaded.min - 1;\r\n        }\r\n      }\r\n    }\r\n    if (scrollDirection === 0 || startIndex == null) return; // 表示只有改變可見狀態，所以不影響。\r\n\r\n    // 保留原本的查詢條件，改用 direct 通知補充明細資料的方向及位置。\r\n    setCondition({\r\n      ...condition,\r\n      month: null, // Note：一定要清掉，因為切換月份只是一次性的行為，而且不可跟 startIndex 共存。\r\n      direct: scrollDirection,\r\n      startIndex,\r\n    });\r\n  };\r\n\r\n  /**\r\n   * 顯示 查詢結果的明細清單。\r\n   * @param {*} items 查詢結果的明細資料。\r\n   */\r\n  const renderDetailCards = (items) => {\r\n    if (!items || items.length === 0) return null;\r\n\r\n    return (\r\n      items.map((item) => (\r\n        <VisibilitySensor\r\n          key={item.index}\r\n          onChange={(isVisible) => onDetailCardVisibilityChange(item.index, isVisible)}\r\n          containment={txnDetailsRef.current}\r\n          partialVisibility\r\n        >\r\n          {({ isVisible }) => (\r\n            <DetailCard\r\n              {...item}\r\n              id={item.txnDate.substr(0, 6)}\r\n              inView={isVisible ? 'Y' : 'N'}\r\n              noShadow\r\n            />\r\n          )}\r\n        </VisibilitySensor>\r\n      ))\r\n    );\r\n  };\r\n\r\n  /**\r\n   * 主頁面\r\n   */\r\n  return (\r\n    <AccountDetailsWrapper>\r\n      { (mode === 0) && renderCardArea(selectedAccount) }\r\n      { (mode === 1) && renderDepositPlanHero(selectedAccount) }\r\n      <div className=\"inquiryArea measuredHeight\">\r\n\r\n        <div className=\"searchBar\">\r\n          <FEIBIconButton onClick={showSearchDrawer}>\r\n            <SearchIcon size={20} color={theme.colors.text.dark} />\r\n          </FEIBIconButton>\r\n          { renderSearchBarText(condition) }\r\n          <FEIBIconButton className=\"customPosition\" onClick={showDownloadDrawer}>\r\n            <DownloadIcon size={20} color={theme.colors.text.dark} />\r\n          </FEIBIconButton>\r\n        </div>\r\n\r\n        { renderMonthTabs(monthes) }\r\n\r\n        {/* TODO transactionDetail 的 height: 500, maxHeight: 500 不應該是固定值 */}\r\n        {/* #882 拿掉 height: 500, maxHeight: 500 進行測試  */}\r\n        <div className=\"transactionDetail\" ref={txnDetailsRef} style={{ overflowY: 'scroll' }}>\r\n          { renderDetailCards(transactions) ?? <EmptyData /> }\r\n          { isLoading && <Loading space=\"both\" isCentered /> }\r\n        </div>\r\n      </div>\r\n    </AccountDetailsWrapper>\r\n  );\r\n};\r\n\r\nexport default AccountDetails;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}