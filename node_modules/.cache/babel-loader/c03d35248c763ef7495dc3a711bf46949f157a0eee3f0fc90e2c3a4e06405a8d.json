{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import uuid from'react-uuid';import{getSubSummary,getSubPayment,getSubPaymentHistory}from'./api';var handleSubPaymentHistory=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(account,subNo){var startDate,endDate,resSubPaymentSummary,paymentSummaryData;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:/* 取得查詢起始日 */startDate=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(param){var subPaymentList;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getSubPayment(param);case 2:subPaymentList=_context.sent;return _context.abrupt(\"return\",subPaymentList[0].startDate);case 4:case\"end\":return _context.stop();}}},_callee);}));return function startDate(_x3){return _ref2.apply(this,arguments);};}();/* 取得查詢結束日，查詢區間為三年 */endDate=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(param){var subPaymentList;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getSubPayment(param);case 2:subPaymentList=_context2.sent;return _context2.abrupt(\"return\",(parseInt(subPaymentList[0].startDate,10)+30000).toString());case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function endDate(_x4){return _ref3.apply(this,arguments);};}();/* 根據貸款帳號、貸款分號、起始日、結束日取得分帳還款記錄 */_context3.t0=getSubPaymentHistory;_context3.t1=account;_context3.t2=subNo;_context3.next=7;return startDate({account:account,subNo:subNo});case 7:_context3.t3=_context3.sent;_context3.next=10;return endDate({account:account,subNo:subNo});case 10:_context3.t4=_context3.sent;_context3.t5={account:_context3.t1,subNo:_context3.t2,startDate:_context3.t3,endDate:_context3.t4};_context3.next=14;return(0,_context3.t0)(_context3.t5);case 14:resSubPaymentSummary=_context3.sent;if(resSubPaymentSummary.code==='ISG0308-E494')paymentSummaryData=[];if(resSubPaymentSummary.code==='0000')paymentSummaryData=resSubPaymentSummary.data;return _context3.abrupt(\"return\",paymentSummaryData);case 18:case\"end\":return _context3.stop();}}},_callee3);}));return function handleSubPaymentHistory(_x,_x2){return _ref.apply(this,arguments);};}();/**\r\n * 貸款首頁 - 取得貸款資訊和還款紀錄\r\n   @returns [\r\n   {\r\n     type: 貸款別名\r\n     accountNo: 卡號\r\n     loanNo: 貸款分號\r\n     balance: 貸款餘額\r\n     currency: 幣別 // 無回傳資料，預設\"NTD\"\r\n     bonusInfo: {\r\n       cycleTiming: 每期還款日，回傳數字1~28\r\n       interest: 應繳本息\r\n       rewards: 可能回饋，未參加回饋挑戰可忽略\r\n       isJoinedRewardProgram: 是否參加回饋挑戰\r\n       currency: 幣別 // 無回傳資料，預設\"NTD\"\r\n     },\r\n     transactions: [\r\n       {\r\n         id: TODO 跳轉單筆繳款紀錄查詢頁需要\r\n         txnDate: 交易日期\r\n         amount: 還款金額\r\n         balance: 貸款餘額\r\n         currency: 幣別 // 無回傳資料，預設\"NTD\"\r\n       }, ...],\r\n    }, ...]\r\n */export var getLoanSummary=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(){var resSubSummary,loanSummary;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return getSubSummary();case 2:resSubSummary=_context5.sent;_context5.next=5;return Promise.all(resSubSummary.map(/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(subSummary){var _handleSubPaymentHist;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.t0=subSummary.account;_context4.t1=subSummary.subNo;_context4.t2=parseFloat(subSummary.balance);_context4.t3={cycleTiming:subSummary.dayToPay,interest:parseFloat(subSummary.payAmount),rewards:'-',// TODO: 此階段不做\nisJoinedRewardProgram:'-',// TODO: 此階段不做\ncurrency:'NTD'};_context4.next=6;return(_handleSubPaymentHist=handleSubPaymentHistory(subSummary.account,subSummary.subNo))===null||_handleSubPaymentHist===void 0?void 0:_handleSubPaymentHist.then(function(res){return res.map(function(subPaymentHistory){return{id:uuid(),type:subPaymentHistory.type,txnDate:subPaymentHistory.date,amount:parseFloat(subPaymentHistory.amount),balance:parseFloat(subPaymentHistory.balance)};});});case 6:_context4.t4=_context4.sent;return _context4.abrupt(\"return\",{loanType:'信貸',accountNo:_context4.t0,loanNo:_context4.t1,balance:_context4.t2,bonusInfo:_context4.t3,transactions:_context4.t4});case 8:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x5){return _ref5.apply(this,arguments);};}()));case 5:loanSummary=_context5.sent;return _context5.abrupt(\"return\",loanSummary);case 7:case\"end\":return _context5.stop();}}},_callee5);}));return function getLoanSummary(){return _ref4.apply(this,arguments);};}();","map":{"version":3,"names":["uuid","getSubSummary","getSubPayment","getSubPaymentHistory","handleSubPaymentHistory","account","subNo","startDate","param","subPaymentList","endDate","parseInt","toString","resSubPaymentSummary","code","paymentSummaryData","data","getLoanSummary","resSubSummary","Promise","all","map","subSummary","parseFloat","balance","cycleTiming","dayToPay","interest","payAmount","rewards","isJoinedRewardProgram","currency","then","res","subPaymentHistory","id","type","txnDate","date","amount","loanType","accountNo","loanNo","bonusInfo","transactions","loanSummary"],"sources":["C:/Users/allen/git/app2-webview/src/pages/L00100_Loan/utils.js"],"sourcesContent":["import uuid from 'react-uuid';\r\nimport { getSubSummary, getSubPayment, getSubPaymentHistory } from './api';\r\n\r\nconst handleSubPaymentHistory = async (account, subNo) => {\r\n  /* 取得查詢起始日 */\r\n  const startDate = async (param) => {\r\n    const subPaymentList = await getSubPayment(param);\r\n\r\n    return subPaymentList[0].startDate;\r\n  };\r\n\r\n  /* 取得查詢結束日，查詢區間為三年 */\r\n  const endDate = async (param) => {\r\n    const subPaymentList = await getSubPayment(param);\r\n    return (parseInt(subPaymentList[0].startDate, 10) + 30000).toString();\r\n  };\r\n\r\n  /* 根據貸款帳號、貸款分號、起始日、結束日取得分帳還款記錄 */\r\n  const resSubPaymentSummary = await getSubPaymentHistory({\r\n    account,\r\n    subNo,\r\n    startDate: await startDate({ account, subNo }),\r\n    endDate: await endDate({ account, subNo }),\r\n  });\r\n  let paymentSummaryData;\r\n\r\n  if (resSubPaymentSummary.code === 'ISG0308-E494') paymentSummaryData = [];\r\n  if (resSubPaymentSummary.code === '0000') paymentSummaryData = resSubPaymentSummary.data;\r\n\r\n  return paymentSummaryData;\r\n};\r\n\r\n/**\r\n * 貸款首頁 - 取得貸款資訊和還款紀錄\r\n   @returns [\r\n   {\r\n     type: 貸款別名\r\n     accountNo: 卡號\r\n     loanNo: 貸款分號\r\n     balance: 貸款餘額\r\n     currency: 幣別 // 無回傳資料，預設\"NTD\"\r\n     bonusInfo: {\r\n       cycleTiming: 每期還款日，回傳數字1~28\r\n       interest: 應繳本息\r\n       rewards: 可能回饋，未參加回饋挑戰可忽略\r\n       isJoinedRewardProgram: 是否參加回饋挑戰\r\n       currency: 幣別 // 無回傳資料，預設\"NTD\"\r\n     },\r\n     transactions: [\r\n       {\r\n         id: TODO 跳轉單筆繳款紀錄查詢頁需要\r\n         txnDate: 交易日期\r\n         amount: 還款金額\r\n         balance: 貸款餘額\r\n         currency: 幣別 // 無回傳資料，預設\"NTD\"\r\n       }, ...],\r\n    }, ...]\r\n */\r\nexport const getLoanSummary = async () => {\r\n  /* 取得此帳號所有貸款資料 */\r\n  const resSubSummary = await getSubSummary();\r\n\r\n  /* 將回傳資料轉換成頁面資料結構 */\r\n  const loanSummary = await Promise.all(resSubSummary.map(async (subSummary) => ({\r\n    loanType: '信貸', // TODO: 貸款種類主機尚未提供，先暫填『信貸』\r\n    accountNo: subSummary.account,\r\n    loanNo: subSummary.subNo,\r\n    balance: parseFloat(subSummary.balance),\r\n    bonusInfo: {\r\n      cycleTiming: subSummary.dayToPay,\r\n      interest: parseFloat(subSummary.payAmount),\r\n      rewards: '-', // TODO: 此階段不做\r\n      isJoinedRewardProgram: '-', // TODO: 此階段不做\r\n      currency: 'NTD',\r\n    },\r\n    transactions: await handleSubPaymentHistory(subSummary.account, subSummary.subNo)?.then((res) => res.map((subPaymentHistory) => ({\r\n      id: uuid(),\r\n      type: subPaymentHistory.type,\r\n      txnDate: subPaymentHistory.date,\r\n      amount: parseFloat(subPaymentHistory.amount),\r\n      balance: parseFloat(subPaymentHistory.balance),\r\n    }))),\r\n  })));\r\n\r\n  return loanSummary;\r\n};\r\n"],"mappings":"0PAAA,MAAOA,KAAI,KAAM,YAAY,CAC7B,OAASC,aAAa,CAAEC,aAAa,CAAEC,oBAAoB,KAAQ,OAAO,CAE1E,GAAMC,wBAAuB,4FAAG,kBAAOC,OAAO,CAAEC,KAAK,sLACnD,aACMC,SAAS,6FAAG,iBAAOC,KAAK,6JACCN,cAAa,CAACM,KAAK,CAAC,QAA3CC,cAAc,+CAEbA,cAAc,CAAC,CAAC,CAAC,CAACF,SAAS,wDACnC,kBAJKA,UAAS,+CAMf,qBACMG,OAAO,6FAAG,kBAAOF,KAAK,kKACGN,cAAa,CAACM,KAAK,CAAC,QAA3CC,cAAc,iDACb,CAACE,QAAQ,CAACF,cAAc,CAAC,CAAC,CAAC,CAACF,SAAS,CAAE,EAAE,CAAC,CAAG,KAAK,EAAEK,QAAQ,EAAE,0DACtE,kBAHKF,QAAO,+CAKb,8CACmCP,oBAAoB,cACrDE,OAAO,cACPC,KAAK,wBACYC,UAAS,CAAC,CAAEF,OAAO,CAAPA,OAAO,CAAEC,KAAK,CAALA,KAAM,CAAC,CAAC,4DAC/BI,QAAO,CAAC,CAAEL,OAAO,CAAPA,OAAO,CAAEC,KAAK,CAALA,KAAM,CAAC,CAAC,mDAH1CD,OAAO,cACPC,KAAK,cACLC,SAAS,cACTG,OAAO,8EAJHG,oBAAoB,gBAQ1B,GAAIA,oBAAoB,CAACC,IAAI,GAAK,cAAc,CAAEC,kBAAkB,CAAG,EAAE,CACzE,GAAIF,oBAAoB,CAACC,IAAI,GAAK,MAAM,CAAEC,kBAAkB,CAAGF,oBAAoB,CAACG,IAAI,CAAC,iCAElFD,kBAAkB,2DAC1B,kBA3BKX,wBAAuB,gDA2B5B,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACA,MAAO,IAAMa,eAAc,6FAAG,+LAEAhB,cAAa,EAAE,QAArCiB,aAAa,uCAGOC,QAAO,CAACC,GAAG,CAACF,aAAa,CAACG,GAAG,6FAAC,kBAAOC,UAAU,+JAE5DA,UAAU,CAACjB,OAAO,cACrBiB,UAAU,CAAChB,KAAK,cACfiB,UAAU,CAACD,UAAU,CAACE,OAAO,CAAC,cAC5B,CACTC,WAAW,CAAEH,UAAU,CAACI,QAAQ,CAChCC,QAAQ,CAAEJ,UAAU,CAACD,UAAU,CAACM,SAAS,CAAC,CAC1CC,OAAO,CAAE,GAAG,CAAE;AACdC,qBAAqB,CAAE,GAAG,CAAE;AAC5BC,QAAQ,CAAE,KACZ,CAAC,+CACmB3B,uBAAuB,CAACkB,UAAU,CAACjB,OAAO,CAAEiB,UAAU,CAAChB,KAAK,CAAC,gDAA7D,sBAA+D0B,IAAI,CAAC,SAACC,GAAG,QAAKA,IAAG,CAACZ,GAAG,CAAC,SAACa,iBAAiB,QAAM,CAC/HC,EAAE,CAAEnC,IAAI,EAAE,CACVoC,IAAI,CAAEF,iBAAiB,CAACE,IAAI,CAC5BC,OAAO,CAAEH,iBAAiB,CAACI,IAAI,CAC/BC,MAAM,CAAEhB,UAAU,CAACW,iBAAiB,CAACK,MAAM,CAAC,CAC5Cf,OAAO,CAAED,UAAU,CAACW,iBAAiB,CAACV,OAAO,CAC/C,CAAC,EAAC,CAAC,GAAC,sEAjBJgB,QAAQ,CAAE,IAAI,CACdC,SAAS,cACTC,MAAM,cACNlB,OAAO,cACPmB,SAAS,cAOTC,YAAY,wEAOZ,iEAAC,CAAC,QAnBEC,WAAW,iDAqBVA,WAAW,0DACnB,kBA3BY5B,eAAc,2CA2B1B"},"metadata":{},"sourceType":"module","externalDependencies":[]}