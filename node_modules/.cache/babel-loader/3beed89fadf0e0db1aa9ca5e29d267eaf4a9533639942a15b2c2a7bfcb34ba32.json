{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React,{useEffect}from'react';import{useForm}from'react-hook-form';import{useHistory}from'react-router';import{yupResolver}from'@hookform/resolvers/yup';import{useQLStatus}from'hooks/useQLStatus';import Layout from'components/Layout/Layout';import{FEIBButton}from'components/elements';import{TextInputField}from'components/Fields';import{AuthCode}from'utilities/TxnAuthCode';import{transactionAuth}from'utilities/AppScriptProxy';import{getStatus}from'pages/S00800_LossReissue/api';import{getAccountsList}from'utilities/CacheData';import{activate}from'./api';import DebitCardActiveWrapper from'./S00700.style';import{validationSchema}from'./validationSchema';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var S00700=function S00700(){var history=useHistory();var _useQLStatus=useQLStatus(),QLResult=_useQLStatus.QLResult,showMessage=_useQLStatus.showMessage;var _useForm=useForm({defaultValues:{actno:'',serial:''},resolver:yupResolver(validationSchema)}),control=_useForm.control,handleSubmit=_useForm.handleSubmit,reset=_useForm.reset;var submitHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(values){var auth,activateResponse;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return transactionAuth(AuthCode.S00700);case 2:auth=_context.sent;if(!(auth&&auth.result)){_context.next=10;break;}_context.next=6;return getStatus();case 6:_context.next=8;return activate(_objectSpread({},values));case 8:activateResponse=_context.sent;history.push('/S007001',_objectSpread({},activateResponse));case 10:case\"end\":return _context.stop();}}},_callee);}));return function submitHandler(_x){return _ref.apply(this,arguments);};}();useEffect(function(){if(!QLResult)showMessage();},[QLResult]);// 我的金融卡帳號欄位自動帶入金融卡台幣主帳號\nuseEffect(function(){getAccountsList('M',function(accounts){return reset(function(formValues){return _objectSpread(_objectSpread({},formValues),{},{actno:accounts[0].accountNo});});});},[]);return/*#__PURE__*/_jsx(Layout,{title:\"\\u91D1\\u878D\\u5361\\u555F\\u7528\",children:/*#__PURE__*/_jsx(DebitCardActiveWrapper,{children:/*#__PURE__*/_jsxs(\"form\",{style:{minHeight:'initial'},onSubmit:handleSubmit(submitHandler),children:[/*#__PURE__*/_jsx(TextInputField,{type:\"number\",labelName:\"\\u6211\\u7684\\u91D1\\u878D\\u5361\\u5E33\\u865F\",name:\"actno\",control:control,disabled:true}),/*#__PURE__*/_jsx(TextInputField,{type:\"number\",labelName:\"\\u6211\\u7684\\u91D1\\u878D\\u5361\\u5E8F\\u865F\",name:\"serial\",placeholder:\"\\u8ACB\\u8F38\\u5165\\u91D1\\u878D\\u5361\\u5E8F\\u865F\",control:control}),/*#__PURE__*/_jsx(\"p\",{className:\"hint_text\",children:\"\\u91D1\\u878D\\u5361\\u80CC\\u9762\\u53F3\\u4E0B\\u89D26\\u78BC\\u6578\\u5B57\"}),/*#__PURE__*/_jsx(FEIBButton,{type:\"submit\",children:\"\\u78BA\\u8A8D\"})]})})});};export default S00700;","map":{"version":3,"names":["React","useEffect","useForm","useHistory","yupResolver","useQLStatus","Layout","FEIBButton","TextInputField","AuthCode","transactionAuth","getStatus","getAccountsList","activate","DebitCardActiveWrapper","validationSchema","S00700","history","QLResult","showMessage","defaultValues","actno","serial","resolver","control","handleSubmit","reset","submitHandler","values","auth","result","activateResponse","push","accounts","formValues","accountNo","minHeight"],"sources":["C:/Users/allen/git/app2-webview/src/pages/S00700_DebitCardActive/S00700.js"],"sourcesContent":["import React, { useEffect } from 'react';\r\nimport { useForm } from 'react-hook-form';\r\nimport { useHistory } from 'react-router';\r\nimport { yupResolver } from '@hookform/resolvers/yup';\r\n\r\nimport { useQLStatus } from 'hooks/useQLStatus';\r\nimport Layout from 'components/Layout/Layout';\r\nimport { FEIBButton } from 'components/elements';\r\nimport { TextInputField } from 'components/Fields';\r\nimport { AuthCode } from 'utilities/TxnAuthCode';\r\nimport { transactionAuth } from 'utilities/AppScriptProxy';\r\nimport { getStatus } from 'pages/S00800_LossReissue/api';\r\n\r\nimport { getAccountsList } from 'utilities/CacheData';\r\nimport { activate } from './api';\r\nimport DebitCardActiveWrapper from './S00700.style';\r\nimport { validationSchema } from './validationSchema';\r\n\r\nconst S00700 = () => {\r\n  const history = useHistory();\r\n  const { QLResult, showMessage } = useQLStatus();\r\n  const { control, handleSubmit, reset } = useForm({\r\n    defaultValues: { actno: '', serial: '' },\r\n    resolver: yupResolver(validationSchema),\r\n  });\r\n\r\n  const submitHandler = async (values) => {\r\n    const auth = await transactionAuth(AuthCode.S00700);\r\n    if (auth && auth.result) {\r\n      await getStatus(); // activate 之前需要先獲得卡況\r\n      const activateResponse = await activate({...values});\r\n      history.push('/S007001', {...activateResponse});\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!QLResult) showMessage();\r\n  }, [QLResult]);\r\n\r\n  // 我的金融卡帳號欄位自動帶入金融卡台幣主帳號\r\n  useEffect(() => {\r\n    getAccountsList('M', (accounts) => reset((formValues) => ({...formValues, actno: accounts[0].accountNo})));\r\n  }, []);\r\n\r\n  return (\r\n    <Layout title=\"金融卡啟用\">\r\n      <DebitCardActiveWrapper>\r\n        <form style={{ minHeight: 'initial' }} onSubmit={handleSubmit(submitHandler)}>\r\n          <TextInputField\r\n            type=\"number\"\r\n            labelName=\"我的金融卡帳號\"\r\n            name=\"actno\"\r\n            control={control}\r\n            disabled\r\n          />\r\n          <TextInputField\r\n            type=\"number\"\r\n            labelName=\"我的金融卡序號\"\r\n            name=\"serial\"\r\n            placeholder=\"請輸入金融卡序號\"\r\n            control={control}\r\n          />\r\n          <p className=\"hint_text\">金融卡背面右下角6碼數字</p>\r\n          <FEIBButton type=\"submit\">確認</FEIBButton>\r\n        </form>\r\n      </DebitCardActiveWrapper>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default S00700;\r\n"],"mappings":"8WAAA,MAAOA,MAAK,EAAIC,SAAS,KAAQ,OAAO,CACxC,OAASC,OAAO,KAAQ,iBAAiB,CACzC,OAASC,UAAU,KAAQ,cAAc,CACzC,OAASC,WAAW,KAAQ,yBAAyB,CAErD,OAASC,WAAW,KAAQ,mBAAmB,CAC/C,MAAOC,OAAM,KAAM,0BAA0B,CAC7C,OAASC,UAAU,KAAQ,qBAAqB,CAChD,OAASC,cAAc,KAAQ,mBAAmB,CAClD,OAASC,QAAQ,KAAQ,uBAAuB,CAChD,OAASC,eAAe,KAAQ,0BAA0B,CAC1D,OAASC,SAAS,KAAQ,8BAA8B,CAExD,OAASC,eAAe,KAAQ,qBAAqB,CACrD,OAASC,QAAQ,KAAQ,OAAO,CAChC,MAAOC,uBAAsB,KAAM,gBAAgB,CACnD,OAASC,gBAAgB,KAAQ,oBAAoB,CAAC,wFAEtD,GAAMC,OAAM,CAAG,QAATA,OAAM,EAAS,CACnB,GAAMC,QAAO,CAAGd,UAAU,EAAE,CAC5B,iBAAkCE,WAAW,EAAE,CAAvCa,QAAQ,cAARA,QAAQ,CAAEC,WAAW,cAAXA,WAAW,CAC7B,aAAyCjB,OAAO,CAAC,CAC/CkB,aAAa,CAAE,CAAEC,KAAK,CAAE,EAAE,CAAEC,MAAM,CAAE,EAAG,CAAC,CACxCC,QAAQ,CAAEnB,WAAW,CAACW,gBAAgB,CACxC,CAAC,CAAC,CAHMS,OAAO,UAAPA,OAAO,CAAEC,YAAY,UAAZA,YAAY,CAAEC,KAAK,UAALA,KAAK,CAKpC,GAAMC,cAAa,4FAAG,iBAAOC,MAAM,oKACdlB,gBAAe,CAACD,QAAQ,CAACO,MAAM,CAAC,QAA7Ca,IAAI,oBACNA,IAAI,EAAIA,IAAI,CAACC,MAAM,iDACfnB,UAAS,EAAE,8BACcE,SAAQ,kBAAKe,MAAM,EAAE,QAA9CG,gBAAgB,eACtBd,OAAO,CAACe,IAAI,CAAC,UAAU,kBAAMD,gBAAgB,EAAE,CAAC,uDAEnD,kBAPKJ,cAAa,4CAOlB,CAED1B,SAAS,CAAC,UAAM,CACd,GAAI,CAACiB,QAAQ,CAAEC,WAAW,EAAE,CAC9B,CAAC,CAAE,CAACD,QAAQ,CAAC,CAAC,CAEd;AACAjB,SAAS,CAAC,UAAM,CACdW,eAAe,CAAC,GAAG,CAAE,SAACqB,QAAQ,QAAKP,MAAK,CAAC,SAACQ,UAAU,wCAAUA,UAAU,MAAEb,KAAK,CAAEY,QAAQ,CAAC,CAAC,CAAC,CAACE,SAAS,IAAE,CAAC,GAAC,CAC5G,CAAC,CAAE,EAAE,CAAC,CAEN,mBACE,KAAC,MAAM,EAAC,KAAK,CAAC,gCAAO,uBACnB,KAAC,sBAAsB,wBACrB,cAAM,KAAK,CAAE,CAAEC,SAAS,CAAE,SAAU,CAAE,CAAC,QAAQ,CAAEX,YAAY,CAACE,aAAa,CAAE,wBAC3E,KAAC,cAAc,EACb,IAAI,CAAC,QAAQ,CACb,SAAS,CAAC,4CAAS,CACnB,IAAI,CAAC,OAAO,CACZ,OAAO,CAAEH,OAAQ,CACjB,QAAQ,OACR,cACF,KAAC,cAAc,EACb,IAAI,CAAC,QAAQ,CACb,SAAS,CAAC,4CAAS,CACnB,IAAI,CAAC,QAAQ,CACb,WAAW,CAAC,kDAAU,CACtB,OAAO,CAAEA,OAAQ,EACjB,cACF,UAAG,SAAS,CAAC,WAAW,iFAAiB,cACzC,KAAC,UAAU,EAAC,IAAI,CAAC,QAAQ,0BAAgB,GACpC,EACgB,EAClB,CAEb,CAAC,CAED,cAAeR,OAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}