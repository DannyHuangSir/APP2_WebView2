{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/* eslint-disable no-unused-vars */import{useDispatch}from'react-redux';import{useEffect,useState}from'react';/* Elements */import Layout from'components/Layout/Layout';import{FEIBSwitch,FEIBSwitchLabel}from'components/elements';import Accordion from'components/Accordion';import EditIcon from'assets/images/icons/editIcon.svg';import{closeDrawer,showAnimationModal,showDrawer}from'utilities/MessageModal';import{AuthCode}from'utilities/TxnAuthCode';import{setWaittingVisible}from'stores/reducers/ModalReducer';import{getQLStatus,transactionAuth}from'utilities/AppScriptProxy';import{useQLStatus}from'hooks/useQLStatus';import{getSettingInfo,changeStatus}from'./api';/* Styles */import{T00300Wrapper}from'./T00300.style';import T00300AccordionContent from'./T00300_accordionContent';import T00300DrawerContent from'./T00300_drawerContent';/**\r\n * T00300 非約轉設定\r\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var T00300=function T00300(){var dispatch=useDispatch();var _useQLStatus=useQLStatus(),QLResult=_useQLStatus.QLResult,showMessage=_useQLStatus.showMessage;// 確認裝置綁定狀態(比照無卡提款設定)\nvar _useState=useState({}),_useState2=_slicedToArray(_useState,2),model=_useState2[0],setModel=_useState2[1];var isUnlock=(model===null||model===void 0?void 0:model.status)!=='01';// 表示已開通非約轉, '01'表示尚未開通\nvar isBound=(model===null||model===void 0?void 0:model.status)==='03';// 表示已綁定非約轉手機號碼\nvar authAndChangeStatus=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(authCode,newMobile){var transRes,newStatus;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return transactionAuth(authCode,newMobile);case 2:transRes=_context.sent;if(!(transRes.result===true)){_context.next=13;break;}_context.next=6;return changeStatus(newMobile);case 6:newStatus=_context.sent;if(!newStatus){_context.next=13;break;}model.status=newStatus;setModel(_objectSpread({},model));// 更新畫面。\n// 顯示成功畫面\n_context.next=12;return showAnimationModal({isSuccess:true,successTitle:'設定成功'});case 12:return _context.abrupt(\"return\",true);case 13:return _context.abrupt(\"return\",false);case 14:case\"end\":return _context.stop();}}},_callee);}));return function authAndChangeStatus(_x,_x2){return _ref.apply(this,arguments);};}();/**\r\n   * Bottom Drawer 確認按鈕行為\r\n   * @param {Promise<String>} newMobile 新的綁定手機號碼。\r\n   */var handleDrawerConfirm=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(newMobile){var isSuccess;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(isUnlock&&model.status!=='04')){_context2.next=7;break;}if(!(newMobile!==model.mobile)){_context2.next=5;break;}_context2.next=4;return authAndChangeStatus(AuthCode.T00300.EDIT,newMobile);case 4:isSuccess=_context2.sent;case 5:_context2.next=10;break;case 7:_context2.next=9;return authAndChangeStatus(AuthCode.T00300.APPLY,newMobile);case 9:isSuccess=_context2.sent;case 10:if(isSuccess){model.mobile=newMobile;setModel(_objectSpread({},model));// 更新畫面。\n}closeDrawer();case 12:case\"end\":return _context2.stop();}}},_callee2);}));return function handleDrawerConfirm(_x3){return _ref2.apply(this,arguments);};}();/**\r\n   * 非約轉交易門號 Drawer\r\n   * @param {Promise<Boolean>} isEdit 表示可以修改非約轉交易門號。\r\n   */var showSettingDrawer=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(isEdit){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return showDrawer('非約轉交易門號',/*#__PURE__*/_jsx(T00300DrawerContent,{readonly:!isEdit,mobile:model.mobile,onConfirm:handleDrawerConfirm,onCancel:closeDrawer}));case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function showSettingDrawer(_x4){return _ref3.apply(this,arguments);};}();/**\r\n   * 切換綁定狀態。\r\n   */var handleSwitchOnTrigger=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!QLResult){_context4.next=10;break;}if(isBound){_context4.next=5;break;}// 開通 or 申請+開通流程\n// 若原狀態為 01.未開發 則表示第一次開通，只有此情況下不可變更綁定門號。\n// 完成綁定門號開通後，status=3.已開通；之後的開關切換就是狀態3/4的互換。\nshowSettingDrawer(isUnlock);// status 由 01/04 變為 03.開通\n_context4.next=7;break;case 5:_context4.next=7;return authAndChangeStatus(AuthCode.T00300.CLOSE);case 7:setModel(_objectSpread({},model));// 更新畫面。\n_context4.next=11;break;case 10:showMessage();case 11:case\"end\":return _context4.stop();}}},_callee4);}));return function handleSwitchOnTrigger(){return _ref4.apply(this,arguments);};}();/**\r\n   * 取得初始資料\r\n   */useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(){var settingInfo;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:dispatch(setWaittingVisible(true));_context5.next=3;return getSettingInfo();case 3:settingInfo=_context5.sent;// if (settingInfo.status === ???) // TODO 那些狀態下就不能進行設定？\nsetModel(settingInfo);dispatch(setWaittingVisible(false));case 6:case\"end\":return _context5.stop();}}},_callee5);})),[]);return/*#__PURE__*/_jsx(Layout,{title:\"\\u975E\\u7D04\\u8F49\\u8A2D\\u5B9A\",children:/*#__PURE__*/_jsxs(T00300Wrapper,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"info_container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"setting_switch\",children:/*#__PURE__*/_jsx(FEIBSwitchLabel,{control:/*#__PURE__*/_jsx(FEIBSwitch,{checked:isBound,onChange:handleSwitchOnTrigger}),label:\"\\u975E\\u7D04\\u5B9A\\u8F49\\u5E33\\u8A2D\\u5B9A\"})}),isBound&&/*#__PURE__*/_jsx(\"div\",{className:\"phone_number\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u624B\\u6A5F\\u865F\\u78BC\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mobile_number_text\",children:model.mobile})]})})]}),/*#__PURE__*/_jsx(Accordion,{title:\"\\u4F7F\\u7528\\u689D\\u6B3E\",space:\"both\",children:/*#__PURE__*/_jsx(T00300AccordionContent,{})})]})});};export default T00300;","map":{"version":3,"names":["useDispatch","useEffect","useState","Layout","FEIBSwitch","FEIBSwitchLabel","Accordion","EditIcon","closeDrawer","showAnimationModal","showDrawer","AuthCode","setWaittingVisible","getQLStatus","transactionAuth","useQLStatus","getSettingInfo","changeStatus","T00300Wrapper","T00300AccordionContent","T00300DrawerContent","T00300","dispatch","QLResult","showMessage","model","setModel","isUnlock","status","isBound","authAndChangeStatus","authCode","newMobile","transRes","result","newStatus","isSuccess","successTitle","handleDrawerConfirm","mobile","EDIT","APPLY","showSettingDrawer","isEdit","handleSwitchOnTrigger","CLOSE","settingInfo"],"sources":["C:/Users/allen/git/app2-webview/src/pages/T00300_NonDesignatedTransfer/T00300.js"],"sourcesContent":["/* eslint-disable no-unused-vars */\r\nimport { useDispatch } from 'react-redux';\r\nimport { useEffect, useState } from 'react';\r\n\r\n/* Elements */\r\nimport Layout from 'components/Layout/Layout';\r\nimport { FEIBSwitch, FEIBSwitchLabel } from 'components/elements';\r\nimport Accordion from 'components/Accordion';\r\nimport EditIcon from 'assets/images/icons/editIcon.svg';\r\nimport {\r\n  closeDrawer, showAnimationModal, showDrawer,\r\n} from 'utilities/MessageModal';\r\nimport { AuthCode } from 'utilities/TxnAuthCode';\r\nimport { setWaittingVisible } from 'stores/reducers/ModalReducer';\r\nimport { getQLStatus, transactionAuth } from 'utilities/AppScriptProxy';\r\nimport { useQLStatus } from 'hooks/useQLStatus';\r\nimport { getSettingInfo, changeStatus } from './api';\r\n\r\n/* Styles */\r\nimport { T00300Wrapper } from './T00300.style';\r\nimport T00300AccordionContent from './T00300_accordionContent';\r\nimport T00300DrawerContent from './T00300_drawerContent';\r\n\r\n/**\r\n * T00300 非約轉設定\r\n */\r\nconst T00300 = () => {\r\n  const dispatch = useDispatch();\r\n  const {QLResult, showMessage} = useQLStatus(); // 確認裝置綁定狀態(比照無卡提款設定)\r\n\r\n  const [model, setModel] = useState({});\r\n\r\n  const isUnlock = (model?.status !== '01'); // 表示已開通非約轉, '01'表示尚未開通\r\n  const isBound = (model?.status === '03'); // 表示已綁定非約轉手機號碼\r\n\r\n  const authAndChangeStatus = async (authCode, newMobile) => {\r\n    const transRes = await transactionAuth(authCode, newMobile);\r\n    if (transRes.result === true) {\r\n      const newStatus = await changeStatus(newMobile);\r\n      if (newStatus) {\r\n        model.status = newStatus;\r\n        setModel({...model}); // 更新畫面。\r\n\r\n        // 顯示成功畫面\r\n        await showAnimationModal({\r\n          isSuccess: true,\r\n          successTitle: '設定成功',\r\n        });\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n\r\n  /**\r\n   * Bottom Drawer 確認按鈕行為\r\n   * @param {Promise<String>} newMobile 新的綁定手機號碼。\r\n   */\r\n  const handleDrawerConfirm = async (newMobile) => {\r\n    let isSuccess;\r\n    if (isUnlock && model.status !== '04') {\r\n      if (newMobile !== model.mobile) {\r\n        isSuccess = await authAndChangeStatus(AuthCode.T00300.EDIT, newMobile); // status =03, 不變\r\n      }\r\n    } else {\r\n      isSuccess = await authAndChangeStatus(AuthCode.T00300.APPLY, newMobile); // status 由 01 變為 03\r\n    }\r\n\r\n    if (isSuccess) {\r\n      model.mobile = newMobile;\r\n      setModel({...model}); // 更新畫面。\r\n    }\r\n    closeDrawer();\r\n  };\r\n\r\n  /**\r\n   * 非約轉交易門號 Drawer\r\n   * @param {Promise<Boolean>} isEdit 表示可以修改非約轉交易門號。\r\n   */\r\n  const showSettingDrawer = async (isEdit) => {\r\n    await showDrawer(\r\n      '非約轉交易門號',\r\n      <T00300DrawerContent\r\n        readonly={!isEdit}\r\n        mobile={model.mobile}\r\n        onConfirm={handleDrawerConfirm}\r\n        onCancel={closeDrawer}\r\n      />,\r\n    );\r\n  };\r\n\r\n  /**\r\n   * 切換綁定狀態。\r\n   */\r\n  const handleSwitchOnTrigger = async () => {\r\n    if (QLResult) { // 點擊switch時檢查裝置綁定\r\n      if (!isBound) {\r\n        // 開通 or 申請+開通流程\r\n        // 若原狀態為 01.未開發 則表示第一次開通，只有此情況下不可變更綁定門號。\r\n        // 完成綁定門號開通後，status=3.已開通；之後的開關切換就是狀態3/4的互換。\r\n        showSettingDrawer(isUnlock); // status 由 01/04 變為 03.開通\r\n      } else {\r\n        /* 取消綁定(即：4.註銷) */\r\n        await authAndChangeStatus(AuthCode.T00300.CLOSE); // status 由 03 變為 04.註銷\r\n      }\r\n      setModel({...model}); // 更新畫面。\r\n    } else showMessage();\r\n  };\r\n\r\n  /**\r\n   * 取得初始資料\r\n   */\r\n  useEffect(async () => {\r\n    dispatch(setWaittingVisible(true));\r\n    const settingInfo = await getSettingInfo();\r\n    // if (settingInfo.status === ???) // TODO 那些狀態下就不能進行設定？\r\n    setModel(settingInfo);\r\n\r\n    dispatch(setWaittingVisible(false));\r\n  }, []);\r\n\r\n  return (\r\n    <Layout title=\"非約轉設定\">\r\n      <T00300Wrapper>\r\n        <div className=\"info_container\">\r\n          <div className=\"setting_switch\">\r\n            <FEIBSwitchLabel\r\n              control={(\r\n                <FEIBSwitch\r\n                  checked={isBound}\r\n                  onChange={handleSwitchOnTrigger}\r\n                />\r\n            )}\r\n              label=\"非約定轉帳設定\"\r\n            />\r\n          </div>\r\n\r\n          {/* 已開通非約轉功能則顯示電話號碼以及編輯按鈕 */}\r\n          {isBound && (\r\n          <div className=\"phone_number\">\r\n            <div className=\"text\">\r\n              <p>手機號碼</p>\r\n              <p className=\"mobile_number_text\">{model.mobile}</p>\r\n            </div>\r\n            {/* 未開通前，不可變更綁定的手機號碼 */}\r\n            {/* 暫時隱藏編輯按鈕 */}\r\n            {/* {isUnlock && (\r\n              <div className=\"edit\" onClick={() => showSettingDrawer(true)}>\r\n                <img src={EditIcon} alt=\"\" />\r\n              </div>\r\n            )} */}\r\n          </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* TODO: 使用條款內容確認 */}\r\n        <Accordion title=\"使用條款\" space=\"both\">\r\n          <T00300AccordionContent />\r\n        </Accordion>\r\n      </T00300Wrapper>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default T00300;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}