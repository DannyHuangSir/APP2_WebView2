{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useState}from'react';import{useHistory}from'react-router';import Layout from'components/Layout/Layout';import Accordion from'components/Accordion';import{FEIBSwitch}from'components/elements';import{startFunc,transactionAuth}from'utilities/AppScriptProxy';import{EditIcon}from'assets/images/icons';import{useDispatch}from'react-redux';import{setWaittingVisible}from'stores/reducers/ModalReducer';import{AuthCode}from'utilities/TxnAuthCode';import{FuncID}from'utilities/FuncID';import{showAnimationModal}from'utilities/MessageModal';import{getAccountsList}from'utilities/CacheData';import{useQLStatus}from'hooks/useQLStatus';import CardLessSettingWrapper from'./T00400.style';import{getStatus,activate}from'./api';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CardLessSetting=function CardLessSetting(){var dispatch=useDispatch();var history=useHistory();var _useQLStatus=useQLStatus(),QLResult=_useQLStatus.QLResult,showMessage=_useQLStatus.showMessage;// 確認裝置綁定狀態\nvar _useState=useState(),_useState2=_slicedToArray(_useState,2),cardLessStatus=_useState2[0],setCardLessStatus=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),account=_useState4[0],setAccount=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),isEnable=_useState6[0],setEnable=_useState6[1];useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var cardLessRes;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(setWaittingVisible(true));// 確認無卡提款開通狀態\n_context.next=3;return getStatus();case 3:cardLessRes=_context.sent;setCardLessStatus(cardLessRes);setEnable(cardLessRes==='2');// 取得母帳戶的資訊。\ngetAccountsList('M',function(accounts){return setAccount(accounts[0]);});dispatch(setWaittingVisible(false));case 8:case\"end\":return _context.stop();}}},_callee);})),[]);var handleSwitchClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var cwdStatus,_yield$transactionAut,result,activateRes;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!QLResult){_context2.next=21;break;}// 若已經綁定\ncwdStatus=cardLessStatus;if(!(cwdStatus==='0'||cwdStatus==='3'||cwdStatus==='4')){_context2.next=6;break;}// 跳轉設定無卡提款密碼頁\nhistory.push('/T004001');_context2.next=19;break;case 6:// 若是 1.已申請未開通 或是 2.已開通 狀態時需要先進行交易驗證\ndispatch(setWaittingVisible(true));_context2.next=9;return transactionAuth(AuthCode.T00400);case 9:_yield$transactionAut=_context2.sent;result=_yield$transactionAut.result;if(!result){_context2.next=18;break;}_context2.next=14;return activate('');case 14:activateRes=_context2.sent;showAnimationModal({isSuccess:!!activateRes,successTitle:'設定成功',errorTitle:'設定失敗',errorDesc:'設定失敗'});setCardLessStatus('2');setEnable(true);case 18:dispatch(setWaittingVisible(false));case 19:_context2.next=22;break;case 21:showMessage();case 22:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSwitchClick(){return _ref2.apply(this,arguments);};}();var handlePwdChange=function handlePwdChange(){return QLResult?startFunc(FuncID.D00400):showMessage();};return/*#__PURE__*/_jsx(Layout,{title:\"\\u7121\\u5361\\u63D0\\u6B3E\\u8A2D\\u5B9A\",children:/*#__PURE__*/_jsxs(CardLessSettingWrapper,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"controlContainer\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"switchContainer\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"labelContainer\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"labelTxt\",children:\"\\u7121\\u5361\\u63D0\\u6B3E\"}),isEnable&&/*#__PURE__*/_jsx(\"p\",{className:\"phoneNum\",children:account===null||account===void 0?void 0:account.accountNo})]}),/*#__PURE__*/_jsx(FEIBSwitch,{checked:isEnable,onClick:handleSwitchClick})]}),isEnable&&/*#__PURE__*/_jsxs(\"div\",{className:\"mainBlock toChangePwd\",onClick:handlePwdChange,children:[\"\\u8B8A\\u66F4\\u7121\\u5361\\u63D0\\u6B3E\\u5BC6\\u78BC\",/*#__PURE__*/_jsx(EditIcon,{})]})]}),/*#__PURE__*/_jsx(Accordion,{title:\"\\u6CE8\\u610F\\u4E8B\\u9805\",space:\"both\",children:/*#__PURE__*/_jsx(\"div\",{className:\"dealContent\",children:\"\\u7121\\u5361\\u63D0\\u6B3E\\u8A2D\\u5B9A\\u670D\\u52D9\\u689D\\u6B3E\"})})]})});};export default CardLessSetting;","map":{"version":3,"names":["useEffect","useState","useHistory","Layout","Accordion","FEIBSwitch","startFunc","transactionAuth","EditIcon","useDispatch","setWaittingVisible","AuthCode","FuncID","showAnimationModal","getAccountsList","useQLStatus","CardLessSettingWrapper","getStatus","activate","CardLessSetting","dispatch","history","QLResult","showMessage","cardLessStatus","setCardLessStatus","account","setAccount","isEnable","setEnable","cardLessRes","accounts","handleSwitchClick","cwdStatus","push","T00400","result","activateRes","isSuccess","successTitle","errorTitle","errorDesc","handlePwdChange","D00400","accountNo"],"sources":["C:/Users/allen/git/app2-webview/src/pages/T00400_CardLessSetting/T00400.js"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { useHistory } from 'react-router';\r\nimport Layout from 'components/Layout/Layout';\r\nimport Accordion from 'components/Accordion';\r\nimport { FEIBSwitch } from 'components/elements';\r\nimport { startFunc, transactionAuth } from 'utilities/AppScriptProxy';\r\nimport { EditIcon } from 'assets/images/icons';\r\n\r\nimport { useDispatch } from 'react-redux';\r\nimport { setWaittingVisible } from 'stores/reducers/ModalReducer';\r\nimport { AuthCode } from 'utilities/TxnAuthCode';\r\nimport { FuncID } from 'utilities/FuncID';\r\nimport { showAnimationModal } from 'utilities/MessageModal';\r\nimport { getAccountsList } from 'utilities/CacheData';\r\nimport { useQLStatus } from 'hooks/useQLStatus';\r\nimport CardLessSettingWrapper from './T00400.style';\r\n\r\nimport { getStatus, activate } from './api';\r\n\r\nconst CardLessSetting = () => {\r\n  const dispatch = useDispatch();\r\n  const history = useHistory();\r\n\r\n  const {QLResult, showMessage} = useQLStatus();// 確認裝置綁定狀態\r\n  const [cardLessStatus, setCardLessStatus] = useState();\r\n  const [account, setAccount] = useState();\r\n  const [isEnable, setEnable] = useState();\r\n\r\n  useEffect(async () => {\r\n    dispatch(setWaittingVisible(true));\r\n\r\n    // 確認無卡提款開通狀態\r\n    const cardLessRes = await getStatus();\r\n    setCardLessStatus(cardLessRes);\r\n    setEnable(cardLessRes === '2');\r\n\r\n    // 取得母帳戶的資訊。\r\n    getAccountsList('M', (accounts) => setAccount(accounts[0]));\r\n\r\n    dispatch(setWaittingVisible(false));\r\n  }, []);\r\n\r\n  const handleSwitchClick = async () => {\r\n    if (QLResult) {\r\n    // 若已經綁定\r\n      const cwdStatus = cardLessStatus;\r\n      if (cwdStatus === '0' || cwdStatus === '3' || cwdStatus === '4') {\r\n      // 跳轉設定無卡提款密碼頁\r\n        history.push('/T004001');\r\n      } else {\r\n      // 若是 1.已申請未開通 或是 2.已開通 狀態時需要先進行交易驗證\r\n        dispatch(setWaittingVisible(true));\r\n        const { result } = await transactionAuth(AuthCode.T00400);\r\n        if (result) {\r\n          const activateRes = await activate('');\r\n          showAnimationModal({\r\n            isSuccess: !!activateRes,\r\n            successTitle: '設定成功',\r\n            errorTitle: '設定失敗',\r\n            errorDesc: '設定失敗',\r\n          });\r\n\r\n          setCardLessStatus('2');\r\n          setEnable(true);\r\n        }\r\n        dispatch(setWaittingVisible(false));\r\n      }\r\n    } else showMessage();\r\n  };\r\n\r\n  const handlePwdChange = () => (QLResult ? startFunc(FuncID.D00400) : showMessage());\r\n\r\n  return (\r\n    <Layout title=\"無卡提款設定\">\r\n      <CardLessSettingWrapper>\r\n        <div className=\"controlContainer\">\r\n          <div className=\"switchContainer\">\r\n            <div className=\"labelContainer\">\r\n              <p className=\"labelTxt\">無卡提款</p>\r\n              {isEnable && <p className=\"phoneNum\">{account?.accountNo}</p>}\r\n            </div>\r\n            <FEIBSwitch checked={isEnable} onClick={handleSwitchClick} />\r\n          </div>\r\n          {isEnable && (\r\n            <div className=\"mainBlock toChangePwd\" onClick={handlePwdChange}>\r\n              變更無卡提款密碼\r\n              <EditIcon />\r\n            </div>\r\n          )}\r\n        </div>\r\n        <Accordion title=\"注意事項\" space=\"both\">\r\n          <div className=\"dealContent\">無卡提款設定服務條款</div>\r\n        </Accordion>\r\n      </CardLessSettingWrapper>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default CardLessSetting;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}