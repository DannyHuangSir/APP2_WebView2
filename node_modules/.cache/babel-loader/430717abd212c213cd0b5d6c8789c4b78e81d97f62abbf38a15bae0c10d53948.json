{"ast":null,"code":"import _objectSpread from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import{useHistory}from'react-router';import{customPopup,showDrawer,closeDrawer}from'utilities/MessageModal';import{closeFunc,startFunc}from'utilities/AppScriptProxy';/* Elements */import AddNewItem from'components/AddNewItem';import SettingItem from'components/SettingItem';import Layout from'components/Layout/Layout';import{FuncID}from'utilities/FuncID';import T00600ModifyForm from'./T00600_ModifyForm';import{fetchMobiles,fetchName}from'./api';/* Styles */import MobileTransferWrapper from'./T00600.style';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var T00600=function T00600(){var history=useHistory();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),mobileTransferData=_useState2[0],setMobileTransferData=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),mobilesList=_useState4[0],setMobilesList=_useState4[1];var _useState5=useState({mobile:'',account:'',status:'',isDefault:''}),_useState6=_slicedToArray(_useState5,2),modifyData=_useState6[0],setModifyData=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),otpMobileNum=_useState8[0],setOtpMobileNum=_useState8[1];// 新增手機號碼收款\nvar addMobileTransferSetting=function addMobileTransferSetting(){if(mobilesList.length===0){customPopup('系統訊息','您在本行留存的手機號碼皆已設定，請先取消， 再進行設定。');return;}history.push('/T006001',{otpMobileNum:otpMobileNum});};// 檢查是否設定快速登入、基本資料是否有手機號碼\nvar checkBindAndMobile=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$fetchMobiles,bindQuickLogin,bindTxnOtpMobile,bindings,mobiles,otpMobile;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetchMobiles({tokenStatus:1});case 2:_yield$fetchMobiles=_context.sent;bindQuickLogin=_yield$fetchMobiles.bindQuickLogin;bindTxnOtpMobile=_yield$fetchMobiles.bindTxnOtpMobile;bindings=_yield$fetchMobiles.bindings;mobiles=_yield$fetchMobiles.mobiles;otpMobile=_yield$fetchMobiles.otpMobile;setMobileTransferData(bindings||[]);setMobilesList(mobiles||[]);setOtpMobileNum(otpMobile);// 檢查是否綁定快速登入\nif(!(bindQuickLogin==='N')){_context.next=14;break;}customPopup('系統訊息','為符合手機號碼轉帳相關規範，請至設定>指紋辨識/臉部辨識/圖形密碼登入設定，進行快速登入綁定，造成不便，敬請見諒。',function(){return startFunc(FuncID.T00200);},closeFunc);return _context.abrupt(\"return\");case 14:if(!(bindTxnOtpMobile==='N')){_context.next=17;break;}customPopup('系統訊息','您尚未於本行留存手機號碼，請先前往「基本資料變更」頁留存，再進設定。',function(){return startFunc(FuncID.T00700);},closeFunc,'前往留存');return _context.abrupt(\"return\");case 17:if(bindings&&bindings.length===0){customPopup('系統訊息','您尚未設定「手機號碼收款」功能，是否立即進行設定？',function(){return history.push('/T006001',{otpMobileNum:otpMobile});},closeFunc);}case 18:case\"end\":return _context.stop();}}},_callee);}));return function checkBindAndMobile(){return _ref.apply(this,arguments);};}();// 刪除手機號碼收款\nvar deleteMobileTransferSetting=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(data){var _yield$fetchName,custName;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetchName();case 2:_yield$fetchName=_context2.sent;custName=_yield$fetchName.custName;history.push('/T006002',{type:'delete',isModify:true,data:_objectSpread({userName:custName||''},data)});case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function deleteMobileTransferSetting(_x){return _ref2.apply(this,arguments);};}();// 關閉變更 drawer\nvar handleCloseDrawer=function handleCloseDrawer(){closeDrawer();};// 編輯手機號碼收款\nvar editMobileTransferSetting=function editMobileTransferSetting(data){setModifyData(data);showDrawer('手機號碼收款變更',/*#__PURE__*/_jsx(T00600ModifyForm,{modifyData:modifyData,onClose:handleCloseDrawer}));};// render 已設定的手機號碼收款項目\nvar renderMobileTransferItems=function renderMobileTransferItems(){return mobileTransferData.map(function(item){return/*#__PURE__*/_jsx(SettingItem,{mainLable:item.mobile,subLabel:\"\".concat(item.isDefault?'預設收款帳戶':'非預設收款帳戶',\" \").concat(item.account),editClick:function editClick(){return editMobileTransferSetting(item);},deleteClick:function deleteClick(){return deleteMobileTransferSetting(item);}},item.mobile);});};useEffect(function(){checkBindAndMobile();},[]);return/*#__PURE__*/_jsx(Layout,{title:\"\\u624B\\u6A5F\\u865F\\u78BC\\u6536\\u6B3E\\u8A2D\\u5B9A\",children:/*#__PURE__*/_jsxs(MobileTransferWrapper,{className:\"settingListContainer\",children:[/*#__PURE__*/_jsx(AddNewItem,{onClick:addMobileTransferSetting,addLabel:\"\\u65B0\\u589E\\u624B\\u6A5F\\u865F\\u78BC\\u6536\\u6B3E\\u8A2D\\u5B9A\"}),renderMobileTransferItems()]})});};export default T00600;","map":{"version":3,"names":["useState","useEffect","useHistory","customPopup","showDrawer","closeDrawer","closeFunc","startFunc","AddNewItem","SettingItem","Layout","FuncID","T00600ModifyForm","fetchMobiles","fetchName","MobileTransferWrapper","T00600","history","mobileTransferData","setMobileTransferData","mobilesList","setMobilesList","mobile","account","status","isDefault","modifyData","setModifyData","otpMobileNum","setOtpMobileNum","addMobileTransferSetting","length","push","checkBindAndMobile","tokenStatus","bindQuickLogin","bindTxnOtpMobile","bindings","mobiles","otpMobile","T00200","T00700","deleteMobileTransferSetting","data","custName","type","isModify","userName","handleCloseDrawer","editMobileTransferSetting","renderMobileTransferItems","map","item"],"sources":["C:/Users/allen/git/app2-webview/src/pages/T00600_MobileTransfer/T00600.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useHistory } from 'react-router';\r\nimport { customPopup, showDrawer, closeDrawer } from 'utilities/MessageModal';\r\nimport { closeFunc, startFunc } from 'utilities/AppScriptProxy';\r\n\r\n/* Elements */\r\nimport AddNewItem from 'components/AddNewItem';\r\nimport SettingItem from 'components/SettingItem';\r\nimport Layout from 'components/Layout/Layout';\r\nimport { FuncID } from 'utilities/FuncID';\r\nimport T00600ModifyForm from './T00600_ModifyForm';\r\n\r\nimport { fetchMobiles, fetchName } from './api';\r\n\r\n/* Styles */\r\nimport MobileTransferWrapper from './T00600.style';\r\n\r\nconst T00600 = () => {\r\n  const history = useHistory();\r\n\r\n  const [mobileTransferData, setMobileTransferData] = useState([]);\r\n  const [mobilesList, setMobilesList] = useState([]);\r\n  const [modifyData, setModifyData] = useState({\r\n    mobile: '',\r\n    account: '',\r\n    status: '',\r\n    isDefault: '',\r\n  });\r\n  const [otpMobileNum, setOtpMobileNum] = useState('');\r\n  // 新增手機號碼收款\r\n  const addMobileTransferSetting = () => {\r\n    if (mobilesList.length === 0) {\r\n      customPopup(\r\n        '系統訊息',\r\n        '您在本行留存的手機號碼皆已設定，請先取消， 再進行設定。',\r\n      );\r\n      return;\r\n    }\r\n    history.push('/T006001', { otpMobileNum });\r\n  };\r\n\r\n  // 檢查是否設定快速登入、基本資料是否有手機號碼\r\n  const checkBindAndMobile = async () => {\r\n    const {\r\n      bindQuickLogin, bindTxnOtpMobile, bindings, mobiles, otpMobile,\r\n    } = await fetchMobiles({ tokenStatus: 1 });\r\n    setMobileTransferData(bindings || []);\r\n    setMobilesList(mobiles || []);\r\n    setOtpMobileNum(otpMobile);\r\n    // 檢查是否綁定快速登入\r\n    if (bindQuickLogin === 'N') {\r\n      customPopup(\r\n        '系統訊息',\r\n        '為符合手機號碼轉帳相關規範，請至設定>指紋辨識/臉部辨識/圖形密碼登入設定，進行快速登入綁定，造成不便，敬請見諒。',\r\n        () => startFunc(FuncID.T00200),\r\n        closeFunc,\r\n      );\r\n      return;\r\n    }\r\n    // 檢查是否留存手機號碼\r\n    if (bindTxnOtpMobile === 'N') {\r\n      customPopup(\r\n        '系統訊息',\r\n        '您尚未於本行留存手機號碼，請先前往「基本資料變更」頁留存，再進設定。',\r\n        () => startFunc(FuncID.T00700),\r\n        closeFunc,\r\n        '前往留存',\r\n      );\r\n      return;\r\n    }\r\n    if (bindings && bindings.length === 0) {\r\n      customPopup(\r\n        '系統訊息',\r\n        '您尚未設定「手機號碼收款」功能，是否立即進行設定？',\r\n        () => history.push('/T006001', { otpMobileNum: otpMobile }),\r\n        closeFunc,\r\n      );\r\n    }\r\n  };\r\n\r\n  // 刪除手機號碼收款\r\n  const deleteMobileTransferSetting = async (data) => {\r\n    const { custName } = await fetchName();\r\n    history.push(\r\n      '/T006002',\r\n      {\r\n        type: 'delete',\r\n        isModify: true,\r\n        data: {\r\n          userName: custName || '',\r\n          ...data,\r\n        },\r\n      },\r\n    );\r\n  };\r\n\r\n  // 關閉變更 drawer\r\n  const handleCloseDrawer = () => {\r\n    closeDrawer();\r\n  };\r\n\r\n  // 編輯手機號碼收款\r\n  const editMobileTransferSetting = (data) => {\r\n    setModifyData(data);\r\n    showDrawer(\r\n      '手機號碼收款變更',\r\n      <T00600ModifyForm modifyData={modifyData} onClose={handleCloseDrawer} />,\r\n    );\r\n  };\r\n\r\n  // render 已設定的手機號碼收款項目\r\n  const renderMobileTransferItems = () => mobileTransferData\r\n    .map((item) => (\r\n      <SettingItem\r\n        key={item.mobile}\r\n        mainLable={item.mobile}\r\n        subLabel={`${item.isDefault ? '預設收款帳戶' : '非預設收款帳戶'} ${item.account}`}\r\n        editClick={() => editMobileTransferSetting(item)}\r\n        deleteClick={() => deleteMobileTransferSetting(item)}\r\n      />\r\n    ));\r\n\r\n  useEffect(() => {\r\n    checkBindAndMobile();\r\n  }, []);\r\n\r\n  return (\r\n    <Layout title=\"手機號碼收款設定\">\r\n      <MobileTransferWrapper className=\"settingListContainer\">\r\n        <AddNewItem onClick={addMobileTransferSetting} addLabel=\"新增手機號碼收款設定\" />\r\n        { renderMobileTransferItems() }\r\n      </MobileTransferWrapper>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default T00600;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}