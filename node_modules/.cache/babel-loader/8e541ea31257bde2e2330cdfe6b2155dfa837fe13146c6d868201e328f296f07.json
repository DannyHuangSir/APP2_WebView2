{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/* eslint-disable */import React,{useEffect,useRef,useState,useMemo}from'react';import{useForm}from'react-hook-form';import BottomAction from'components/BottomAction';import SnackModal from'components/SnackModal';import{FEIBTab,FEIBTabContext,FEIBTabList}from'components/elements';import{showCustomPrompt}from'utilities/MessageModal';import{yupResolver}from'@hookform/resolvers/yup';import{setModalVisible,setWaittingVisible}from'stores/reducers/ModalReducer';import{useDispatch}from'react-redux';import{DropdownField}from'components/Fields';import{FuncID}from'utilities/FuncID';import{getFavoriteSettingList,modifyFavoriteItem,deleteFavoriteItem}from'./api';import{CustomCheckBoxField}from'./fields/customCheckboxField';import{calcSelectedLength,extractGroupItems,generateReorderList,findExistedValue,generateTrimmedList,cardLessOptions}from'./utils';import{validationSchema}from'./validationSchema';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Favorite2New=function Favorite2New(_ref){var favoriteList=_ref.favoriteList,updateFavoriteList=_ref.updateFavoriteList,back2MyFavorite=_ref.back2MyFavorite,isEditAction=_ref.isEditAction;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),favoriteSettingList=_useState2[0],setFavoriteSettingList=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),initialValues=_useState4[0],setInitialValues=_useState4[1];var _useState5=useState('C'),_useState6=_slicedToArray(_useState5,2),tabId=_useState6[0],setTabId=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),showTip=_useState8[0],setShowTip=_useState8[1];var sectionsRef=useRef([]);var mainContentRef=useRef();var dispatch=useDispatch();var trueArray=useMemo(function(){return{checkedArray:[]};},[]);// for real-time update checked item length \nvar _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),checkedArrayLength=_useState10[0],setcheckedArrayLength=_useState10[1];useEffect(function(){setcheckedArrayLength(trueArray.checkedArray.length);});// record the already checked items that before enter edit page\nvar alreadyCheckedItemBeforeEdit=useMemo(function(){return[];},[]);useEffect(function(){// console.log('======== favoriteList========');\n// console.log(favoriteList);\n// console.log('=============================');\nfavoriteList.map(function(obj,index){alreadyCheckedItemBeforeEdit.push(obj['actKey']);});// console.log('======== alreadyCheckedItemBeforeEdit ===========');\n// console.log(alreadyCheckedItemBeforeEdit);\n// console.log('=================================================');\n},[]);// 我的最愛表單\nvar _useForm=useForm(),control=_useForm.control,watch=_useForm.watch,reset=_useForm.reset,handleSubmit=_useForm.handleSubmit;var watchedValues=watch('editedBlockList');var selectedLength=useMemo(function(){return calcSelectedLength(watchedValues);},[watchedValues]);// 無卡提款表單\nvar _useForm2=useForm({defaultValues:{cardLessCredit:''},resolver:yupResolver(validationSchema)}),cardLessControl=_useForm2.control,cardLessHandleSubmit=_useForm2.handleSubmit;// 已選取 10 項不可被選取 & 新增模式下僅能選取未被加入的選項\nvar checkDisabled=function checkDisabled(key){var alreadyExisted=findExistedValue(initialValues,key);var isSelected=findExistedValue(watchedValues,key);var isMaximum=selectedLength>=10;if(isEditAction){if(isMaximum&&!isSelected)return true;// 編輯模式: 超出數量無法被選取\nreturn false;}if(alreadyExisted)return true;// 新增模式: 項目若已存在於 initialValues，需要被 disabled\nreturn false;};var patchAndRedirect=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var patchedList,_args=arguments;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:patchedList=_args.length>0&&_args[0]!==undefined?_args[0]:[];dispatch(setWaittingVisible(true));/* for debug    \r\n    console.log('================= checked items =====================');\r\n    console.log(trueArray.checkedArray);\r\n    console.log('=====================================================');\r\n\r\n    console.log('========== already checked items before edit ========');\r\n    console.log(alreadyCheckedItemBeforeEdit);\r\n    console.log('=====================================================');\r\n    */ // reset all items, skip 2 default items\nalreadyCheckedItemBeforeEdit.shift();alreadyCheckedItemBeforeEdit.shift();_context.next=6;return Promise.all(alreadyCheckedItemBeforeEdit.map(function(actKey,position){return deleteFavoriteItem(actKey);}));case 6:_context.next=8;return Promise.all(trueArray.checkedArray.map(function(actKey,position){return modifyFavoriteItem({actKey:actKey,position:parseInt(position,10)});}));case 8:_context.next=10;return updateFavoriteList();case 10:dispatch(setWaittingVisible(false));back2MyFavorite();case 12:case\"end\":return _context.stop();}}},_callee);}));return function patchAndRedirect(){return _ref2.apply(this,arguments);};}();// 編輯完成送出表單\nvar onSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(_ref3){var editedBlockList,tmp,_i,_Object$entries,_Object$entries$_i,key,value,orderedList,trimmedList,alreadyExistedCardLess;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:editedBlockList=_ref3.editedBlockList;/* for debug  \r\n    console.log('=========== for debug ==================');\r\n    console.log(JSON.stringify(trueArray.checkedArray));\r\n    console.log(JSON.stringify(favoriteList));\r\n    console.log(JSON.stringify(editedBlockList));\r\n    console.log('========================================');\r\n    */ // generate new editedBlockList\ntmp={};for(_i=0,_Object$entries=Object.entries(editedBlockList);_i<_Object$entries.length;_i++){_Object$entries$_i=_slicedToArray(_Object$entries[_i],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1];tmp[key]=trueArray.checkedArray.indexOf(key)===-1?false:true;}editedBlockList=JSON.parse(JSON.stringify(tmp));orderedList=generateReorderList(favoriteList,editedBlockList);trimmedList=generateTrimmedList(orderedList,10,'');// 應該從 cardLess API 得知是否已有設定值，並以此決定是否要設置無卡提款\n// 目前尚未拿到 cardless API，先透過是否已經存在無卡提款服務來避開\nalreadyExistedCardLess=findExistedValue(initialValues,FuncID.D00300);if(!(trimmedList.includes(FuncID.D00300)&&!alreadyExistedCardLess)){_context3.next=12;break;}_context3.next=10;return showCustomPrompt({title:'無卡提款',message:/*#__PURE__*/_jsx(DropdownField,{options:cardLessOptions,labelName:\"\\u5FEB\\u901F\\u63D0\\u9818\\u91D1\\u984D\",name:\"cardLessCredit\",control:cardLessControl}),onOk:cardLessHandleSubmit(/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(values){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log('values',values);// 待 無卡提款設定 API 開發完畢\ndispatch(setModalVisible(false));// patchAndRedirect(trimmedList); //原寫法棄用\npatchAndRedirect();case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref5.apply(this,arguments);};}()),onClose:function onClose(){if(isEditAction)return;reset({editedBlockList:initialValues});// 新增模式情況下，按下 X 按鈕時需要取消勾選\n},noDismiss:true});case 10:_context3.next=13;break;case 12:// patchAndRedirect(trimmedList); //原寫法棄用\npatchAndRedirect();case 13:case\"end\":return _context3.stop();}}},_callee3);}));return function onSubmit(_x){return _ref4.apply(this,arguments);};}();// 點擊 tab 時\nvar handleChangeTabs=function handleChangeTabs(_,value){var scrollTarget=sectionsRef.current.find(function(el){return el.className===value;});scrollTarget.scrollIntoView();var _mainContentRef$curre=mainContentRef.current,scrollHeight=_mainContentRef$curre.scrollHeight,scrollTop=_mainContentRef$curre.scrollTop,offsetHeight=_mainContentRef$curre.offsetHeight;if(scrollHeight-(scrollTop+offsetHeight)<=1){setTabId(value);}};var handleScrollContent=function handleScrollContent(event){var _event$target=event.target,scrollHeight=_event$target.scrollHeight,scrollTop=_event$target.scrollTop,offsetHeight=_event$target.offsetHeight;if(!(scrollHeight-(scrollTop+offsetHeight)<=1)){var foundSection=sectionsRef.current.find(function(el){var top=el.offsetTop-1;var bottom=el.offsetTop+el.offsetHeight;return scrollTop>=top&&scrollTop<bottom;});if(foundSection&&foundSection.className!==tabId)setTabId(foundSection.className);}};var renderBlockGroup=function renderBlockGroup(){return favoriteSettingList.map(function(_ref6,index){var groupKey=_ref6.groupKey,groupName=_ref6.groupName,items=_ref6.items;return/*#__PURE__*/_jsxs(\"section\",{ref:function ref(el){sectionsRef.current[index]=el;},className:groupKey,children:[/*#__PURE__*/_jsx(\"h3\",{className:\"title\",children:groupName}),/*#__PURE__*/_jsx(\"div\",{className:\"blockGroup\",children:items.map(function(_ref7){var actKey=_ref7.actKey,name=_ref7.name;return/*#__PURE__*/_jsx(CustomCheckBoxField,{control:control,name:\"editedBlockList.\".concat(actKey),defaultValue:false,label:name,disabled:checkDisabled(actKey),immdlySubmit:handleSubmit(onSubmit),isEditAction:isEditAction,setShowTip:setShowTip,checkedArray:trueArray.checkedArray,actKey:actKey,changeCallback:function changeCallback(checkedSize){setcheckedArrayLength(checkedSize);}},actKey);})})]},groupKey);});};var renderTabList=function renderTabList(){return favoriteSettingList.map(function(group){return/*#__PURE__*/_jsx(FEIBTab,{label:group.groupName,value:group.groupKey},group.groupKey);});};// 拿取 favoriteSettingList\nuseEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){var res;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return getFavoriteSettingList();case 3:res=_context4.sent;if(Array.isArray(res)&&res!==null&&res!==void 0&&res.length)setFavoriteSettingList(res);_context4.next=10;break;case 7:_context4.prev=7;_context4.t0=_context4[\"catch\"](0);console.log('編輯我的最愛 err',_context4.t0);case 10:case\"end\":return _context4.stop();}}},_callee4,null,[[0,7]]);})),[]);//  當 Tip 出現後 1 秒將其取消\nuseEffect(function(){var timer=null;if(showTip)timer=setTimeout(function(){return setShowTip(false);},1000);return function(){return clearTimeout(timer);};},[showTip]);// 更新 react-hook-form 的 defaultValues\nuseEffect(function(){if(!favoriteSettingList.length)return;var initValue=extractGroupItems(favoriteSettingList);for(var key in initValue){if(initValue[key]){trueArray.checkedArray.push(key);}}/* for debug\r\n    console.log('======================');\r\n    console.log(JSON.stringify(initValue));\r\n    console.log(JSON.stringify(trueArray.checkedArray));\r\n    console.log('======================');\r\n    */setInitialValues(initValue);reset({editedBlockList:initValue});},[favoriteSettingList]);return/*#__PURE__*/_jsxs(\"div\",{className:\"editFavoritePage\",children:[/*#__PURE__*/_jsx(FEIBTabContext,{value:tabId,children:/*#__PURE__*/_jsx(FEIBTabList,{$size:\"small\",onChange:handleChangeTabs,children:renderTabList()})}),/*#__PURE__*/_jsx(\"div\",{className:\"tipArea\",children:/*#__PURE__*/_jsx(\"p\",{children:\"\".concat(isEditAction?'您最多可以選取10項服務':'請選取1項服務',\"\\u52A0\\u5165\\u6211\\u7684\\u6700\\u611B!\")})}),/*#__PURE__*/_jsxs(\"form\",{className:\"mainContent\",ref:mainContentRef,onScroll:handleScrollContent,children:[renderBlockGroup(),/*#__PURE__*/ // isEditAction && \n_jsx(BottomAction,{position:0,children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{cursor:'pointer'},onClick:handleSubmit(onSubmit),children:\"\\u7DE8\\u8F2F\\u5B8C\\u6210(\".concat(checkedArrayLength,\")\")})})]}),showTip&&/*#__PURE__*/_jsx(SnackModal,{text:\"\\u6700\\u611B\\u5DF2\\u9078\\u6EFF\"})]});};export default Favorite2New;","map":{"version":3,"names":["React","useEffect","useRef","useState","useMemo","useForm","BottomAction","SnackModal","FEIBTab","FEIBTabContext","FEIBTabList","showCustomPrompt","yupResolver","setModalVisible","setWaittingVisible","useDispatch","DropdownField","FuncID","getFavoriteSettingList","modifyFavoriteItem","deleteFavoriteItem","CustomCheckBoxField","calcSelectedLength","extractGroupItems","generateReorderList","findExistedValue","generateTrimmedList","cardLessOptions","validationSchema","Favorite2New","favoriteList","updateFavoriteList","back2MyFavorite","isEditAction","favoriteSettingList","setFavoriteSettingList","initialValues","setInitialValues","tabId","setTabId","showTip","setShowTip","sectionsRef","mainContentRef","dispatch","trueArray","checkedArray","checkedArrayLength","setcheckedArrayLength","length","alreadyCheckedItemBeforeEdit","map","obj","index","push","control","watch","reset","handleSubmit","watchedValues","selectedLength","defaultValues","cardLessCredit","resolver","cardLessControl","cardLessHandleSubmit","checkDisabled","key","alreadyExisted","isSelected","isMaximum","patchAndRedirect","patchedList","shift","Promise","all","actKey","position","parseInt","onSubmit","editedBlockList","tmp","Object","entries","value","indexOf","JSON","parse","stringify","orderedList","trimmedList","alreadyExistedCardLess","D00300","includes","title","message","onOk","values","console","log","onClose","noDismiss","handleChangeTabs","_","scrollTarget","current","find","el","className","scrollIntoView","scrollHeight","scrollTop","offsetHeight","handleScrollContent","event","target","foundSection","top","offsetTop","bottom","renderBlockGroup","groupKey","groupName","items","name","checkedSize","renderTabList","group","res","Array","isArray","timer","setTimeout","clearTimeout","initValue","cursor"],"sources":["C:/Users/allen/git/app2-webview/src/pages/S00100_Favorite/S00100_1.js"],"sourcesContent":["/* eslint-disable */\r\nimport React, {\r\n  useEffect, useRef, useState, useMemo,\r\n} from 'react';\r\nimport { useForm } from 'react-hook-form';\r\nimport BottomAction from 'components/BottomAction';\r\nimport SnackModal from 'components/SnackModal';\r\nimport {\r\n  FEIBTab, FEIBTabContext, FEIBTabList,\r\n} from 'components/elements';\r\nimport { showCustomPrompt } from 'utilities/MessageModal';\r\nimport { yupResolver } from '@hookform/resolvers/yup';\r\nimport { setModalVisible, setWaittingVisible } from 'stores/reducers/ModalReducer';\r\nimport { useDispatch } from 'react-redux';\r\nimport { DropdownField } from 'components/Fields';\r\nimport { FuncID } from 'utilities/FuncID';\r\nimport { getFavoriteSettingList, modifyFavoriteItem, deleteFavoriteItem } from './api';\r\nimport { CustomCheckBoxField } from './fields/customCheckboxField';\r\nimport {\r\n  calcSelectedLength, extractGroupItems, generateReorderList, findExistedValue, generateTrimmedList, cardLessOptions,\r\n} from './utils';\r\nimport { validationSchema } from './validationSchema';\r\n\r\nconst Favorite2New = ({\r\n  favoriteList, updateFavoriteList, back2MyFavorite, isEditAction,\r\n}) => {\r\n  const [favoriteSettingList, setFavoriteSettingList] = useState([]);\r\n  const [initialValues, setInitialValues] = useState({});\r\n  const [tabId, setTabId] = useState('C');\r\n  const [showTip, setShowTip] = useState(false);\r\n  const sectionsRef = useRef([]);\r\n  const mainContentRef = useRef();\r\n  const dispatch = useDispatch();\r\n\r\n  const trueArray = useMemo(() => ({ checkedArray: [] }), []);\r\n\r\n  // for real-time update checked item length \r\n  const [checkedArrayLength, setcheckedArrayLength] = useState(0);\r\n  useEffect(() => {\r\n    \r\n    setcheckedArrayLength(trueArray.checkedArray.length);\r\n  });\r\n\r\n  // record the already checked items that before enter edit page\r\n  const alreadyCheckedItemBeforeEdit = useMemo(() => ([]), []);\r\n  useEffect(() => {\r\n\r\n    // console.log('======== favoriteList========');\r\n    // console.log(favoriteList);\r\n    // console.log('=============================');\r\n\r\n\r\n    favoriteList.map((obj, index) => {\r\n\r\n          alreadyCheckedItemBeforeEdit.push(obj['actKey']);\r\n    });\r\n    \r\n    // console.log('======== alreadyCheckedItemBeforeEdit ===========');\r\n    // console.log(alreadyCheckedItemBeforeEdit);\r\n    // console.log('=================================================');\r\n  }, []);\r\n\r\n  // 我的最愛表單\r\n  const {\r\n    control, watch, reset, handleSubmit,\r\n  } = useForm();\r\n  const watchedValues = watch('editedBlockList');\r\n  const selectedLength = useMemo(() => calcSelectedLength(watchedValues), [watchedValues]);\r\n\r\n  // 無卡提款表單\r\n  const {\r\n    control: cardLessControl,\r\n    handleSubmit: cardLessHandleSubmit,\r\n  } = useForm({ defaultValues: {cardLessCredit: ''}, resolver: yupResolver(validationSchema) });\r\n\r\n  // 已選取 10 項不可被選取 & 新增模式下僅能選取未被加入的選項\r\n  const checkDisabled = (key) => {\r\n    const alreadyExisted = findExistedValue(initialValues, key);\r\n    const isSelected = findExistedValue(watchedValues, key);\r\n    const isMaximum = selectedLength >= 10;\r\n    if (isEditAction) {\r\n      if (isMaximum && !isSelected) return true; // 編輯模式: 超出數量無法被選取\r\n      return false;\r\n    }\r\n    if (alreadyExisted) return true; // 新增模式: 項目若已存在於 initialValues，需要被 disabled\r\n    return false;\r\n  };\r\n\r\n  const patchAndRedirect = async (patchedList=[]) => {\r\n    dispatch(setWaittingVisible(true));\r\n\r\n    /* for debug    \r\n    console.log('================= checked items =====================');\r\n    console.log(trueArray.checkedArray);\r\n    console.log('=====================================================');\r\n\r\n    console.log('========== already checked items before edit ========');\r\n    console.log(alreadyCheckedItemBeforeEdit);\r\n    console.log('=====================================================');\r\n    */\r\n\r\n    // reset all items, skip 2 default items\r\n    alreadyCheckedItemBeforeEdit.shift();\r\n    alreadyCheckedItemBeforeEdit.shift();\r\n    await Promise.all(\r\n      alreadyCheckedItemBeforeEdit.map((actKey, position) => {\r\n \r\n          return deleteFavoriteItem(actKey);\r\n      }),\r\n    );\r\n\r\n    // re-add all checked items\r\n    await Promise.all(\r\n      trueArray.checkedArray.map((actKey, position) => {\r\n\r\n            return modifyFavoriteItem({ actKey, position: parseInt(position, 10) })\r\n      }),\r\n    );\r\n\r\n    // refresh list\r\n    await updateFavoriteList();\r\n\r\n    dispatch(setWaittingVisible(false));\r\n    back2MyFavorite();\r\n  };\r\n\r\n  // 編輯完成送出表單\r\n  const onSubmit = async ({ editedBlockList }) => {\r\n\r\n    /* for debug  \r\n    console.log('=========== for debug ==================');\r\n    console.log(JSON.stringify(trueArray.checkedArray));\r\n    console.log(JSON.stringify(favoriteList));\r\n    console.log(JSON.stringify(editedBlockList));\r\n    console.log('========================================');\r\n    */\r\n\r\n    // generate new editedBlockList\r\n    const tmp = {}; \r\n    for (const [key, value] of Object.entries(editedBlockList)) {\r\n      tmp[key] = (trueArray.checkedArray.indexOf(key) === -1 ) ? false : true;\r\n    }\r\n    editedBlockList = JSON.parse(JSON.stringify(tmp));\r\n\r\n\r\n    const orderedList = generateReorderList(favoriteList, editedBlockList);\r\n    const trimmedList = generateTrimmedList(orderedList, 10, '');\r\n    // 應該從 cardLess API 得知是否已有設定值，並以此決定是否要設置無卡提款\r\n    // 目前尚未拿到 cardless API，先透過是否已經存在無卡提款服務來避開\r\n    const alreadyExistedCardLess = findExistedValue(initialValues, FuncID.D00300);\r\n    if (trimmedList.includes(FuncID.D00300) && !alreadyExistedCardLess) {\r\n      await showCustomPrompt({\r\n        title: '無卡提款',\r\n        message: (\r\n          <DropdownField\r\n            options={cardLessOptions}\r\n            labelName=\"快速提領金額\"\r\n            name=\"cardLessCredit\"\r\n            control={cardLessControl}\r\n          />\r\n        ),\r\n        onOk: cardLessHandleSubmit(async (values) => {\r\n          console.log('values', values); // 待 無卡提款設定 API 開發完畢\r\n          dispatch(setModalVisible(false));\r\n\r\n          // patchAndRedirect(trimmedList); //原寫法棄用\r\n          patchAndRedirect();\r\n        }),\r\n        onClose: () => {\r\n          if (isEditAction) return;\r\n          reset({editedBlockList: initialValues}); // 新增模式情況下，按下 X 按鈕時需要取消勾選\r\n        },\r\n        noDismiss: true,\r\n      });\r\n    } else {\r\n\r\n      // patchAndRedirect(trimmedList); //原寫法棄用\r\n      patchAndRedirect();\r\n    }\r\n  };\r\n\r\n  // 點擊 tab 時\r\n  const handleChangeTabs = (_, value) => {\r\n    const scrollTarget = sectionsRef.current.find((el) => el.className === value);\r\n    scrollTarget.scrollIntoView();\r\n    const { scrollHeight, scrollTop, offsetHeight } = mainContentRef.current;\r\n    if ((scrollHeight - (scrollTop + offsetHeight) <= 1)) {\r\n      setTabId(value);\r\n    }\r\n  };\r\n\r\n  const handleScrollContent = (event) => {\r\n    const { scrollHeight, scrollTop, offsetHeight } = event.target;\r\n\r\n    if (!(scrollHeight - (scrollTop + offsetHeight) <= 1)) {\r\n      const foundSection = sectionsRef.current.find((el) => {\r\n        const top = el.offsetTop - 1;\r\n        const bottom = el.offsetTop + el.offsetHeight;\r\n        return (scrollTop >= top && scrollTop < bottom);\r\n      });\r\n      if (foundSection && foundSection.className !== tabId) setTabId(foundSection.className);\r\n    }\r\n  };\r\n\r\n  const renderBlockGroup = () => favoriteSettingList.map(({groupKey, groupName, items}, index) => (\r\n    <section\r\n      ref={(el) => { sectionsRef.current[index] = el; }}\r\n      key={groupKey}\r\n      className={groupKey}\r\n    >\r\n      <h3 className=\"title\">{groupName}</h3>\r\n      <div className=\"blockGroup\">\r\n        {items.map(({actKey, name}) => (\r\n          <CustomCheckBoxField\r\n            key={actKey}\r\n            control={control}\r\n            name={`editedBlockList.${actKey}`}\r\n            defaultValue={false}\r\n            label={name}\r\n            disabled={checkDisabled(actKey)}\r\n            immdlySubmit={handleSubmit(onSubmit)}\r\n            isEditAction={isEditAction}\r\n            setShowTip={setShowTip}\r\n            checkedArray={trueArray.checkedArray}\r\n            actKey={actKey}\r\n            changeCallback={(checkedSize) => {setcheckedArrayLength(checkedSize)}}\r\n          />\r\n        ))}\r\n      </div>\r\n    </section>\r\n  ));\r\n\r\n  const renderTabList = () => favoriteSettingList.map((group) => (\r\n    <FEIBTab key={group.groupKey} label={group.groupName} value={group.groupKey} />\r\n  ));\r\n\r\n  // 拿取 favoriteSettingList\r\n  useEffect(async () => {\r\n    try {\r\n      const res = await getFavoriteSettingList();\r\n      if (Array.isArray(res) && res?.length) setFavoriteSettingList(res);\r\n    } catch (err) {\r\n      console.log('編輯我的最愛 err', err);\r\n    }\r\n  }, []);\r\n\r\n  //  當 Tip 出現後 1 秒將其取消\r\n  useEffect(() => {\r\n    let timer = null;\r\n    if (showTip) timer = setTimeout(() => setShowTip(false), 1000);\r\n    return () => clearTimeout(timer);\r\n  }, [showTip]);\r\n\r\n  // 更新 react-hook-form 的 defaultValues\r\n  useEffect(() => {\r\n    if (!favoriteSettingList.length) return;\r\n    const initValue = extractGroupItems(favoriteSettingList);\r\n\r\n    for (const key in initValue) {\r\n      if (initValue[key]) {\r\n        trueArray.checkedArray.push(key);\r\n      }\r\n    }\r\n\r\n    /* for debug\r\n    console.log('======================');\r\n    console.log(JSON.stringify(initValue));\r\n    console.log(JSON.stringify(trueArray.checkedArray));\r\n    console.log('======================');\r\n    */\r\n\r\n    setInitialValues(initValue);\r\n    reset({editedBlockList: initValue});\r\n  }, [favoriteSettingList]);\r\n\r\n  return (\r\n    <div className=\"editFavoritePage\">\r\n      <FEIBTabContext value={tabId}>\r\n        <FEIBTabList $size=\"small\" onChange={handleChangeTabs}>\r\n          { renderTabList() }\r\n        </FEIBTabList>\r\n      </FEIBTabContext>\r\n\r\n      <div className=\"tipArea\">\r\n        <p>{`${isEditAction ? '您最多可以選取10項服務' : '請選取1項服務'}加入我的最愛!`}</p>\r\n      </div>\r\n\r\n      <form\r\n        className=\"mainContent\"\r\n        ref={mainContentRef}\r\n        onScroll={handleScrollContent}\r\n      >\r\n        {renderBlockGroup()}\r\n        {\r\n          // isEditAction && \r\n          (\r\n          <BottomAction position={0}>\r\n            <button\r\n              type=\"button\"\r\n              style={{ cursor: 'pointer' }}\r\n              onClick={handleSubmit(onSubmit)}\r\n            >\r\n              {`編輯完成(${checkedArrayLength})`}\r\n            </button>\r\n          </BottomAction>\r\n        )}\r\n      </form>\r\n      { showTip && <SnackModal text=\"最愛已選滿\" /> }\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Favorite2New;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}