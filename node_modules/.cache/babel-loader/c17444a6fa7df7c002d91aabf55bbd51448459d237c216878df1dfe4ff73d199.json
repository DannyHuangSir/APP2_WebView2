{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/* eslint-disable no-unused-vars */import{useState,useEffect,useRef}from'react';import Avatar from'components/Avatar';import{DeleteIcon,EditIcon}from'assets/images/icons';import{toHalfWidth}from'utilities/Generator';import MemberAccountCardWrapper from'./memberAccountCard.style';/**\r\n * 包含了 Avatar 組合成一張會員帳號卡片\r\n * @param {*} hasNewTag 顯示NEW標籤\r\n * @param {*} memberId 會員UUID\r\n * @param {*} name 會員名稱\r\n * @param {*} bankNo 銀行代碼\r\n * @param {*} bankName 銀行名稱\r\n * @param {*} account 會員帳號\r\n * @param {*} noBorder 無框線\r\n * @param {*} isSelected 表示為已選取的狀態\r\n * @param {*} onClick 點擊會員帳號卡片事件 (選取時)\r\n * @param {*} moreActions [{\r\n    type: edit | delete,\r\n    lable: 按鈕標題,\r\n    onClick: 點擊按鈕事件,\r\n  }, ...]\r\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var MemberAccountCard=function MemberAccountCard(_ref){var hasNewTag=_ref.hasNewTag,memberId=_ref.memberId,name=_ref.name,bankNo=_ref.bankNo,bankName=_ref.bankName,account=_ref.account,noBorder=_ref.noBorder,isSelected=_ref.isSelected,onClick=_ref.onClick,moreActions=_ref.moreActions;var wrapperRef=useRef(null);var _useState=useState({showMorePanel:false,startX:null,endX:null}),_useState2=_slicedToArray(_useState,2),model=_useState2[0],setModel=_useState2[1];/**\r\n   * 初始化\r\n   */useEffect(function(){// 當使用者在元件之外 Click 或準備拖曳時，關閉已開啟的「更多Panel」\nvar handleClickOutside=function handleClickOutside(event){if(!model.showMorePanel)return;if(wrapperRef.current&&!wrapperRef.current.contains(event.target)){setModel(function(prevModel){return _objectSpread(_objectSpread({},prevModel),{},{showMorePanel:false});});}};// 為了自動關閉「更多Panel」，監聽 click 及 touchstart 事件。\n// document.addEventListener('click', handleClickOutside, true);\ndocument.addEventListener('touchstart',handleClickOutside,true);return function(){// document.removeEventListener('click', handleClickOutside, true);\ndocument.removeEventListener('touchstart',handleClickOutside,true);};},[model.showMorePanel]);/**\r\n   * 處理手指拖曳結束時「更多功能」的開啟或關閉。\r\n   */var handleTouchEnd=function handleTouchEnd(){if(!model.endX)return;// 只有點一下時, 不會有 TouchMove 事件，所以不會有值。\nvar newModel=null;var offset=model.endX-model.startX;// 當手指向左滑動一小段距離時，顯示「更多功能」。\n// eslint-disable-next-line object-curly-newline\nif(offset>10)newModel=_objectSpread(_objectSpread({},model),{},{showMorePanel:false,startX:null,endX:null});// 當手指向右滑動時，則關閉「更多功能」。\n// eslint-disable-next-line object-curly-newline\nif(offset<-3)newModel=_objectSpread(_objectSpread({},model),{},{showMorePanel:true,startX:null,endX:null});// 強制更新畫面。\nif(newModel!==null)setModel(newModel);};/**\r\n   * 顯示更多選項。\r\n   * @param {*} actions 編輯、刪除 的事件處理。\r\n   */var renderMoreActionMenu=function renderMoreActionMenu(actions){if(!actions)return null;// 執行更多功能時，必需隱藏「更多功能」Panel\nvar onActionClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(func){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(func)func();setModel(function(prevModel){return _objectSpread(_objectSpread({},prevModel),{},{showMorePanel:false});});case 2:case\"end\":return _context.stop();}}},_callee);}));return function onActionClick(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"moreActionMenu \".concat(model.showMorePanel?'show':''),children:actions===null||actions===void 0?void 0:actions.map(function(action){var iconData=new Map([['edit',{cssName:'edit',icon:/*#__PURE__*/_jsx(EditIcon,{})}],['delete',{cssName:'remove',icon:/*#__PURE__*/_jsx(DeleteIcon,{})}]]).get(action.type);return/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:iconData.cssName,onClick:function onClick(){return onActionClick(action.onClick);},children:[iconData.icon,/*#__PURE__*/_jsx(\"span\",{children:action.lable})]},action.type);})});};var handleTouchStart=function handleTouchStart(e){setModel(function(prevModel){return _objectSpread(_objectSpread({},prevModel),{},{startX:e.targetTouches[0].pageX});});};var handleTouchMove=function handleTouchMove(e){setModel(function(prevModel){return _objectSpread(_objectSpread({},prevModel),{},{endX:e.targetTouches[0].pageX});});};/**\r\n   * 元件 HTML 輸出。\r\n   */return/*#__PURE__*/_jsxs(MemberAccountCardWrapper,{ref:wrapperRef,$noBorder:noBorder,$selected:isSelected,onTouchStart:handleTouchStart,onTouchMove:handleTouchMove,onTouchEnd:handleTouchEnd,onClick:model.showMorePanel?null:onClick,children:[/*#__PURE__*/_jsx(Avatar,{small:true,memberId:memberId,name:name}),/*#__PURE__*/_jsx(\"div\",{className:\"memberInfo\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"title\",children:[toHalfWidth(name)||'會員 <-- 不是會員！',hasNewTag&&/*#__PURE__*/_jsx(\"div\",{className:\"new-tag\",children:\"New\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"note\",children:\"\".concat(bankName,\"(\").concat(bankNo,\") \").concat(account)})]})}),renderMoreActionMenu(moreActions)]});};export default MemberAccountCard;","map":{"version":3,"names":["useState","useEffect","useRef","Avatar","DeleteIcon","EditIcon","toHalfWidth","MemberAccountCardWrapper","MemberAccountCard","hasNewTag","memberId","name","bankNo","bankName","account","noBorder","isSelected","onClick","moreActions","wrapperRef","showMorePanel","startX","endX","model","setModel","handleClickOutside","event","current","contains","target","prevModel","document","addEventListener","removeEventListener","handleTouchEnd","newModel","offset","renderMoreActionMenu","actions","onActionClick","func","map","action","iconData","Map","cssName","icon","get","type","lable","handleTouchStart","e","targetTouches","pageX","handleTouchMove"],"sources":["C:/Users/allen/git/app2-webview/src/components/MemberAccountCard/index.js"],"sourcesContent":["/* eslint-disable no-unused-vars */\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport Avatar from 'components/Avatar';\r\nimport { DeleteIcon, EditIcon } from 'assets/images/icons';\r\nimport { toHalfWidth } from 'utilities/Generator';\r\nimport MemberAccountCardWrapper from './memberAccountCard.style';\r\n\r\n/**\r\n * 包含了 Avatar 組合成一張會員帳號卡片\r\n * @param {*} hasNewTag 顯示NEW標籤\r\n * @param {*} memberId 會員UUID\r\n * @param {*} name 會員名稱\r\n * @param {*} bankNo 銀行代碼\r\n * @param {*} bankName 銀行名稱\r\n * @param {*} account 會員帳號\r\n * @param {*} noBorder 無框線\r\n * @param {*} isSelected 表示為已選取的狀態\r\n * @param {*} onClick 點擊會員帳號卡片事件 (選取時)\r\n * @param {*} moreActions [{\r\n    type: edit | delete,\r\n    lable: 按鈕標題,\r\n    onClick: 點擊按鈕事件,\r\n  }, ...]\r\n */\r\nconst MemberAccountCard = ({\r\n  hasNewTag, memberId, name, bankNo, bankName, account, noBorder,\r\n  isSelected, onClick, moreActions,\r\n}) => {\r\n  const wrapperRef = useRef(null);\r\n  const [model, setModel] = useState({\r\n    showMorePanel: false,\r\n    startX: null,\r\n    endX: null,\r\n  });\r\n\r\n  /**\r\n   * 初始化\r\n   */\r\n\r\n  useEffect(() => {\r\n    // 當使用者在元件之外 Click 或準備拖曳時，關閉已開啟的「更多Panel」\r\n    const handleClickOutside = (event) => {\r\n      if (!model.showMorePanel) return;\r\n      if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {\r\n        setModel((prevModel) => ({...prevModel, showMorePanel: false}));\r\n      }\r\n    };\r\n\r\n    // 為了自動關閉「更多Panel」，監聽 click 及 touchstart 事件。\r\n    // document.addEventListener('click', handleClickOutside, true);\r\n    document.addEventListener('touchstart', handleClickOutside, true);\r\n    return () => {\r\n    // document.removeEventListener('click', handleClickOutside, true);\r\n      document.removeEventListener('touchstart', handleClickOutside, true);\r\n    };\r\n  }, [model.showMorePanel]);\r\n\r\n  /**\r\n   * 處理手指拖曳結束時「更多功能」的開啟或關閉。\r\n   */\r\n  const handleTouchEnd = () => {\r\n    if (!model.endX) return; // 只有點一下時, 不會有 TouchMove 事件，所以不會有值。\r\n    let newModel = null;\r\n    const offset = model.endX - model.startX;\r\n    // 當手指向左滑動一小段距離時，顯示「更多功能」。\r\n    // eslint-disable-next-line object-curly-newline\r\n    if (offset > 10) newModel = { ...model, showMorePanel: false, startX: null, endX: null };\r\n    // 當手指向右滑動時，則關閉「更多功能」。\r\n    // eslint-disable-next-line object-curly-newline\r\n    if (offset < -3) newModel = {...model, showMorePanel: true, startX: null, endX: null};\r\n\r\n    // 強制更新畫面。\r\n    if (newModel !== null) setModel(newModel);\r\n  };\r\n\r\n  /**\r\n   * 顯示更多選項。\r\n   * @param {*} actions 編輯、刪除 的事件處理。\r\n   */\r\n  const renderMoreActionMenu = (actions) => {\r\n    if (!actions) return null;\r\n\r\n    // 執行更多功能時，必需隱藏「更多功能」Panel\r\n    const onActionClick = async (func) => {\r\n      if (func) func();\r\n      setModel((prevModel) => ({...prevModel, showMorePanel: false}));\r\n    };\r\n\r\n    return (\r\n      <div className={`moreActionMenu ${model.showMorePanel ? 'show' : ''}`}>\r\n        {\r\n          actions?.map((action) => {\r\n            const iconData = new Map([\r\n              ['edit', { cssName: 'edit', icon: (<EditIcon />) }],\r\n              ['delete', { cssName: 'remove', icon: (<DeleteIcon />) }],\r\n            ]).get(action.type);\r\n            return (\r\n              <button type=\"button\" key={action.type} className={iconData.cssName} onClick={() => onActionClick(action.onClick)}>\r\n                {iconData.icon}\r\n                <span>{action.lable}</span>\r\n              </button>\r\n            );\r\n          })\r\n        }\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const handleTouchStart = (e) => {\r\n    setModel((prevModel) => ({...prevModel, startX: e.targetTouches[0].pageX}));\r\n  };\r\n  const handleTouchMove = (e) => {\r\n    setModel((prevModel) => ({...prevModel, endX: e.targetTouches[0].pageX}));\r\n  };\r\n\r\n  /**\r\n   * 元件 HTML 輸出。\r\n   */\r\n  return (\r\n    <MemberAccountCardWrapper\r\n      ref={wrapperRef}\r\n      $noBorder={noBorder}\r\n      $selected={isSelected}\r\n      onTouchStart={handleTouchStart}\r\n      onTouchMove={handleTouchMove}\r\n      onTouchEnd={handleTouchEnd}\r\n      onClick={model.showMorePanel ? null : onClick}\r\n    >\r\n      <Avatar small memberId={memberId} name={name} />\r\n      <div className=\"memberInfo\">\r\n        <div className=\"flex-auto\">\r\n          <div className=\"title\">\r\n            {/* TODO 後端目前會回傳全型文字，暫以此方法將文字轉為半形 */}\r\n            {/* 後續需請後端修正回傳文字之格式 */}\r\n            {toHalfWidth(name) || '會員 <-- 不是會員！'}\r\n            {hasNewTag && (<div className=\"new-tag\">New</div>)}\r\n          </div>\r\n          <div className=\"note\">\r\n            {`${bankName}(${bankNo}) ${account}`}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* 顯示更多選項（編輯、刪除 的事件處理）。 */}\r\n      { renderMoreActionMenu(moreActions) }\r\n    </MemberAccountCardWrapper>\r\n  );\r\n};\r\n\r\nexport default MemberAccountCard;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}