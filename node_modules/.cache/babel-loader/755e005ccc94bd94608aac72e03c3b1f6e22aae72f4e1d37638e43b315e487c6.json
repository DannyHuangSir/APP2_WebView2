{"ast":null,"code":"import _objectSpread from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/* eslint-disable no-unused-vars */import{useState,useEffect}from'react';import{useDispatch}from'react-redux';import{useHistory}from'react-router';import{Controller,useForm}from'react-hook-form';import uuid from'react-uuid';import parse from'html-react-parser';import{RadioGroup}from'@material-ui/core';import{setWaittingVisible}from'stores/reducers/ModalReducer';import Layout from'components/Layout/Layout';import Main from'components/Layout';import Accordion from'components/Accordion';import{FEIBButton,FEIBRadioLabel,FEIBRadio,FEIBErrorMessage}from'components/elements';import Loading from'components/Loading';import{closeFunc}from'utilities/AppScriptProxy';import{yupResolver}from'@hookform/resolvers/yup';import{CreatePageWrapper}from'./C00600.style';import{getDepositPlans,getDepositPlanProgram,getDepositPlanTerms}from'./api';import{AlertReachedMaxPlans}from'./utils/prompts';import{createSchema}from'./validationSchema';/**\r\n * C00600 存錢計畫 新增頁\r\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var DepositPlanCreatePage=function DepositPlanCreatePage(){var dispatch=useDispatch();var history=useHistory();var _useForm=useForm({defaultValues:{code:''},resolver:yupResolver(createSchema)}),control=_useForm.control,handleSubmit=_useForm.handleSubmit,errors=_useForm.formState.errors;var _useState=useState(),_useState2=_slicedToArray(_useState,2),programs=_useState2[0],setPrograms=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),terms=_useState4[0],setTerms=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),subAccounts=_useState6[0],setSubAccounts=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),hasReachedMaxSubAccounts=_useState8[0],setHasReachedMaxSubAccounts=_useState8[1];useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response,plans,accounts,totalSubAccountCount,programResponse;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(setWaittingVisible(true));_context.next=3;return getDepositPlans();case 3:response=_context.sent;if(response){plans=response.plans,accounts=response.subAccounts,totalSubAccountCount=response.totalSubAccountCount;// Guard: 存錢計畫首頁最多就三個計畫，意指若未在該情況下進入此頁為不正常操作。\nif(plans.length>=3)AlertReachedMaxPlans({goBack:function goBack(){return closeFunc();}});setSubAccounts(accounts);setHasReachedMaxSubAccounts(totalSubAccountCount>=8);}_context.next=7;return getDepositPlanProgram();case 7:programResponse=_context.sent;setPrograms(programResponse);dispatch(setWaittingVisible(false));case 10:case\"end\":return _context.stop();}}},_callee);})),[]);var lazyLoadTerms=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(terms){_context2.next=6;break;}_context2.t0=setTerms;_context2.next=4;return getDepositPlanTerms();case 4:_context2.t1=_context2.sent;(0,_context2.t0)(_context2.t1);case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function lazyLoadTerms(){return _ref2.apply(this,arguments);};}();var onSubmit=function onSubmit(_ref3){var code=_ref3.code;sessionStorage.removeItem('C006003');// 清除暫存表單資料。\nsessionStorage.removeItem('C00600-hero');// 清除暫存背景圖。\nvar program=programs.find(function(p){return p.code===code;});history.push('/C006003',{program:program,subAccounts:subAccounts,hasReachedMaxSubAccounts:hasReachedMaxSubAccounts});};return/*#__PURE__*/_jsx(Layout,{title:\"\\u65B0\\u589E\\u5B58\\u9322\\u8A08\\u756B\",goBackFunc:function goBackFunc(){return history.goBack();},children:/*#__PURE__*/_jsx(Main,{children:/*#__PURE__*/_jsx(CreatePageWrapper,{children:/*#__PURE__*/_jsxs(\"form\",{className:\"flex\",onSubmit:handleSubmit(onSubmit),children:[/*#__PURE__*/_jsxs(\"fieldset\",{children:[/*#__PURE__*/_jsx(\"legend\",{className:\"title\",children:\"\\u4F60\\u7684\\u5C08\\u5C6C\\u5B58\\u9322\\u8A08\\u756B\"}),/*#__PURE__*/_jsx(Controller,{name:\"code\",control:control,render:function render(_ref4){var field=_ref4.field;return/*#__PURE__*/_jsx(RadioGroup,_objectSpread(_objectSpread({},field),{},{children:/*#__PURE__*/_jsx(\"ul\",{className:\"list-group\",children:programs&&programs.map(function(p){return/*#__PURE__*/_jsxs(\"li\",{className:\"list\",children:[/*#__PURE__*/_jsx(FEIBRadioLabel,{control:/*#__PURE__*/_jsx(FEIBRadio,{}),label:p.name,value:\"\".concat(p.code)}),/*#__PURE__*/_jsx(\"div\",{className:\"rate\",children:\"\".concat(p.rate,\"%\")})]},uuid());})})}));}}),/*#__PURE__*/_jsx(FEIBErrorMessage,{children:errors.code&&errors.code.message})]}),/*#__PURE__*/_jsx(Accordion,{title:\"\\u670D\\u52D9\\u689D\\u6B3E\",className:\"terms\",onClick:lazyLoadTerms,children:terms?parse(terms):/*#__PURE__*/_jsx(Loading,{space:\"both\",isCentered:true})}),/*#__PURE__*/_jsx(FEIBButton,{type:\"submit\",children:\"\\u540C\\u610F\\u689D\\u6B3E\\u4E26\\u7E7C\\u7E8C\"})]})})})});};export default DepositPlanCreatePage;","map":{"version":3,"names":["useState","useEffect","useDispatch","useHistory","Controller","useForm","uuid","parse","RadioGroup","setWaittingVisible","Layout","Main","Accordion","FEIBButton","FEIBRadioLabel","FEIBRadio","FEIBErrorMessage","Loading","closeFunc","yupResolver","CreatePageWrapper","getDepositPlans","getDepositPlanProgram","getDepositPlanTerms","AlertReachedMaxPlans","createSchema","DepositPlanCreatePage","dispatch","history","defaultValues","code","resolver","control","handleSubmit","errors","formState","programs","setPrograms","terms","setTerms","subAccounts","setSubAccounts","hasReachedMaxSubAccounts","setHasReachedMaxSubAccounts","response","plans","accounts","totalSubAccountCount","length","goBack","programResponse","lazyLoadTerms","onSubmit","sessionStorage","removeItem","program","find","p","push","field","map","name","rate","message"],"sources":["C:/Users/allen/git/app2-webview/src/pages/C00600_DepositPlan/C00600_2.jsx"],"sourcesContent":["/* eslint-disable no-unused-vars */\r\nimport { useState, useEffect } from 'react';\r\nimport { useDispatch } from 'react-redux';\r\nimport { useHistory } from 'react-router';\r\nimport { Controller, useForm } from 'react-hook-form';\r\nimport uuid from 'react-uuid';\r\nimport parse from 'html-react-parser';\r\nimport { RadioGroup } from '@material-ui/core';\r\n\r\nimport { setWaittingVisible } from 'stores/reducers/ModalReducer';\r\nimport Layout from 'components/Layout/Layout';\r\nimport Main from 'components/Layout';\r\nimport Accordion from 'components/Accordion';\r\nimport {\r\n  FEIBButton, FEIBRadioLabel, FEIBRadio, FEIBErrorMessage,\r\n} from 'components/elements';\r\nimport Loading from 'components/Loading';\r\nimport { closeFunc } from 'utilities/AppScriptProxy';\r\n\r\nimport { yupResolver } from '@hookform/resolvers/yup';\r\nimport { CreatePageWrapper } from './C00600.style';\r\nimport { getDepositPlans, getDepositPlanProgram, getDepositPlanTerms } from './api';\r\nimport { AlertReachedMaxPlans } from './utils/prompts';\r\nimport { createSchema } from './validationSchema';\r\n\r\n/**\r\n * C00600 存錢計畫 新增頁\r\n */\r\nconst DepositPlanCreatePage = () => {\r\n  const dispatch = useDispatch();\r\n  const history = useHistory();\r\n  const { control, handleSubmit, formState: { errors } } = useForm(\r\n    {\r\n      defaultValues: {code: ''},\r\n      resolver: yupResolver(createSchema),\r\n    },\r\n  );\r\n\r\n  const [programs, setPrograms] = useState();\r\n  const [terms, setTerms] = useState();\r\n  const [subAccounts, setSubAccounts] = useState([]);\r\n  const [hasReachedMaxSubAccounts, setHasReachedMaxSubAccounts] = useState(false);\r\n\r\n  useEffect(async () => {\r\n    dispatch(setWaittingVisible(true));\r\n\r\n    const response = await getDepositPlans();\r\n    if (response) {\r\n      const {plans, subAccounts: accounts, totalSubAccountCount} = response;\r\n      // Guard: 存錢計畫首頁最多就三個計畫，意指若未在該情況下進入此頁為不正常操作。\r\n      if (plans.length >= 3) AlertReachedMaxPlans({ goBack: () => closeFunc() });\r\n      setSubAccounts(accounts);\r\n      setHasReachedMaxSubAccounts(totalSubAccountCount >= 8);\r\n    }\r\n\r\n    const programResponse = await getDepositPlanProgram();\r\n    setPrograms(programResponse);\r\n    dispatch(setWaittingVisible(false));\r\n  }, []);\r\n\r\n  const lazyLoadTerms = async () => {\r\n    if (!terms) setTerms(await getDepositPlanTerms());\r\n  };\r\n\r\n  const onSubmit = ({code}) => {\r\n    sessionStorage.removeItem('C006003'); // 清除暫存表單資料。\r\n    sessionStorage.removeItem('C00600-hero'); // 清除暫存背景圖。\r\n\r\n    const program = programs.find((p) => p.code === code);\r\n    history.push('/C006003', {\r\n      program, subAccounts, hasReachedMaxSubAccounts,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Layout title=\"新增存錢計畫\" goBackFunc={() => history.goBack()}>\r\n      <Main>\r\n        <CreatePageWrapper>\r\n          <form className=\"flex\" onSubmit={handleSubmit(onSubmit)}>\r\n            <fieldset>\r\n              <legend className=\"title\">你的專屬存錢計畫</legend>\r\n              <Controller\r\n                name=\"code\"\r\n                control={control}\r\n                render={({ field }) => (\r\n                  <RadioGroup {...field}>\r\n                    <ul className=\"list-group\">\r\n                      { programs && programs.map((p) => (\r\n                        <li key={uuid()} className=\"list\">\r\n                          <FEIBRadioLabel control={<FEIBRadio />} label={p.name} value={`${p.code}`} />\r\n                          <div className=\"rate\">{`${p.rate}%`}</div>\r\n                        </li>\r\n                      )) }\r\n                    </ul>\r\n                  </RadioGroup>\r\n                )}\r\n              />\r\n              <FEIBErrorMessage>\r\n                {errors.code && errors.code.message}\r\n              </FEIBErrorMessage>\r\n            </fieldset>\r\n\r\n            <Accordion title=\"服務條款\" className=\"terms\" onClick={lazyLoadTerms}>\r\n              { terms ? parse(terms) : <Loading space=\"both\" isCentered /> }\r\n            </Accordion>\r\n            <FEIBButton type=\"submit\">同意條款並繼續</FEIBButton>\r\n          </form>\r\n        </CreatePageWrapper>\r\n      </Main>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default DepositPlanCreatePage;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}