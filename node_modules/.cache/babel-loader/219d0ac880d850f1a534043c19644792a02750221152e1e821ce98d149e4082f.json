{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useMemo,useState}from'react';import{CurrencyInfo,datetimeToString}from'utilities/Generator';import{showCustomDrawer}from'utilities/MessageModal';import AddNewItem from'components/AddNewItem';import SettingItem from'components/SettingItem';import Layout from'components/Layout/Layout';import{getAllNotices,removeNotice,getCcyList}from'./api';import ForeignCurrencyPriceSettingWrapper from'./foreignCurrencyPriceSetting.style';import ForeignCurrencyPriceSettingForm from'./ForeignCurrencyPriceSettingForm';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ForeignCurrencyPriceSetting=function ForeignCurrencyPriceSetting(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),currencyInfo=_useState2[0],setCurrencyInfo=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),notificationList=_useState4[0],setNotificationList=_useState4[1];var priceTypeOptions=[{label:'現金匯率',value:'0'},{label:'即期匯率',value:'1'}];var currentTime=datetimeToString(new Date());var currencyOptions=useMemo(function(){if(!currencyInfo.length)return[];return currencyInfo.map(function(_ref){var ccyCd=_ref.ccyCd,ccyName=_ref.ccyName;return{label:ccyName,value:ccyCd};});},[currencyInfo]);// 取得所有已設定外幣到價通知列表\nvar getAllPriceNotifications=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getAllNotices();case 2:response=_context.sent;setNotificationList(response);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getAllPriceNotifications(){return _ref2.apply(this,arguments);};}();// 刪除外幣到價通知\nvar deletePriceSetting=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(data){var param;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:param={currency:data.currency,price:data.price,exchange_type:data.exchange_type};_context2.next=3;return removeNotice(param);case 3:getAllPriceNotifications();case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function deletePriceSetting(_x){return _ref3.apply(this,arguments);};}();var findSelectedRate=function findSelectedRate(currency){var _currencyInfo$find;return(_currencyInfo$find=currencyInfo.find(function(item){return item.ccyCd===currency;}))===null||_currencyInfo$find===void 0?void 0:_currencyInfo$find.sellRate;};// 跳出新增/編輯外幣到價通知設定彈窗\nvar showPriceSettingDrawer=function showPriceSettingDrawer(data){var isAddAction=!data;// 如有給 data 就是編輯模式，反之則為新增模式\nvar defaultValues={currency:isAddAction?'USD':data.currency,price:isAddAction?'':data.price,exchange_type:isAddAction?'0':String(data.exchange_type)// exchange_type 在 RadioGroupField 的 value 必須為 string，\n// 因此先轉成 string 傳入，後續要 submit 之前會再轉為 number\n};showCustomDrawer({title:\"\".concat(isAddAction?'新增':'編輯',\"\\u5916\\u5E63\\u5230\\u50F9\\u901A\\u77E5\"),content:/*#__PURE__*/_jsx(ForeignCurrencyPriceSettingForm,{currentTime:currentTime,isAddAction:isAddAction,defaultValues:defaultValues,currencyOptions:currencyOptions,priceTypeOptions:priceTypeOptions,findSelectedRate:findSelectedRate,getAllPriceNotifications:getAllPriceNotifications})});};var renderNotiList=function renderNotiList(){return notificationList.map(function(item){var currency=CurrencyInfo.find(function(el){return el.code===item.currency;});return/*#__PURE__*/_jsx(SettingItem,{mainLable:\"\".concat(currency.name,\" \").concat(currency.symbol),subLabel:\"\\u532F\\u7387\\uFF1A\".concat(item.price),editClick:function editClick(){return showPriceSettingDrawer(item);},deleteClick:function deleteClick(){return deletePriceSetting(item);}},item.createTime);});};useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var ccyList;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:// 載入所有已設定的通知。\ngetAllPriceNotifications();// 取得外幣列表\n_context3.next=3;return getCcyList();case 3:ccyList=_context3.sent;if(ccyList)setCurrencyInfo(ccyList);case 5:case\"end\":return _context3.stop();}}},_callee3);})),[]);return/*#__PURE__*/_jsx(Layout,{title:\"\\u5916\\u5E63\\u5230\\u50F9\\u901A\\u77E5\",children:/*#__PURE__*/_jsxs(ForeignCurrencyPriceSettingWrapper,{children:[notificationList.length<5&&/*#__PURE__*/_jsx(AddNewItem,{onClick:function onClick(){return showPriceSettingDrawer();},addLabel:\"\\u65B0\\u589E\\uFF08\\u6700\\u591A\\u53EF\\u8A2D\\u5B9A\\u4E94\\u7B46\\uFF09\"}),renderNotiList()]})});};export default ForeignCurrencyPriceSetting;","map":{"version":3,"names":["useEffect","useMemo","useState","CurrencyInfo","datetimeToString","showCustomDrawer","AddNewItem","SettingItem","Layout","getAllNotices","removeNotice","getCcyList","ForeignCurrencyPriceSettingWrapper","ForeignCurrencyPriceSettingForm","ForeignCurrencyPriceSetting","currencyInfo","setCurrencyInfo","notificationList","setNotificationList","priceTypeOptions","label","value","currentTime","Date","currencyOptions","length","map","ccyCd","ccyName","getAllPriceNotifications","response","deletePriceSetting","data","param","currency","price","exchange_type","findSelectedRate","find","item","sellRate","showPriceSettingDrawer","isAddAction","defaultValues","String","title","content","renderNotiList","el","code","name","symbol","createTime","ccyList"],"sources":["C:/Users/allen/git/app2-webview/src/pages/ForeignCurrencyPriceSetting/index.js"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react';\r\nimport { CurrencyInfo, datetimeToString } from 'utilities/Generator';\r\nimport { showCustomDrawer } from 'utilities/MessageModal';\r\n\r\nimport AddNewItem from 'components/AddNewItem';\r\nimport SettingItem from 'components/SettingItem';\r\nimport Layout from 'components/Layout/Layout';\r\n\r\nimport { getAllNotices, removeNotice, getCcyList } from './api';\r\nimport ForeignCurrencyPriceSettingWrapper from './foreignCurrencyPriceSetting.style';\r\nimport ForeignCurrencyPriceSettingForm from './ForeignCurrencyPriceSettingForm';\r\n\r\nconst ForeignCurrencyPriceSetting = () => {\r\n  const [currencyInfo, setCurrencyInfo] = useState([]);\r\n  const [notificationList, setNotificationList] = useState([]);\r\n  const priceTypeOptions = [{label: '現金匯率', value: '0'}, {label: '即期匯率', value: '1'}];\r\n  const currentTime = datetimeToString(new Date());\r\n  const currencyOptions = useMemo(() => {\r\n    if (!currencyInfo.length) return [];\r\n    return currencyInfo.map(({ccyCd, ccyName}) => ({label: ccyName, value: ccyCd}));\r\n  }, [currencyInfo]);\r\n\r\n  // 取得所有已設定外幣到價通知列表\r\n  const getAllPriceNotifications = async () => {\r\n    const response = await getAllNotices();\r\n    setNotificationList(response);\r\n  };\r\n\r\n  // 刪除外幣到價通知\r\n  const deletePriceSetting = async (data) => {\r\n    const param = {\r\n      currency: data.currency,\r\n      price: data.price,\r\n      exchange_type: data.exchange_type,\r\n    };\r\n    await removeNotice(param);\r\n    getAllPriceNotifications();\r\n  };\r\n\r\n  const findSelectedRate = (currency) => currencyInfo.find((item) => item.ccyCd === currency)?.sellRate;\r\n\r\n  // 跳出新增/編輯外幣到價通知設定彈窗\r\n  const showPriceSettingDrawer = (data) => {\r\n    const isAddAction = !data; // 如有給 data 就是編輯模式，反之則為新增模式\r\n    const defaultValues = {\r\n      currency: isAddAction ? 'USD' : data.currency,\r\n      price: isAddAction ? '' : data.price,\r\n      exchange_type: isAddAction ? '0' : String(data.exchange_type),\r\n      // exchange_type 在 RadioGroupField 的 value 必須為 string，\r\n      // 因此先轉成 string 傳入，後續要 submit 之前會再轉為 number\r\n    };\r\n\r\n    showCustomDrawer({\r\n      title: `${isAddAction ? '新增' : '編輯'}外幣到價通知`,\r\n      content: (\r\n        <ForeignCurrencyPriceSettingForm\r\n          currentTime={currentTime}\r\n          isAddAction={isAddAction}\r\n          defaultValues={defaultValues}\r\n          currencyOptions={currencyOptions}\r\n          priceTypeOptions={priceTypeOptions}\r\n          findSelectedRate={findSelectedRate}\r\n          getAllPriceNotifications={getAllPriceNotifications}\r\n        />\r\n      ),\r\n    });\r\n  };\r\n\r\n  const renderNotiList = () => (\r\n    notificationList.map((item) => {\r\n      const currency = CurrencyInfo.find((el) => el.code === item.currency);\r\n      return (\r\n        <SettingItem\r\n          key={item.createTime}\r\n          mainLable={`${currency.name} ${currency.symbol}`}\r\n          subLabel={`匯率：${item.price}`}\r\n          editClick={() => showPriceSettingDrawer(item)}\r\n          deleteClick={() => deletePriceSetting(item)}\r\n        />\r\n      );\r\n    })\r\n  );\r\n\r\n  useEffect(async () => {\r\n    // 載入所有已設定的通知。\r\n    getAllPriceNotifications();\r\n    // 取得外幣列表\r\n    const ccyList = await getCcyList();\r\n    if (ccyList) setCurrencyInfo(ccyList);\r\n  }, []);\r\n\r\n  return (\r\n    <Layout title=\"外幣到價通知\">\r\n      <ForeignCurrencyPriceSettingWrapper>\r\n        {\r\n          notificationList.length < 5 && (\r\n            <AddNewItem onClick={() => showPriceSettingDrawer()} addLabel=\"新增（最多可設定五筆）\" />\r\n          )\r\n        }\r\n        { renderNotiList() }\r\n      </ForeignCurrencyPriceSettingWrapper>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default ForeignCurrencyPriceSetting;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}