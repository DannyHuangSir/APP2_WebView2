{"ast":null,"code":"import _objectSpread from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import{useHistory}from'react-router';import{useForm}from'react-hook-form';import{yupResolver}from'@hookform/resolvers/yup';import{useDispatch}from'react-redux';import{setWaittingVisible}from'stores/reducers/ModalReducer';import Layout from'components/Layout/Layout';import{FEIBButton}from'components/elements';import DebitCard from'components/DebitCard/DebitCard';import Accordion from'components/Accordion';import{closeFunc,transactionAuth}from'utilities/AppScriptProxy';import{showCustomPrompt,showError}from'utilities/MessageModal';import{getAccountsList}from'utilities/CacheData';import{AuthCode}from'utilities/TxnAuthCode';import{cardLessWithdrawApply,getAccountExtraInfo}from'./api';import CardLessATMWrapper from'./D00300.style';import{CustomInputSelectorField}from'./fields/CustomInputSelectorField';import{validationSchema}from'./validationSchema';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CardLessATM1=function CardLessATM1(){var defaultValues={withdrawAmount:0};var _useForm=useForm({defaultValues:defaultValues,resolver:yupResolver(validationSchema)}),handleSubmit=_useForm.handleSubmit,control=_useForm.control;var history=useHistory();var dispatch=useDispatch();var _useState=useState({account:'',balance:0,wdTimes:0,wdRemain:0}),_useState2=_slicedToArray(_useState,2),accountSummary=_useState2[0],setAccountSummary=_useState2[1];// 無卡提款交易\nvar requestCardlessWithdrawApply=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(param){var _yield$transactionAut,result,_yield$cardLessWithdr,seqNo,startDateTime,endDateTime,message,account,withdrawAmount,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return transactionAuth(AuthCode.D00300);case 2:_yield$transactionAut=_context.sent;result=_yield$transactionAut.result;if(!result){_context.next=15;break;}_context.next=7;return cardLessWithdrawApply(param);case 7:_yield$cardLessWithdr=_context.sent;seqNo=_yield$cardLessWithdr.seqNo;startDateTime=_yield$cardLessWithdr.startDateTime;endDateTime=_yield$cardLessWithdr.endDateTime;message=_yield$cardLessWithdr.message;account=param.account,withdrawAmount=param.withdrawAmount;data={seqNo:seqNo,startDateTime:startDateTime,endDateTime:endDateTime,withdrawAmount:withdrawAmount,account:account};if(seqNo)history.push('/D003002',{data:data});else showCustomPrompt({message:message,onOk:closeFunc,onClose:closeFunc});case 15:case\"end\":return _context.stop();}}},_callee);}));return function requestCardlessWithdrawApply(_x){return _ref.apply(this,arguments);};}();var onSubmit=function onSubmit(values){if(values.withdrawAmount>accountSummary.balance){showError('提款金額不得大於帳戶餘額');}else{requestCardlessWithdrawApply(values);}};useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:dispatch(setWaittingVisible(true));// 取得提款卡資訊\ngetAccountsList('M',/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(accounts){var acct;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:acct=accounts[0];// 以非同步 先顯示帳號及餘額\nsetAccountSummary(_objectSpread(_objectSpread({},accountSummary),{},{account:acct.accountNo,balance:acct.balance}));// 跨轉優惠資訊取回後再更新。\ngetAccountExtraInfo(acct.accountNo).then(function(extraInfo){setAccountSummary({account:acct.accountNo,balance:acct.balance,wdTimes:extraInfo.freeWithdraw,wdRemain:extraInfo.freeWithdrawRemain});});dispatch(setWaittingVisible(false));case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref3.apply(this,arguments);};}());case 2:case\"end\":return _context3.stop();}}},_callee3);})),[]);return/*#__PURE__*/_jsx(Layout,{title:\"\\u7121\\u5361\\u63D0\\u6B3E\",children:/*#__PURE__*/_jsx(CardLessATMWrapper,{children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onSubmit),children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(DebitCard,{cardName:\"\\u5B58\\u6B3E\\u5361\",account:accountSummary.account,balance:accountSummary.balance,withdrawMode:true,freeWithdraw:accountSummary.wdTimes,freeWithdrawRemain:accountSummary.wdRemain,color:\"purple\"}),/*#__PURE__*/_jsx(CustomInputSelectorField,{control:control,name:\"withdrawAmount\",placeholder:\"\\u8ACB\\u8F38\\u5165\\u91D1\\u984D\",labelName:\"\\u60A8\\u60F3\\u63D0\\u9818\\u591A\\u5C11\\u9322\\u5462\\uFF1F\"}),/*#__PURE__*/_jsx(Accordion,{space:\"both\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:\"\\u672C\\u4EA4\\u6613\\u9650\\u664215\\u5206\\u9418\\u5167\\u6709\\u6548\\uFF0C\\u8ACB\\u65BC\\u4EA4\\u6613\\u6709\\u6548\\u6642\\u9593\\u5167\\uFF0C\\u81F3\\u672C\\u884C\\u63D0\\u4F9B\\u7121\\u5361\\u63D0\\u6B3E\\u529F\\u80FD\\u4E4BATM\\u5B8C\\u6210\\u63D0\\u6B3E\\u3002\\u82E5\\u903E\\u6642\\u8ACB\\u91CD\\u65B0\\u7533\\u8ACB\\u3002(\\u5BE6\\u969B\\u4EA4\\u6613\\u6709\\u6548\\u6642\\u9593\\u4EE5\\u672C\\u884C\\u7CFB\\u7D71\\u6642\\u9593\\u70BA\\u6E96)\\u3002\"}),/*#__PURE__*/_jsxs(\"li\",{children:[\"\\u63D0\\u9192\\u60A8\\uFF0CATM\\u63D0\\u6B3E\\u6642\\u8ACB\\u52D9\\u5FC5\\u78BA\\u8A8D\\u60A8\\u7684\\u5B58\\u6B3E\\u9918\\u984D\\u662F\\u5426\\u8DB3\\u5920\\uFF0C\\u907F\\u514D\\u63D0\\u6B3E\\u5931\\u6557\\u3002\",' ']}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u7121\\u5361\\u63D0\\u6B3E\\u5BC6\\u78BC\\u9023\\u7E8C\\u932F\\u8AA43\\u6B21\\uFF0C\\u5373\\u9396\\u4F4F\\u670D\\u52D9\\uFF0C\\u9808\\u91CD\\u65B0\\u7533\\u8ACB\\u670D\\u52D9\\u3002\"})]})})]}),/*#__PURE__*/_jsx(FEIBButton,{type:\"submit\",children:\"\\u78BA\\u8A8D\"})]})})});};export default CardLessATM1;","map":{"version":3,"names":["useState","useEffect","useHistory","useForm","yupResolver","useDispatch","setWaittingVisible","Layout","FEIBButton","DebitCard","Accordion","closeFunc","transactionAuth","showCustomPrompt","showError","getAccountsList","AuthCode","cardLessWithdrawApply","getAccountExtraInfo","CardLessATMWrapper","CustomInputSelectorField","validationSchema","CardLessATM1","defaultValues","withdrawAmount","resolver","handleSubmit","control","history","dispatch","account","balance","wdTimes","wdRemain","accountSummary","setAccountSummary","requestCardlessWithdrawApply","param","D00300","result","seqNo","startDateTime","endDateTime","message","data","push","onOk","onClose","onSubmit","values","accounts","acct","accountNo","then","extraInfo","freeWithdraw","freeWithdrawRemain"],"sources":["C:/Users/allen/git/app2-webview/src/pages/D00300_CardLessATM/D00300_1.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useHistory } from 'react-router';\r\nimport { useForm } from 'react-hook-form';\r\nimport { yupResolver } from '@hookform/resolvers/yup';\r\nimport { useDispatch } from 'react-redux';\r\n\r\nimport { setWaittingVisible } from 'stores/reducers/ModalReducer';\r\nimport Layout from 'components/Layout/Layout';\r\nimport { FEIBButton} from 'components/elements';\r\nimport DebitCard from 'components/DebitCard/DebitCard';\r\nimport Accordion from 'components/Accordion';\r\nimport { closeFunc, transactionAuth } from 'utilities/AppScriptProxy';\r\nimport { showCustomPrompt, showError } from 'utilities/MessageModal';\r\nimport { getAccountsList } from 'utilities/CacheData';\r\nimport { AuthCode } from 'utilities/TxnAuthCode';\r\nimport { cardLessWithdrawApply, getAccountExtraInfo } from './api';\r\n\r\nimport CardLessATMWrapper from './D00300.style';\r\nimport { CustomInputSelectorField } from './fields/CustomInputSelectorField';\r\nimport { validationSchema } from './validationSchema';\r\n\r\nconst CardLessATM1 = () => {\r\n  const defaultValues = {\r\n    withdrawAmount: 0,\r\n  };\r\n\r\n  const {handleSubmit, control } = useForm({\r\n    defaultValues,\r\n    resolver: yupResolver(validationSchema),\r\n  });\r\n\r\n  const history = useHistory();\r\n  const dispatch = useDispatch();\r\n\r\n  const [accountSummary, setAccountSummary] = useState({\r\n    account: '',\r\n    balance: 0,\r\n    wdTimes: 0,\r\n    wdRemain: 0,\r\n  });\r\n\r\n  // 無卡提款交易\r\n  const requestCardlessWithdrawApply = async (param) => {\r\n    const {result} = await transactionAuth(AuthCode.D00300);\r\n    if (result) {\r\n      const {\r\n        seqNo, startDateTime, endDateTime, message,\r\n      } = await cardLessWithdrawApply(param);\r\n\r\n      const { account, withdrawAmount } = param;\r\n      const data = {\r\n        seqNo,\r\n        startDateTime,\r\n        endDateTime,\r\n        withdrawAmount,\r\n        account,\r\n      };\r\n\r\n      if (seqNo) history.push('/D003002', { data });\r\n      else showCustomPrompt({ message, onOk: closeFunc, onClose: closeFunc });\r\n    }\r\n  };\r\n\r\n  const onSubmit = (values) => {\r\n    if (values.withdrawAmount > accountSummary.balance) {\r\n      showError('提款金額不得大於帳戶餘額');\r\n    } else {\r\n      requestCardlessWithdrawApply(values);\r\n    }\r\n  };\r\n\r\n  useEffect(async () => {\r\n    dispatch(setWaittingVisible(true));\r\n\r\n    // 取得提款卡資訊\r\n    getAccountsList('M', async (accounts) => {\r\n      const acct = accounts[0];\r\n      // 以非同步 先顯示帳號及餘額\r\n      setAccountSummary({\r\n        ...accountSummary,\r\n        account: acct.accountNo,\r\n        balance: acct.balance,\r\n      });\r\n\r\n      // 跨轉優惠資訊取回後再更新。\r\n      getAccountExtraInfo(acct.accountNo).then((extraInfo) => {\r\n        setAccountSummary({\r\n          account: acct.accountNo,\r\n          balance: acct.balance,\r\n          wdTimes: extraInfo.freeWithdraw,\r\n          wdRemain: extraInfo.freeWithdrawRemain,\r\n        });\r\n      });\r\n\r\n      dispatch(setWaittingVisible(false));\r\n    });\r\n  }, []);\r\n\r\n  return (\r\n    <Layout title=\"無卡提款\">\r\n      <CardLessATMWrapper>\r\n        <form onSubmit={handleSubmit(onSubmit)}>\r\n          <div>\r\n            <DebitCard\r\n              cardName=\"存款卡\"\r\n              account={accountSummary.account}\r\n              balance={accountSummary.balance}\r\n              withdrawMode\r\n              freeWithdraw={accountSummary.wdTimes}\r\n              freeWithdrawRemain={accountSummary.wdRemain}\r\n              color=\"purple\"\r\n            />\r\n            <CustomInputSelectorField\r\n              control={control}\r\n              name=\"withdrawAmount\"\r\n              placeholder=\"請輸入金額\"\r\n              labelName=\"您想提領多少錢呢？\"\r\n            />\r\n\r\n            <Accordion space=\"both\">\r\n              <ul>\r\n                <li>\r\n                  本交易限時15分鐘內有效，請於交易有效時間內，至本行提供無卡提款功能之ATM完成提款。若逾時請重新申請。(實際交易有效時間以本行系統時間為準)。\r\n                </li>\r\n                <li>\r\n                  提醒您，ATM提款時請務必確認您的存款餘額是否足夠，避免提款失敗。\r\n                  {' '}\r\n                </li>\r\n                <li>無卡提款密碼連續錯誤3次，即鎖住服務，須重新申請服務。</li>\r\n              </ul>\r\n            </Accordion>\r\n          </div>\r\n          <FEIBButton type=\"submit\">確認</FEIBButton>\r\n        </form>\r\n      </CardLessATMWrapper>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default CardLessATM1;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}