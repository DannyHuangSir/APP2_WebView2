{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect,useRef}from'react';import{useDispatch}from'react-redux';/* Elements */import{startFunc}from'utilities/AppScriptProxy';import EmptyData from'components/EmptyData';import Layout from'components/Layout/Layout';import FavoriteBlockButton from'components/FavoriteBlockButton';import{FEIBTabContext,FEIBTabList,FEIBTab}from'components/elements';import{iconGenerator}from'pages/S00100_Favorite/favoriteGenerator';/* Reducers & JS functions */import{setWaittingVisible}from'stores/reducers/ModalReducer';import{getMoreList}from'./api';import MoreWrapper from'./B00600.style';/**\r\n * B00600 更多單元功能\r\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var More=function More(){var dispatch=useDispatch();var groupsRef=useRef([]);var mainContentRef=useRef();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),funcGroups=_useState2[0],setFuncGroups=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),currentGroup=_useState4[0],setCurrentGroup=_useState4[1];/**\r\n   * 頁面啟動，初始化\r\n   */useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var funcItemsData,groups;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(setWaittingVisible(true));// 取得 Function Controller 提供的 keepDdata(model)\nfuncItemsData=sessionStorage.getItem('funcItems');// 首次加載時取得用戶所有外幣的存款帳戶摘要資訊\nif(funcItemsData){_context.next=9;break;}_context.next=5;return getMoreList();case 5:groups=_context.sent;sessionStorage.setItem('funcItems',JSON.stringify(groups||[]));_context.next=10;break;case 9:groups=JSON.parse(funcItemsData);case 10:setFuncGroups(groups||[]);setCurrentGroup(groups&&groups.length?groups[0].groupKey:'');dispatch(setWaittingVisible(false));case 13:case\"end\":return _context.stop();}}},_callee);})),[]);/**\r\n   * 當單元功能分類(Section)變更時，調整 TAB頁籤 底線位置。\r\n   */var handleChangeTabs=function handleChangeTabs(_,value){var scrollTarget=groupsRef.current.find(function(el){return el.className===value;});// scrollIntoView 會觸發 scroll 事件 (handleScrollContent)\n// 若提供 {behavior:'smooth'} ，則會在此 function 被觸發後造成多次 re-render\n// 會造成 handleScrollContent 判定異常，故這邊只給預設值，只 re-render 一次就好\nscrollTarget.scrollIntoView();var _mainContentRef$curre=mainContentRef.current,scrollHeight=_mainContentRef$curre.scrollHeight,scrollTop=_mainContentRef$curre.scrollTop,offsetHeight=_mainContentRef$curre.offsetHeight;// 當誤差值小於 1 時 則判定為尚未捲動到最底部\nif(scrollHeight-(scrollTop+offsetHeight)<=1){setCurrentGroup(value);}};/**\r\n   * 滾動單元功能清單時，調整 TAB頁籤 底線位置。\r\n   */var handleScrollContent=function handleScrollContent(event){var _event$target=event.target,scrollHeight=_event$target.scrollHeight,scrollTop=_event$target.scrollTop,offsetHeight=_event$target.offsetHeight;if(!(scrollHeight-(scrollTop+offsetHeight)<=1)){var foundGroup=groupsRef.current.find(function(el){// 設定 1 為誤差值，因為 scrollTo Func 不一定會捲動到 element 的 scrollTop 位置\nvar top=el.offsetTop-1;var bottom=top+el.offsetHeight;return scrollTop>=top&&scrollTop<bottom;});if(foundGroup&&foundGroup.className!==currentGroup){setCurrentGroup(foundGroup.className);}}};/**\r\n   * 顯示指定分類的單元功能項目清單。\r\n   * @param {*} group\r\n   */var renderFuncGroup=function renderFuncGroup(group,groupIndex){var doStartFunc=function doStartFunc(funcCode){// TODO 不可執行的功能，例：純卡戶 執行 申請信用卡。\n// TODO 但 純卡戶 執行轉帳，則是由 Funciton Manager 提供資訊，由 Funciton Controller 詢問是否立即申請。\nstartFunc(funcCode);};// TODO 加上「new」的圖示，可以用 上線時間 判斷，例：在一個月內都會出現。\nreturn/*#__PURE__*/_jsxs(\"section\",{ref:function ref(el){groupsRef.current[groupIndex]=el;},className:group.groupKey,children:[/*#__PURE__*/_jsx(\"h3\",{className:\"title\",children:group.groupName}),/*#__PURE__*/_jsx(\"div\",{className:\"blockGroup\",children:group.items.map(function(item){return/*#__PURE__*/_jsx(FavoriteBlockButton,{icon:iconGenerator(item.actKey),label:item.name,onClick:function onClick(){return doStartFunc(item.actKey);},noBorder:true},item.actKey);})})]},group.groupKey);};/**\r\n   * 頁面輸出\r\n   */return/*#__PURE__*/_jsx(Layout,{title:\"\\u66F4\\u591A\",children:/*#__PURE__*/_jsx(MoreWrapper,{small:true,children:funcGroups.length?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FEIBTabContext,{value:currentGroup,children:/*#__PURE__*/_jsx(FEIBTabList,{$size:\"small\",onChange:handleChangeTabs,children:funcGroups.map(function(group){return/*#__PURE__*/_jsx(FEIBTab,{label:group.groupName,value:group.groupKey},group.groupKey);})})}),/*#__PURE__*/_jsx(\"div\",{className:\"mainContent\",ref:mainContentRef,onScroll:handleScrollContent,children:funcGroups.map(function(group,groupIndex){return renderFuncGroup(group,groupIndex);})})]}):/*#__PURE__*/_jsx(EmptyData,{content:\"\\u67E5\\u7121\\u670D\\u52D9\\uFF0C\\u8ACB\\u78BA\\u8A8D\\u7DB2\\u8DEF\\u72C0\\u614B\"})})});};export default More;","map":{"version":3,"names":["useState","useEffect","useRef","useDispatch","startFunc","EmptyData","Layout","FavoriteBlockButton","FEIBTabContext","FEIBTabList","FEIBTab","iconGenerator","setWaittingVisible","getMoreList","MoreWrapper","More","dispatch","groupsRef","mainContentRef","funcGroups","setFuncGroups","currentGroup","setCurrentGroup","funcItemsData","sessionStorage","getItem","groups","setItem","JSON","stringify","parse","length","groupKey","handleChangeTabs","_","value","scrollTarget","current","find","el","className","scrollIntoView","scrollHeight","scrollTop","offsetHeight","handleScrollContent","event","target","foundGroup","top","offsetTop","bottom","renderFuncGroup","group","groupIndex","doStartFunc","funcCode","groupName","items","map","item","actKey","name"],"sources":["C:/Users/allen/git/app2-webview/src/pages/B00600_More/B00600.js"],"sourcesContent":["import { useState, useEffect, useRef } from 'react';\r\nimport { useDispatch } from 'react-redux';\r\n\r\n/* Elements */\r\nimport { startFunc } from 'utilities/AppScriptProxy';\r\nimport EmptyData from 'components/EmptyData';\r\nimport Layout from 'components/Layout/Layout';\r\nimport FavoriteBlockButton from 'components/FavoriteBlockButton';\r\nimport { FEIBTabContext, FEIBTabList, FEIBTab } from 'components/elements';\r\nimport { iconGenerator } from 'pages/S00100_Favorite/favoriteGenerator';\r\n\r\n/* Reducers & JS functions */\r\nimport { setWaittingVisible } from 'stores/reducers/ModalReducer';\r\nimport { getMoreList } from './api';\r\nimport MoreWrapper from './B00600.style';\r\n\r\n/**\r\n * B00600 更多單元功能\r\n */\r\nconst More = () => {\r\n  const dispatch = useDispatch();\r\n  const groupsRef = useRef([]);\r\n  const mainContentRef = useRef();\r\n  const [funcGroups, setFuncGroups] = useState([]);\r\n  const [currentGroup, setCurrentGroup] = useState();\r\n\r\n  /**\r\n   * 頁面啟動，初始化\r\n   */\r\n  useEffect(async () => {\r\n    dispatch(setWaittingVisible(true));\r\n\r\n    // 取得 Function Controller 提供的 keepDdata(model)\r\n    const funcItemsData = sessionStorage.getItem('funcItems');\r\n\r\n    // 首次加載時取得用戶所有外幣的存款帳戶摘要資訊\r\n    let groups;\r\n    if (!funcItemsData) {\r\n      groups = await getMoreList();\r\n      sessionStorage.setItem('funcItems', JSON.stringify(groups || []));\r\n    } else groups = JSON.parse(funcItemsData);\r\n\r\n    setFuncGroups(groups || []);\r\n    setCurrentGroup((groups && groups.length) ? groups[0].groupKey : '');\r\n    dispatch(setWaittingVisible(false));\r\n  }, []);\r\n\r\n  /**\r\n   * 當單元功能分類(Section)變更時，調整 TAB頁籤 底線位置。\r\n   */\r\n  const handleChangeTabs = (_, value) => {\r\n    const scrollTarget = groupsRef.current.find((el) => el.className === value);\r\n    // scrollIntoView 會觸發 scroll 事件 (handleScrollContent)\r\n    // 若提供 {behavior:'smooth'} ，則會在此 function 被觸發後造成多次 re-render\r\n    // 會造成 handleScrollContent 判定異常，故這邊只給預設值，只 re-render 一次就好\r\n    scrollTarget.scrollIntoView();\r\n    const { scrollHeight, scrollTop, offsetHeight } = mainContentRef.current;\r\n    // 當誤差值小於 1 時 則判定為尚未捲動到最底部\r\n    if ((scrollHeight - (scrollTop + offsetHeight) <= 1)) {\r\n      setCurrentGroup(value);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 滾動單元功能清單時，調整 TAB頁籤 底線位置。\r\n   */\r\n  const handleScrollContent = (event) => {\r\n    const { scrollHeight, scrollTop, offsetHeight } = event.target;\r\n\r\n    if (!(scrollHeight - (scrollTop + offsetHeight) <= 1)) {\r\n      const foundGroup = groupsRef.current.find((el) => {\r\n        // 設定 1 為誤差值，因為 scrollTo Func 不一定會捲動到 element 的 scrollTop 位置\r\n        const top = el.offsetTop - 1;\r\n        const bottom = top + el.offsetHeight;\r\n        return (scrollTop >= top && scrollTop < bottom);\r\n      });\r\n      if (foundGroup && foundGroup.className !== currentGroup) {\r\n        setCurrentGroup(foundGroup.className);\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 顯示指定分類的單元功能項目清單。\r\n   * @param {*} group\r\n   */\r\n  const renderFuncGroup = (group, groupIndex) => {\r\n    const doStartFunc = (funcCode) => {\r\n      // TODO 不可執行的功能，例：純卡戶 執行 申請信用卡。\r\n      // TODO 但 純卡戶 執行轉帳，則是由 Funciton Manager 提供資訊，由 Funciton Controller 詢問是否立即申請。\r\n      startFunc(funcCode);\r\n    };\r\n\r\n    // TODO 加上「new」的圖示，可以用 上線時間 判斷，例：在一個月內都會出現。\r\n    return (\r\n      <section\r\n        ref={(el) => { groupsRef.current[groupIndex] = el; }}\r\n        key={group.groupKey}\r\n        className={group.groupKey}\r\n      >\r\n        <h3 className=\"title\">{group.groupName}</h3>\r\n        <div className=\"blockGroup\">\r\n          {\r\n            group.items.map((item) => (\r\n              <FavoriteBlockButton\r\n                key={item.actKey}\r\n                icon={iconGenerator(item.actKey)}\r\n                label={item.name}\r\n                onClick={() => doStartFunc(item.actKey)}\r\n                noBorder\r\n              />\r\n            ))\r\n          }\r\n        </div>\r\n      </section>\r\n    );\r\n  };\r\n\r\n  /**\r\n   * 頁面輸出\r\n   */\r\n  return (\r\n    <Layout title=\"更多\">\r\n      <MoreWrapper small>\r\n        {funcGroups.length ? (\r\n          <>\r\n            <FEIBTabContext value={currentGroup}>\r\n              <FEIBTabList $size=\"small\" onChange={handleChangeTabs}>\r\n                {\r\n              funcGroups.map((group) => (\r\n                <FEIBTab key={group.groupKey} label={group.groupName} value={group.groupKey} />\r\n              ))\r\n            }\r\n              </FEIBTabList>\r\n            </FEIBTabContext>\r\n            <div className=\"mainContent\" ref={mainContentRef} onScroll={handleScrollContent}>\r\n              {\r\n                funcGroups.map((group, groupIndex) => (renderFuncGroup(group, groupIndex)))\r\n              }\r\n            </div>\r\n          </>\r\n        ) : <EmptyData content=\"查無服務，請確認網路狀態\" />}\r\n      </MoreWrapper>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default More;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}