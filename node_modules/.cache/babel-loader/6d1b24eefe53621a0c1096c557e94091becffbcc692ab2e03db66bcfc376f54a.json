{"ast":null,"code":"import _slicedToArray from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect,useReducer}from'react';import{useController}from'react-hook-form';import{DateRangePicker as KeyboardDateRangePicker}from'react-date-range';import{Button}from'@material-ui/core';import{FEIBInputLabel,FEIBInput}from'components/elements';import{dateToString,stringToDate}from'utilities/Generator';import{CalendarIcon}from'assets/images/icons';import theme from'themes/theme';import DateRangePickerWrapper from'./dateRangePicker.style';/*\r\n* ==================== DateRangePicker 組件說明 ====================\r\n* 時間範圍選擇輸入框\r\n* ==================== DateRangePicker 可傳參數 ====================\r\n* 1. label -> label 標題文字，若不傳預設為 \"自訂搜尋日期區間\"\r\n* 2. value -> 時間範圍，型別為陣列\r\n*    陣列內第一個值為起始日，第二個值為結束日 -> date = [startDate, endDate]\r\n*    若有需動態保留的時間範圍可代入，若無則預設為當日\r\n* 3. onChange -> 點擊事件\r\n*    日期範圍選擇完畢後，點擊面板右下方 \"確定\" 後所觸發的事件，可直接在外部傳入一個 function\r\n*    該 function 可以接收一個任意參數，透過該參數將可取得所選的日期範圍\r\n* */import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function DateRangePicker(props){var _ref2,_ref3,_model$displayText;var control=props.control,name=props.name,label=props.label,minDate=props.minDate,maxDate=props.maxDate,onChange=props.onChange,value=props.value;var _ref=control?useController({name:name,control:control}):{field:{onChange:onChange,value:value}},field=_ref.field;var myOnChange=field.onChange;var myValue=field.value;var _useReducer=useReducer(function(x){return x+1;},0),_useReducer2=_slicedToArray(_useReducer,2),forceUpdate=_useReducer2[1];var _useState=useState(),_useState2=_slicedToArray(_useState,2),showDatePicker=_useState2[0],setShowDatePicker=_useState2[1];var defaultRange={startDate:(_ref2=value?value[0]:null)!==null&&_ref2!==void 0?_ref2:new Date(),endDate:(_ref3=value?value[1]:null)!==null&&_ref3!==void 0?_ref3:new Date(),key:'selection'};var _useState3=useState({range:null,displayText:null,selectionRange:defaultRange}),_useState4=_slicedToArray(_useState3,1),model=_useState4[0];useEffect(function(){if(myValue!==null&&myValue!==void 0&&myValue.length){var _startDate;var range=myValue;var startDate=myValue[0];if(((_startDate=startDate)===null||_startDate===void 0?void 0:_startDate.constructor)===String){var _stringToDate;// 為了相容台外幣明細查詢\nif(!startDate)return;// 當沒有設定日期時，維持「自訂搜尋日期區間」為空白。\nstartDate=stringToDate(startDate);var endDate=(_stringToDate=stringToDate(myValue[1]))!==null&&_stringToDate!==void 0?_stringToDate:startDate;range=[startDate,endDate];}// eslint-disable-next-line no-use-before-define\nsetDateRange(range);}},[]);/**\r\n   *\r\n   * @param {[Date]} range\r\n   */var setDateRange=function setDateRange(range){if(!range)return;// 初始時，會在 range 無值時被觸發！還沒找到原因\nvar startDate=range[0];var endDate=range[1];if(range&&range.length===2&&startDate&&endDate){model.range=[startDate,endDate];model.displayText=\"\".concat(dateToString(startDate),\" - \").concat(dateToString(endDate));model.selectionRange.startDate=startDate;model.selectionRange.endDate=endDate;}else{model.displayText=null;}forceUpdate();};var onSelectChanged=function onSelectChanged(ranges){var _ranges$selection=ranges.selection,startDate=_ranges$selection.startDate,endDate=_ranges$selection.endDate;setDateRange([startDate,endDate]);};var onCancel=function onCancel(){setShowDatePicker(false);setDateRange(myValue);model.selectionRange=defaultRange;// NOTE 必需清除，否則在 value 沒有值時，取消再進來仍會保留原本的設計範圍。\n};var onConfirm=function onConfirm(){setShowDatePicker(false);myOnChange(model.range);};// props.value 變更時，同步更新元件的日期區間\nuseEffect(function(){if(value&&value.length===2&&value[0]&&value[1])setDateRange(value);},[value]);return/*#__PURE__*/_jsxs(DateRangePickerWrapper,{children:[/*#__PURE__*/_jsx(FEIBInputLabel,{children:label||'自訂搜尋日期區間'}),/*#__PURE__*/_jsx(FEIBInput,{placeholder:\"\\u8ACB\\u9078\\u64C7\",value:(_model$displayText=model===null||model===void 0?void 0:model.displayText)!==null&&_model$displayText!==void 0?_model$displayText:'',$icon:/*#__PURE__*/_jsx(CalendarIcon,{}),$iconFontSize:2.4,readOnly:true,onClick:function onClick(){return setShowDatePicker(true);}}),showDatePicker&&/*#__PURE__*/_jsx(\"div\",{className:\"dateRangePickerMask\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"dateRangePickerWrapper\",onClick:function onClick(event){event.stopPropagation();},children:[/*#__PURE__*/_jsx(KeyboardDateRangePicker,{minDate:minDate,maxDate:maxDate,rangeColors:[theme.colors.primary.light],ranges:[model===null||model===void 0?void 0:model.selectionRange],onChange:onSelectChanged,startDatePlaceholder:\"\\u8D77\\u59CB\\u65E5\\u671F\",endDatePlaceholder:\"\\u7D50\\u675F\\u65E5\\u671F\",dateDisplayFormat:\"yyyy/MM/dd\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons\",children:[/*#__PURE__*/_jsx(Button,{className:\"cancel\",onClick:onCancel,children:\"\\u53D6\\u6D88\"}),/*#__PURE__*/_jsx(Button,{className:\"apply\",disabled:!(model!==null&&model!==void 0&&model.range),onClick:onConfirm,children:\" \\u78BA\\u5B9A \"})]})]})})]});}export default DateRangePicker;","map":{"version":3,"names":["useState","useEffect","useReducer","useController","DateRangePicker","KeyboardDateRangePicker","Button","FEIBInputLabel","FEIBInput","dateToString","stringToDate","CalendarIcon","theme","DateRangePickerWrapper","props","control","name","label","minDate","maxDate","onChange","value","field","myOnChange","myValue","x","forceUpdate","showDatePicker","setShowDatePicker","defaultRange","startDate","Date","endDate","key","range","displayText","selectionRange","model","length","constructor","String","setDateRange","onSelectChanged","ranges","selection","onCancel","onConfirm","event","stopPropagation","colors","primary","light"],"sources":["C:/Users/allen/git/app2-webview/src/components/DateRangePicker/index.js"],"sourcesContent":["import { useState, useEffect, useReducer } from 'react';\r\nimport { useController } from 'react-hook-form';\r\nimport { DateRangePicker as KeyboardDateRangePicker } from 'react-date-range';\r\nimport { Button } from '@material-ui/core';\r\nimport { FEIBInputLabel, FEIBInput } from 'components/elements';\r\nimport { dateToString, stringToDate } from 'utilities/Generator';\r\nimport { CalendarIcon } from 'assets/images/icons';\r\nimport theme from 'themes/theme';\r\nimport DateRangePickerWrapper from './dateRangePicker.style';\r\n\r\n/*\r\n* ==================== DateRangePicker 組件說明 ====================\r\n* 時間範圍選擇輸入框\r\n* ==================== DateRangePicker 可傳參數 ====================\r\n* 1. label -> label 標題文字，若不傳預設為 \"自訂搜尋日期區間\"\r\n* 2. value -> 時間範圍，型別為陣列\r\n*    陣列內第一個值為起始日，第二個值為結束日 -> date = [startDate, endDate]\r\n*    若有需動態保留的時間範圍可代入，若無則預設為當日\r\n* 3. onChange -> 點擊事件\r\n*    日期範圍選擇完畢後，點擊面板右下方 \"確定\" 後所觸發的事件，可直接在外部傳入一個 function\r\n*    該 function 可以接收一個任意參數，透過該參數將可取得所選的日期範圍\r\n* */\r\nfunction DateRangePicker(props) {\r\n  const {\r\n    control, name, label, minDate, maxDate, onChange, value,\r\n  } = props;\r\n  const { field } = control ? useController({ name, control }) : { field: { onChange, value } };\r\n  const myOnChange = field.onChange;\r\n  const myValue = field.value;\r\n\r\n  const [, forceUpdate] = useReducer((x) => x + 1, 0);\r\n\r\n  const [showDatePicker, setShowDatePicker] = useState();\r\n  const defaultRange = {\r\n    startDate: (value ? value[0] : null) ?? new Date(),\r\n    endDate: (value ? value[1] : null) ?? new Date(),\r\n    key: 'selection',\r\n  };\r\n  const [model] = useState({\r\n    range: null,\r\n    displayText: null,\r\n    selectionRange: defaultRange,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (myValue?.length) {\r\n      let range = myValue;\r\n      let startDate = myValue[0];\r\n      if (startDate?.constructor === String) { // 為了相容台外幣明細查詢\r\n        if (!startDate) return; // 當沒有設定日期時，維持「自訂搜尋日期區間」為空白。\r\n        startDate = stringToDate(startDate);\r\n        const endDate = stringToDate(myValue[1]) ?? startDate;\r\n        range = [startDate, endDate];\r\n      }\r\n      // eslint-disable-next-line no-use-before-define\r\n      setDateRange(range);\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   *\r\n   * @param {[Date]} range\r\n   */\r\n  const setDateRange = (range) => {\r\n    if (!range) return; // 初始時，會在 range 無值時被觸發！還沒找到原因\r\n\r\n    const startDate = range[0];\r\n    const endDate = range[1];\r\n    if (range && range.length === 2 && startDate && endDate) {\r\n      model.range = [startDate, endDate];\r\n      model.displayText = `${dateToString(startDate)} - ${dateToString(endDate)}`;\r\n      model.selectionRange.startDate = startDate;\r\n      model.selectionRange.endDate = endDate;\r\n    } else {\r\n      model.displayText = null;\r\n    }\r\n    forceUpdate();\r\n  };\r\n\r\n  const onSelectChanged = (ranges) => {\r\n    const { startDate, endDate } = ranges.selection;\r\n    setDateRange([startDate, endDate]);\r\n  };\r\n\r\n  const onCancel = () => {\r\n    setShowDatePicker(false);\r\n    setDateRange(myValue);\r\n    model.selectionRange = defaultRange; // NOTE 必需清除，否則在 value 沒有值時，取消再進來仍會保留原本的設計範圍。\r\n  };\r\n\r\n  const onConfirm = () => {\r\n    setShowDatePicker(false);\r\n    myOnChange(model.range);\r\n  };\r\n\r\n  // props.value 變更時，同步更新元件的日期區間\r\n  useEffect(() => {\r\n    if (value && value.length === 2 && value[0] && value[1]) setDateRange(value);\r\n  }, [value]);\r\n\r\n  return (\r\n    <DateRangePickerWrapper>\r\n      <FEIBInputLabel>{label || '自訂搜尋日期區間'}</FEIBInputLabel>\r\n      <FEIBInput\r\n        placeholder=\"請選擇\"\r\n        value={model?.displayText ?? ''}\r\n        $icon={<CalendarIcon />}\r\n        $iconFontSize={2.4}\r\n        readOnly\r\n        onClick={() => setShowDatePicker(true)}\r\n      />\r\n      {showDatePicker && (\r\n        <div className=\"dateRangePickerMask\">\r\n          <div className=\"dateRangePickerWrapper\" onClick={(event) => { event.stopPropagation(); }}>\r\n            <KeyboardDateRangePicker\r\n              minDate={minDate}\r\n              maxDate={maxDate}\r\n              rangeColors={[theme.colors.primary.light]}\r\n              ranges={[model?.selectionRange]}\r\n              onChange={onSelectChanged}\r\n              startDatePlaceholder=\"起始日期\"\r\n              endDatePlaceholder=\"結束日期\"\r\n              dateDisplayFormat=\"yyyy/MM/dd\"\r\n            />\r\n            <div className=\"buttons\">\r\n              <Button className=\"cancel\" onClick={onCancel}>取消</Button>\r\n              <Button className=\"apply\" disabled={!model?.range} onClick={onConfirm}> 確定 </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </DateRangePickerWrapper>\r\n  );\r\n}\r\n\r\nexport default DateRangePicker;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}