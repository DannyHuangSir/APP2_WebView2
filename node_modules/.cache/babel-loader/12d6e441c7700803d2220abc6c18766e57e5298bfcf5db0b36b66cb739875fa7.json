{"ast":null,"code":"import _objectSpread from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/allen/git/app2-webview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{callAPI}from'utilities/axios';import{dateToYMD}from'utilities/Generator';/**\r\n * 查詢即時消費明細\r\n * (信用卡子首頁 - 2)\r\n * (信用卡子首頁_即時消費明細 - 2)\r\n *\r\n * @param token\r\n * @param rq {\r\n *    cardNo,   卡號\r\n *    dateBeg,  查詢起日 (西元YYYYMMDD)\r\n *    dateEnd,  查詢迄日 (西元YYYYMMDD)\r\n * }\r\n * @return [\r\n *    {\r\n *      txDate, 交易日期時間 (yyyymmddhhmmss)\r\n *      amount, 消費金額\r\n *      txName,\r\n *      txKey,  交易鍵值\r\n *      note,   備註\r\n *    },\r\n *    ...\r\n * ]\r\n */export var getTransactions=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(request){var response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return callAPI('/api/card/v1/getTransactions',request);case 2:response=_context.sent;return _context.abrupt(\"return\",response.data);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getTransactions(_x){return _ref.apply(this,arguments);};}();/**\r\n * 查詢客戶的 bankee 信用卡資訊\r\n *\r\n * @param token\r\n * @return {\r\n * usedCardLimit, // 已使用額度\r\n * isBankeeCard, // 專案代號\r\n * cards [\r\n *      {\r\n *        cardNo, // 卡號\r\n *      },\r\n *      ...\r\n *    ]\r\n * }\r\n *\r\n */export var getBankeeCard=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(request){var _yield$callAPI,_yield$callAPI$data,cards,usedCardLimit,bankeeCard;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return callAPI('/api/card/v1/getCards',request);case 2:_yield$callAPI=_context2.sent;_yield$callAPI$data=_yield$callAPI.data;cards=_yield$callAPI$data.cards;usedCardLimit=_yield$callAPI$data.usedCardLimit;bankeeCard=cards.find(function(card){return card.isBankeeCard==='Y';});if(bankeeCard){_context2.next=9;break;}return _context2.abrupt(\"return\",null);case 9:return _context2.abrupt(\"return\",{cards:[{cardNo:bankeeCard.cardNo}],usedCardLimit:usedCardLimit,isBankeeCard:true});case 10:case\"end\":return _context2.stop();}}},_callee2);}));return function getBankeeCard(_x2){return _ref2.apply(this,arguments);};}();export var getTransactionPromise=function getTransactionPromise(cardNo){return new Promise(function(resolve){var today=new Date();var dateBeg=dateToYMD(new Date(today.setMonth(today.getMonth()-2)));// 查詢當天至60天前的資料\nvar dateEnd=dateToYMD();var payload={cardNo:cardNo,dateBeg:dateBeg,dateEnd:dateEnd};getTransactions(payload).then(function(transactions){if(!transactions.length)resolve([]);else{// 將回傳的資料加入 cardNo 以利後續畫面渲染與編輯\nvar newTransactions=transactions.map(function(transaction){return _objectSpread(_objectSpread({},transaction),{},{cardNo:cardNo});});resolve(newTransactions);}});});};/**\r\n * 編輯信用卡即時消費明細備註\r\n * (信用卡子首頁 - 3)\r\n * (信用卡子首頁_即時消費明細 - 3)\r\n *\r\n * @param token\r\n * @param {\r\n *    cardNo:   卡號\r\n *    txDate:   消費日期\r\n *    txKey:    消費明細唯一Key值\r\n *    note:     備註內容\r\n * }\r\n * @return {\r\n *    result:   true/false\r\n *    message:  回傳結果\r\n * }\r\n *\r\n */export var updateTxnNotes=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(param){var response;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return callAPI('/api/card/v1/updateTxnNotes',param);case 2:response=_context3.sent;return _context3.abrupt(\"return\",response.data);case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function updateTxnNotes(_x3){return _ref3.apply(this,arguments);};}();","map":{"version":3,"names":["callAPI","dateToYMD","getTransactions","request","response","data","getBankeeCard","cards","usedCardLimit","bankeeCard","find","card","isBankeeCard","cardNo","getTransactionPromise","Promise","resolve","today","Date","dateBeg","setMonth","getMonth","dateEnd","payload","then","transactions","length","newTransactions","map","transaction","updateTxnNotes","param"],"sources":["C:/Users/allen/git/app2-webview/src/pages/R00100_CCTransaction/api.js"],"sourcesContent":["import { callAPI } from 'utilities/axios';\r\nimport { dateToYMD } from 'utilities/Generator';\r\n\r\n/**\r\n * 查詢即時消費明細\r\n * (信用卡子首頁 - 2)\r\n * (信用卡子首頁_即時消費明細 - 2)\r\n *\r\n * @param token\r\n * @param rq {\r\n *    cardNo,   卡號\r\n *    dateBeg,  查詢起日 (西元YYYYMMDD)\r\n *    dateEnd,  查詢迄日 (西元YYYYMMDD)\r\n * }\r\n * @return [\r\n *    {\r\n *      txDate, 交易日期時間 (yyyymmddhhmmss)\r\n *      amount, 消費金額\r\n *      txName,\r\n *      txKey,  交易鍵值\r\n *      note,   備註\r\n *    },\r\n *    ...\r\n * ]\r\n */\r\nexport const getTransactions = async (request) => {\r\n  const response = await callAPI('/api/card/v1/getTransactions', request);\r\n  return response.data;\r\n};\r\n\r\n/**\r\n * 查詢客戶的 bankee 信用卡資訊\r\n *\r\n * @param token\r\n * @return {\r\n * usedCardLimit, // 已使用額度\r\n * isBankeeCard, // 專案代號\r\n * cards [\r\n *      {\r\n *        cardNo, // 卡號\r\n *      },\r\n *      ...\r\n *    ]\r\n * }\r\n *\r\n */\r\n\r\nexport const getBankeeCard = async (request) => {\r\n  const {\r\n    data: { cards, usedCardLimit },\r\n  } = await callAPI('/api/card/v1/getCards', request);\r\n  const bankeeCard = cards.find((card) => card.isBankeeCard === 'Y');\r\n  if (!bankeeCard) return null;\r\n  return { cards: [{ cardNo: bankeeCard.cardNo }], usedCardLimit, isBankeeCard: true };\r\n};\r\n\r\nexport const getTransactionPromise = (cardNo) => new Promise((resolve) => {\r\n  const today = new Date();\r\n  const dateBeg = dateToYMD(new Date(today.setMonth(today.getMonth() - 2))); // 查詢當天至60天前的資料\r\n  const dateEnd = dateToYMD();\r\n  const payload = { cardNo, dateBeg, dateEnd };\r\n  getTransactions(payload).then((transactions) => {\r\n    if (!transactions.length) resolve([]);\r\n    else {\r\n      // 將回傳的資料加入 cardNo 以利後續畫面渲染與編輯\r\n      const newTransactions = transactions.map((transaction) => ({\r\n        ...transaction,\r\n        cardNo,\r\n      }));\r\n      resolve(newTransactions);\r\n    }\r\n  });\r\n});\r\n\r\n/**\r\n * 編輯信用卡即時消費明細備註\r\n * (信用卡子首頁 - 3)\r\n * (信用卡子首頁_即時消費明細 - 3)\r\n *\r\n * @param token\r\n * @param {\r\n *    cardNo:   卡號\r\n *    txDate:   消費日期\r\n *    txKey:    消費明細唯一Key值\r\n *    note:     備註內容\r\n * }\r\n * @return {\r\n *    result:   true/false\r\n *    message:  回傳結果\r\n * }\r\n *\r\n */\r\nexport const updateTxnNotes = async (param) => {\r\n  const response = await callAPI('/api/card/v1/updateTxnNotes', param);\r\n  return response.data;\r\n};\r\n"],"mappings":"8WAAA,OAASA,OAAO,KAAQ,iBAAiB,CACzC,OAASC,SAAS,KAAQ,qBAAqB,CAE/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACA,MAAO,IAAMC,gBAAe,4FAAG,iBAAOC,OAAO,uJACpBH,QAAO,CAAC,8BAA8B,CAAEG,OAAO,CAAC,QAAjEC,QAAQ,+CACPA,QAAQ,CAACC,IAAI,wDACrB,kBAHYH,gBAAe,4CAG3B,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAEA,MAAO,IAAMI,cAAa,6FAAG,kBAAOH,OAAO,qNAG/BH,QAAO,CAAC,uBAAuB,CAAEG,OAAO,CAAC,yEADjDE,IAAI,CAAIE,KAAK,qBAALA,KAAK,CAAEC,aAAa,qBAAbA,aAAa,CAExBC,UAAU,CAAGF,KAAK,CAACG,IAAI,CAAC,SAACC,IAAI,QAAKA,KAAI,CAACC,YAAY,GAAK,GAAG,GAAC,IAC7DH,UAAU,2DAAS,IAAI,0CACrB,CAAEF,KAAK,CAAE,CAAC,CAAEM,MAAM,CAAEJ,UAAU,CAACI,MAAO,CAAC,CAAC,CAAEL,aAAa,CAAbA,aAAa,CAAEI,YAAY,CAAE,IAAK,CAAC,2DACrF,kBAPYN,cAAa,8CAOzB,CAED,MAAO,IAAMQ,sBAAqB,CAAG,QAAxBA,sBAAqB,CAAID,MAAM,QAAK,IAAIE,QAAO,CAAC,SAACC,OAAO,CAAK,CACxE,GAAMC,MAAK,CAAG,GAAIC,KAAI,EAAE,CACxB,GAAMC,QAAO,CAAGlB,SAAS,CAAC,GAAIiB,KAAI,CAACD,KAAK,CAACG,QAAQ,CAACH,KAAK,CAACI,QAAQ,EAAE,CAAG,CAAC,CAAC,CAAC,CAAC,CAAE;AAC3E,GAAMC,QAAO,CAAGrB,SAAS,EAAE,CAC3B,GAAMsB,QAAO,CAAG,CAAEV,MAAM,CAANA,MAAM,CAAEM,OAAO,CAAPA,OAAO,CAAEG,OAAO,CAAPA,OAAQ,CAAC,CAC5CpB,eAAe,CAACqB,OAAO,CAAC,CAACC,IAAI,CAAC,SAACC,YAAY,CAAK,CAC9C,GAAI,CAACA,YAAY,CAACC,MAAM,CAAEV,OAAO,CAAC,EAAE,CAAC,CAAC,IACjC,CACH;AACA,GAAMW,gBAAe,CAAGF,YAAY,CAACG,GAAG,CAAC,SAACC,WAAW,wCAChDA,WAAW,MACdhB,MAAM,CAANA,MAAM,IACN,CAAC,CACHG,OAAO,CAACW,eAAe,CAAC,CAC1B,CACF,CAAC,CAAC,CACJ,CAAC,CAAC,GAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACA,MAAO,IAAMG,eAAc,6FAAG,kBAAOC,KAAK,4JACjB/B,QAAO,CAAC,6BAA6B,CAAE+B,KAAK,CAAC,QAA9D3B,QAAQ,iDACPA,QAAQ,CAACC,IAAI,0DACrB,kBAHYyB,eAAc,8CAG1B"},"metadata":{},"sourceType":"module","externalDependencies":[]}